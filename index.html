<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#0f1724">
<title>Study Arc V5.0 ‚Äî Premium Student Focus</title>
<link rel="icon" href="icons/app-logo-192.png" type="image/png">
<link rel="manifest" href="manifest.json?v=5">

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5520401672645952" crossorigin="anonymous"></script>

<style>
/* --- üé® STUDY ARC V5.0 PREMIUM CSS --- */

:root {
  --font-main: 'Inter', system-ui, -apple-system, sans-serif;
  --glass-bg: rgba(255, 255, 255, 0.05);
  --glass-border: 1px solid rgba(255, 255, 255, 0.08);
  --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
  --backdrop: blur(16px);
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  
  /* Default Theme (Mint) */
  --bg-gradient: linear-gradient(135deg, #0f1724 0%, #071633 100%);
  --accent: #34d399;
  --accent-grad: linear-gradient(135deg, #34d399 0%, #10b981 100%);
  --text: #ffffff;
  --text-muted: rgba(255, 255, 255, 0.6);
  --danger: #ef4444;
  --success: #10b981;
  --warning: #f59e0b;
}

/* üé® Themes Engine */
body.theme-sunset { 
    --bg-gradient: linear-gradient(135deg, #2a0845 0%, #6441a5 100%);
    --accent: #fbbf24; 
    --accent-grad: linear-gradient(135deg, #fbbf24, #f59e0b); 
}
body.theme-amoled { 
    --bg-gradient: #000000; 
    --glass-bg: rgba(20, 20, 20, 0.9); 
    --glass-border: 1px solid #333; 
    --accent: #ffffff; 
    --accent-grad: linear-gradient(135deg, #ffffff, #999999); 
}
body.theme-cyber { 
    --bg-gradient: linear-gradient(135deg, #0b0014, #240046); 
    --glass-bg: rgba(255, 0, 200, 0.05); 
    --glass-border: 1px solid rgba(0, 255, 234, 0.3);
    --accent: #00ffea; 
    --accent-grad: linear-gradient(135deg, #f000ff, #00ffea); 
}
body.theme-midnight { 
    --bg-gradient: linear-gradient(135deg, #02111b, #0c2d48); 
    --glass-bg: rgba(100, 150, 255, 0.05); 
    --accent: #5da9e9; 
    --accent-grad: linear-gradient(135deg, #4facfe, #00f2fe); 
}

/* --- Global Reset & Base --- */
* { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
body { margin: 0; font-family: var(--font-main); background: var(--bg-gradient); color: var(--text); min-height: 100vh; overflow-x: hidden; }

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
::-webkit-scrollbar-track { background: transparent; }

/* --- Layout Grid --- */
.app-container { 
    max-width: 1280px; margin: 0 auto; padding: 20px; 
    display: grid; grid-template-columns: 280px 1fr; gap: 25px; 
    height: 100vh; overflow: hidden; position: relative; 
}

/* --- ‚ú® Premium Components --- */

/* 1. Glass Panel (The base of UI) */
.glass-panel { 
    background: var(--glass-bg); 
    backdrop-filter: var(--backdrop); -webkit-backdrop-filter: var(--backdrop); 
    border: var(--glass-border); 
    border-radius: 24px; 
    box-shadow: var(--glass-shadow); 
    padding: 24px; 
    overflow-y: auto; 
    transition: transform 0.2s ease;
}

/* 2. Premium Buttons */
.btn { border: none; padding: 12px 24px; border-radius: 14px; font-weight: 700; cursor: pointer; transition: var(--transition); font-size: 14px; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
.btn:active { transform: scale(0.96); }
.btn-primary { background: var(--accent-grad); color: #000; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
.btn-primary:hover { box-shadow: 0 8px 30px rgba(0,0,0,0.3); transform: translateY(-2px); }
.btn-ghost { background: rgba(255,255,255,0.08); color: white; border: 1px solid rgba(255,255,255,0.05); }
.btn-ghost:hover { background: rgba(255,255,255,0.15); }
.btn-danger { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }

/* 3. Inputs */
.input { width: 100%; padding: 14px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; margin-bottom: 12px; font-family: var(--font-main); transition: var(--transition); }
.input:focus { border-color: var(--accent); background: rgba(0,0,0,0.4); }

/* --- Sidebar Styling --- */
.sidebar { display: flex; flex-direction: column; gap: 15px; height: 100%; z-index: 900; }
.brand { font-size: 26px; font-weight: 900; letter-spacing: -1px; background: var(--accent-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; margin-bottom: 10px; }

.nav-item { padding: 14px; border-radius: 14px; cursor: pointer; transition: 0.2s; color: var(--text-muted); display: flex; align-items: center; gap: 12px; font-weight: 600; font-size: 15px; }
.nav-item:hover { background: rgba(255,255,255,0.05); color: var(--text); }
.nav-item.active { background: rgba(255,255,255,0.1); color: var(--accent); border-left: 4px solid var(--accent); box-shadow: 0 4px 20px rgba(0,0,0,0.1); }

/* --- Dashboard Header (User ID Card) --- */
.user-id-card {
    display: flex; align-items: center; gap: 15px;
    background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border: 1px solid var(--accent);
    box-shadow: 0 0 15px rgba(52, 211, 153, 0.1); /* Glow effect */
    padding: 10px 20px;
    border-radius: 18px;
}
.user-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--accent-grad); display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: bold; color: black; }

/* --- Stats Cards --- */
.stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
.stat-card { background: rgba(255,255,255,0.02); padding: 20px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.05); position: relative; overflow: hidden; }
.stat-val { font-size: 28px; font-weight: 800; margin-top: 5px; color: var(--text); }
.stat-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 5px; }

/* --- Tasks (Glass Tiles) --- */
.task-item { 
    display: flex; align-items: center; justify-content: space-between; 
    padding: 16px; margin-bottom: 10px; 
    background: rgba(255,255,255,0.03); 
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 16px; 
    transition: all 0.3s ease; 
}
.task-item.completed { background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.3); }
.task-item.failed { background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3); opacity: 0.7; }

/* --- Focus Overlay (Timer) --- */
#focusOverlay { 
    position: fixed; inset: 0; background: var(--bg-gradient); z-index: 5000; 
    display: flex; flex-direction: column; align-items: center; justify-content: center; 
    transform: translateY(100%); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
}
#focusOverlay.active { transform: translateY(0); }
.timer-huge { 
    font-size: 80px; font-weight: 900; 
    font-variant-numeric: tabular-nums; 
    background: var(--accent-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
    text-shadow: 0 10px 30px rgba(0,0,0,0.3);
    margin: 20px 0;
    animation: pulse 2s infinite;
}
@keyframes pulse { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.8; transform: scale(0.98); } 100% { opacity: 1; transform: scale(1); } }

/* --- Exam Guide (Accordion) --- */
.guide-card { background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; margin-bottom: 12px; overflow: hidden; transition: 0.3s; }
.guide-header { padding: 18px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; background: rgba(255,255,255,0.03); font-weight: 600; }
.guide-content { padding: 0 18px; max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; color: var(--text-muted); font-size: 14px; line-height: 1.7; }
.guide-content.open { padding: 18px; max-height: 2000px; border-top: 1px solid rgba(255,255,255,0.05); }

/* --- Ads Area --- */
.ad-slot { width: 100%; text-align: center; margin: 15px 0; background: rgba(0,0,0,0.1); border-radius: 12px; overflow: hidden; min-height: 60px; display:flex; justify-content:center; align-items:center; border: 1px dashed rgba(255,255,255,0.1); }
.ad-label { font-size: 9px; color: #555; text-transform: uppercase; margin-bottom: 2px; display:block; }

/* --- üì± Mobile Responsiveness (Fixed Sidebar) --- */
.mobile-header { display: none; justify-content: space-between; align-items: center; padding-bottom: 15px; }
.hamburger { font-size: 28px; cursor: pointer; background: none; border: none; color: white; padding: 5px; }
.overlay-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 800; display: none; backdrop-filter: blur(4px); }

@media (max-width: 768px) {
  .app-container { grid-template-columns: 1fr; padding: 15px; height: 100vh; overflow-y: auto; display: block; }
  
  /* Sidebar Floating Drawer Logic */
  .sidebar { 
      position: fixed; top: 0; left: -320px; width: 280px; height: 100%; 
      background: var(--bg-gradient); border-right: 1px solid var(--glass-border); 
      transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
      box-shadow: 10px 0 40px rgba(0,0,0,0.5); 
      z-index: 2000; padding: 20px; 
  }
  .sidebar.active { left: 0; }
  .overlay-bg.active { display: block; }
  
  /* Layout Fixes */
  .mobile-header { display: flex; }
  .main-content { height: auto; overflow: visible; padding-bottom: 100px; }
  .stats-grid { grid-template-columns: 1fr 1fr; } /* 2 columns on mobile */
  .stat-card:last-child { grid-column: span 2; } /* Graph full width */
}

/* Modals */
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 6000; display: flex; align-items: center; justify-content: center; }
.hidden { display: none !important; }

/* Math Toolbar */
.math-toolbar { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 10px; }
.math-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 6px 14px; border-radius: 8px; cursor: pointer; min-width: 40px; font-weight: bold; }

</style>
</head>
<body class="theme-mint">

<canvas id="confetti-canvas" style="position:fixed; pointer-events:none; top:0; left:0; width:100%; height:100%; z-index:100;"></canvas>

<div id="mobileOverlay" class="overlay-bg" onclick="toggleSidebar()"></div>

<div id="onboardingModal" class="modal hidden">
  <div class="glass-panel" style="max-width: 400px; text-align: center; border: 1px solid var(--accent); box-shadow: 0 0 50px rgba(52, 211, 153, 0.2);">
    <div style="font-size: 60px; margin-bottom: 15px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));">üöÄ</div>
    <h2 style="font-size: 28px; margin-bottom: 5px; background: var(--accent-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Study Arc</h2>
    <p style="color:var(--text-muted); font-size:15px; margin-bottom:25px;">Your ultimate companion for NEET/JEE success.</p>
    
    <div style="text-align: left; margin-bottom: 20px;">
        <label style="font-size: 12px; color: var(--accent); margin-left: 5px;">YOUR NAME</label>
        <input id="obName" class="input" placeholder="e.g., Abhinav Sharma" style="margin-top: 5px;">
        
        <label style="font-size: 12px; color: var(--accent); margin-left: 5px;">TARGET EXAM</label>
        <input id="obClass" class="input" placeholder="e.g., NEET 2027" style="margin-top: 5px;">
    </div>
    
    <button class="btn btn-primary" style="width: 100%; justify-content: center; font-size: 16px; padding: 15px;" onclick="completeOnboarding()">
        Start Your Journey ‚ö°
    </button>
  </div>
</div>

<div id="focusOverlay">
  <div style="font-size: 14px; letter-spacing: 3px; text-transform: uppercase; color: var(--accent); margin-bottom: 10px; opacity: 0.8;">CURRENT SESSION</div>
  <div style="font-size: 24px; font-weight: bold; color: white; margin-bottom: 30px; text-shadow: 0 0 20px var(--accent);" id="focusSubjectDisplay">PHYSICS</div>
  
  <div class="timer-huge" id="focusTimerDisplay">00:00:00</div>
  
  <div style="margin-top: 30px; color: var(--text-muted); font-style: italic; text-align:center; padding:0 20px; font-size: 16px;">
    "The pain you feel today is the strength you feel tomorrow."
  </div>
  
  <div style="display: flex; gap: 20px; margin-top: 50px;">
    <button id="btnPause" class="btn btn-ghost" style="border:1px solid white; padding: 15px 30px;" onclick="toggleTimer()">‚è∏Ô∏è Pause</button>
    <button class="btn btn-danger" style="padding: 15px 30px;" onclick="attemptExitFocus()">üõë End Session</button>
  </div>
  <div style="margin-top: 30px; font-size: 11px; opacity: 0.4; letter-spacing: 1px;">SCREEN WAKE LOCK ACTIVE üí°</div>
</div>

<div class="app-container">
  
  <div class="mobile-header">
      <button class="hamburger" onclick="toggleSidebar()">‚ò∞</button>
      <div class="brand" style="font-size: 22px; margin:0;">STUDY ARC</div>
      <div style="width: 30px;"></div> </div>

  <aside class="sidebar glass-panel" id="sidebarMenu">
    <div class="brand">STUDY ARC <span style="font-size:10px; color:var(--accent); vertical-align: super;">PRO</span></div>
    
    <div class="challenge-box">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span style="font-size:10px; font-weight:bold; letter-spacing:1px; color:var(--accent);">ACTIVE CHALLENGE</span>
            <span id="challengeStatus" style="font-size:10px; background:rgba(16, 185, 129, 0.2); color:#10b981; padding:2px 6px; border-radius:4px;">Active</span>
        </div>
        <div id="challengeText" style="font-size:18px; font-weight:800; margin-top:8px; color: white;">Set Goal üëá</div>
        <div class="progress-container">
            <div id="challengeBar" class="progress-fill" style="width: 0%;"></div>
        </div>
        <div style="font-size:11px; margin-top:8px; text-align:right; opacity:0.8;">
            Day <span id="challengeDay">0</span> / <span id="challengeTarget">0</span>
        </div>
    </div>

    <nav style="display: flex; flex-direction: column; gap: 8px; margin-top:15px;">
      <div class="nav-item active" onclick="showSection('dashboard')">üìä Dashboard</div>
      <div class="nav-item" onclick="showSection('challenges')">üèÜ Challenges</div>
      <div class="nav-item" onclick="showSection('tasks')">‚úÖ Task Manager</div>
      <div class="nav-item" onclick="showSection('guide')">‚ÑπÔ∏è Exam Guide</div>
      <div class="nav-item" onclick="showSection('planner')">ü§ñ AI Planner</div>
      <div class="nav-item" onclick="showSection('notes')">üìù Scratchpad</div>
      <div class="nav-item" onclick="showSection('settings')">‚öôÔ∏è Settings</div>
    </nav>
    
    <div style="margin-top: auto;">
      <div class="ad-slot">
          <span class="ad-label">Sponsored</span>
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-5520401672645952"
               data-ad-slot="9706016855"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
          <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>
    </div>
  </aside>

  <main class="main-content">
    
    <div id="section-dashboard">
      <div class="header">
        <div class="user-id-card">
            <div class="user-avatar" id="userAvatar">A</div>
            <div>
                <div id="userGreet" style="font-weight: 800; font-size: 18px;">Hello, Student</div>
                <div id="userExam" style="font-size: 11px; color: var(--accent); text-transform: uppercase; letter-spacing: 1px;">NEET ASPIRANT</div>
            </div>
        </div>
        
        <div class="glass-panel" style="padding: 10px 20px; text-align: center; border: 1px solid var(--accent); min-width: 130px;">
            <div id="rankDisplay" style="font-weight:900; font-size: 16px; color:var(--accent);">Beginner</div>
            <div style="font-size:10px; opacity:0.7;">Lifetime Rank</div>
        </div>
      </div>

      <div class="ad-slot" style="min-height: 90px; margin: 20px 0;">
          <span class="ad-label">Sponsored</span>
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-5520401672645952"
               data-ad-slot="2938617898"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
          <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>

      <div class="glass-panel" style="margin-bottom: 25px; border: 1px solid rgba(255,255,255,0.1); position: relative; overflow: hidden;">
        <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: var(--accent); opacity: 0.1; filter: blur(50px); border-radius: 50%;"></div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; position: relative;">
          <h3 style="margin:0; display: flex; align-items: center; gap: 10px;">‚ö° Quick Focus Session</h3>
        </div>
        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 10px; align-items: center; position: relative;">
            <select id="quickSubject" class="input" style="margin:0;" onchange="checkCustomSubject(this)">
                <option value="Physics">üî≠ Physics</option>
                <option value="Chemistry">üß™ Chemistry</option>
                <option value="Biology">üß¨ Biology</option>
                <option value="Maths">üßÆ Maths</option>
                <option value="Other">‚ú® Other...</option>
            </select>
            <input id="customSubjectInput" class="input" placeholder="Subject Name" style="margin:0; display:none;">
            
            <input id="quickHrs" type="number" class="input" placeholder="Hr" value="0" style="margin:0;">
            <input id="quickMins" type="number" class="input" placeholder="Min" value="45" style="margin:0;">
            <button class="btn btn-primary" style="padding: 14px 20px;" onclick="startQuickFocus()">
                START ‚ñ∂
            </button>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Tasks</div>
          <div class="stat-val" id="statTotalTasks">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Completed</div>
          <div class="stat-val" id="statCompletedTasks" style="color:var(--success);">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Pending</div>
          <div class="stat-val" id="statPendingTasks" style="color:var(--danger);">0</div>
        </div>
        
        <div class="stat-card" style="grid-column: span 3;">
          <div class="stat-label">Subject Analysis</div>
          <div style="height: 150px; margin-top: 10px;">
            <canvas id="subjectChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div id="section-tasks" class="hidden">
        <div class="glass-panel">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2>‚úÖ Task Manager</h2>
                <button class="btn btn-danger" style="font-size: 12px; padding: 8px 15px;" onclick="clearCompletedTasks()">üóëÔ∏è Clear Done</button>
            </div>
            
            <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 15px; margin-bottom: 20px;">
                <div style="display:flex; gap:10px;">
                    <input id="newTaskName" class="input" placeholder="Enter new task..." style="margin:0;">
                    <button class="btn btn-primary" onclick="addTask()">+ Add</button>
                </div>
            </div>

            <div id="taskListContainer" style="display: flex; flex-direction: column; gap: 10px;">
                </div>
        </div>
    </div>

    <div id="section-challenges" class="hidden">
      <div class="glass-panel" style="text-align: center;">
        <div style="font-size: 60px; margin-bottom: 10px;">üèÜ</div>
        <h2 style="font-size: 28px;">Challenge Mode</h2>
        <p style="color:var(--text-muted); margin-bottom:30px;">"Discipline is doing what needs to be done, even if you don't want to do it."</p>
        
        <div style="background:rgba(255,255,255,0.03); padding:30px; border-radius:20px; border:1px solid var(--accent); max-width: 500px; margin: 0 auto;">
            <label style="display:block; text-align:left; margin-bottom:5px; color:var(--accent);">CHALLENGE NAME</label>
            <input id="challengeNameInput" class="input" placeholder="e.g. 75 Hard, No Junk Food">
            
            <label style="display:block; text-align:left; margin-bottom:5px; margin-top:15px; color:var(--accent);">DURATION</label>
            <div style="display:flex; gap:10px;">
                <select id="challengeDaysInput" class="input">
                    <option value="21">21 Days (Habit)</option>
                    <option value="30">30 Days (Sprint)</option>
                    <option value="50">50 Days (Warrior)</option>
                    <option value="75">75 Hard (Legend)</option>
                    <option value="100">100 Days (God)</option>
                </select>
            </div>
            
            <button class="btn btn-primary" style="width: 100%; margin-top: 20px; font-size: 18px;" onclick="startChallenge()">Start Challenge üî•</button>
            <p style="font-size:12px; color:var(--danger); margin-top:15px; opacity:0.7;">‚ö†Ô∏è Warning: Starting a new challenge will reset your current progress.</p>
        </div>
        
        <div id="challengeControl" style="margin-top: 30px; display: none;">
             <button class="btn btn-success" style="background: var(--success); color: white; padding: 15px 40px; font-size: 18px;" onclick="openClaimModal()">
                ‚úÖ Mark Today Complete
             </button>
        </div>
      </div>
    </div>

    <div id="section-guide" class="hidden">
      <div class="glass-panel">
        <h2>‚ÑπÔ∏è Exam Success Hub</h2>
        <p style="color:var(--text-muted); margin-bottom:20px;">Detailed roadmaps, subject-wise hacks, and toppers' secrets.</p>
        
        <div class="guide-card">
            <div class="guide-header" onclick="toggleGuide(this)">
                <strong>ü©∫ NEET (Medical) Master Strategy</strong> <span>‚ñº</span>
            </div>
            <div class="guide-content">
                <h4 style="color:var(--accent); margin-top:10px;">Target: 680+ Marks</h4>
                <p>NEET is not just about hard work; it's about smart work and NCERT.</p>
                
                <h5 style="color:#fbbf24; margin-bottom:5px;">üß¨ Biology (360/360)</h5>
                <ul style="padding-left:20px; line-height: 1.8;">
                    <li><strong>The Bible:</strong> NCERT Biology is everything. Read it at least 20 times.</li>
                    <li><strong>Diagrams:</strong> Labeling questions are common. Don't ignore figures in NCERT.</li>
                    <li><strong>Scientist Names:</strong> Memorize every scientist mentioned in units.</li>
                    <li><strong>Unit Wise Weightage:</strong>
                        <ul>
                            <li>Genetics & Evolution (High Weightage: ~15 Qs)</li>
                            <li>Biotechnology (High ROI: Small chapters, ~7-8 Qs)</li>
                            <li>Human Physiology (Conceptual, ~12 Qs)</li>
                            <li>Ecology (Easy to score, ~10 Qs)</li>
                        </ul>
                    </li>
                </ul>

                <h5 style="color:#fbbf24; margin-bottom:5px;">üî≠ Physics (160+)</h5>
                <ul style="padding-left:20px; line-height: 1.8;">
                    <li><strong>Formula Sheet:</strong> Make a wall chart of all formulas. 60% of NEET Physics is formula-based.</li>
                    <li><strong>Don't skip Modern Physics:</strong> Atoms, Nuclei, Dual Nature, Semiconductors. These are easiest 20-24 marks.</li>
                    <li><strong>Mechanics:</strong> Focus on Graphs and Free Body Diagrams (FBD).</li>
                    <li><strong>Practice:</strong> Solve last 15 years PYQs (Previous Year Questions) at least twice.</li>
                </ul>

                <h5 style="color:#fbbf24; margin-bottom:5px;">üß™ Chemistry (170+)</h5>
                <ul style="padding-left:20px; line-height: 1.8;">
                    <li><strong>Inorganic:</strong> Pure Ratta (Memorization) from NCERT. Exceptions in P-block are gold.</li>
                    <li><strong>Organic:</strong> Understand GOC (General Organic Chemistry) deeply. Name reactions are must.</li>
                    <li><strong>Physical:</strong> Practice numericals. Don't just read theory.</li>
                </ul>
            </div>
        </div>

        <div class="guide-card">
            <div class="guide-header" onclick="toggleGuide(this)">
                <strong>üë∑ JEE Mains & Advanced Roadmap</strong> <span>‚ñº</span>
            </div>
            <div class="guide-content">
                <h4 style="color:var(--accent); margin-top:10px;">Engineering Excellence</h4>
                
                <h5 style="color:#fbbf24; margin-bottom:5px;">üßÆ Mathematics (The Rank Decider)</h5>
                <ul style="padding-left:20px; line-height: 1.8;">
                    <li><strong>Calculus:</strong> Limits, Continuity, Integration. This is the heart of JEE Maths.</li>
                    <li><strong>Vectors & 3D Geometry:</strong> High weightage and relatively easier to visualize.</li>
                    <li><strong>Coordinate Geometry:</strong> Conics can be lengthy but scoring if formulas are on tips.</li>
                </ul>

                <h5 style="color:#fbbf24; margin-bottom:5px;">‚öõÔ∏è Physics</h5>
                <ul style="padding-left:20px; line-height: 1.8;">
                    <li><strong>H.C. Verma:</strong> Must solve for concept building.</li>
                    <li><strong>Electrodynamics:</strong> Class 12th topics carry huge weightage.</li>
                    <li><strong>Thermodynamics:</strong> Common with Chemistry, study once, benefit twice.</li>
                </ul>
            </div>
        </div>

        <div class="guide-card">
            <div class="guide-header" onclick="toggleGuide(this)">
                <strong>üèÜ The 1% Club: Topper Habits</strong> <span>‚ñº</span>
            </div>
            <div class="guide-content">
                <ol style="padding-left:20px; line-height: 1.8;">
                    <li><strong>The Error Notebook:</strong> Write down every mistake you make in mock tests. Revise this notebook 1 hour before every exam. This prevents negative marking.</li>
                    <li><strong>The 50-10 Rule:</strong> Study for 50 mins with zero distraction, take 10 mins break. Repeat.</li>
                    <li><strong>Digital Minimalism:</strong> Uninstall Instagram/Snapchat. Your competition is studying while you are scrolling.</li>
                    <li><strong>Sleep:</strong> Your brain needs 7 hours to convert Short Term Memory to Long Term Memory. All-nighters are counter-productive.</li>
                    <li><strong>Mock Tests:</strong> Give tests in the actual exam time slot (e.g., 2-5 PM) to train your biological clock.</li>
                </ol>
            </div>
        </div>

        <div class="guide-card">
            <div class="guide-header" onclick="toggleGuide(this)">
                <strong>üîó Official & Free Resources</strong> <span>‚ñº</span>
            </div>
            <div class="guide-content">
                <div style="display:flex; flex-direction:column; gap:12px;">
                    <a href="https://neet.nta.nic.in/" target="_blank" class="btn btn-ghost" style="justify-content:flex-start;">üëâ Official NEET Website</a>
                    <a href="https://jeemain.nta.nic.in/" target="_blank" class="btn btn-ghost" style="justify-content:flex-start;">üëâ Official JEE Website</a>
                    <a href="https://ncert.nic.in/textbook.php" target="_blank" class="btn btn-ghost" style="justify-content:flex-start;">üëâ Download NCERT Books (PDF)</a>
                    <a href="https://swayam.gov.in/" target="_blank" class="btn btn-ghost" style="justify-content:flex-start;">üëâ Swayam (Free Govt Lectures)</a>
                </div>
            </div>
        </div>

      </div>
    </div>

    <div id="section-planner" class="hidden">
      <div class="glass-panel">
        <h2>ü§ñ AI Syllabus Planner</h2>
        <p style="color:var(--text-muted); font-size:13px; margin-bottom:15px;">Enter your chapters, and I'll tell you the daily target.</p>
        
        <label style="font-size:12px; color:var(--accent);">SYLLABUS (Comma separated or just number)</label>
        <textarea id="aiSyllabus" class="input" rows="4" placeholder="e.g. Physics Ch1, Ch2, Bio Ch5... OR just write '50'"></textarea>
        
        <label style="font-size:12px; color:var(--accent);">EXAM DATE</label>
        <div style="display:flex; gap:10px; margin-bottom:15px;">
          <input type="date" id="aiDate" class="input">
          <button class="btn btn-primary" onclick="generatePlan()">Generate Plan ‚ö°</button>
        </div>
        
        <div id="aiResult" style="margin-top:20px;"></div>
        
        <div class="ad-slot" style="margin-top:30px;">
             <span class="ad-label">Sponsored</span>
             <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5520401672645952" data-ad-slot="4459868531" data-ad-format="auto" data-full-width-responsive="true"></ins>
             <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
      </div>
    </div>

    <div id="section-notes" class="hidden">
      <div class="glass-panel" style="height:100%; display:flex; flex-direction:column;">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
          <h2>üìù Scratchpad</h2>
          <button class="btn btn-ghost" onclick="downloadNotes()">üíæ Save</button>
        </div>
        <div class="math-toolbar">
            <button class="math-btn" onclick="insSym('‚àö')">‚àö</button><button class="math-btn" onclick="insSym('Œ∏')">Œ∏</button><button class="math-btn" onclick="insSym('œÄ')">œÄ</button><button class="math-btn" onclick="insSym('¬≤')">x¬≤</button><button class="math-btn" onclick="insSym('Œî')">Œî</button><button class="math-btn" onclick="insSym('‚à´')">‚à´</button><button class="math-btn" onclick="insSym('‚Üí')">‚Üí</button><button class="math-btn" onclick="insSym('‚≠ê')">‚≠ê</button>
        </div>
        <textarea id="scratchpad" class="input" style="flex:1; resize:none; font-family:monospace; font-size:16px; line-height:1.6;" placeholder="Type notes here..."></textarea>
        
        <div style="margin-top:10px; height:50px; border:1px dashed rgba(255,255,255,0.1); border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:10px; color:#666;">
            Ad Space (Future)
        </div>
      </div>
    </div>

    <div id="section-settings" class="hidden">
      <div class="glass-panel">
        <h2>‚öôÔ∏è Settings</h2>
        
        <div style="margin-top:20px; background:rgba(255,255,255,0.02); padding:20px; border-radius:15px; border:1px solid rgba(255,255,255,0.05);">
           <label style="color:var(--accent); font-weight:bold;">üë§ ACCOUNT</label>
           <div style="display:flex; gap:10px; margin-top:10px;">
               <input id="editName" class="input" placeholder="Name">
               <input id="editExam" class="input" placeholder="Exam">
           </div>
           <button class="btn btn-ghost" style="width:100%;" onclick="updateProfile()">Update Profile</button>
        </div>

        <div style="margin-top:15px; background:rgba(255,255,255,0.02); padding:20px; border-radius:15px; border:1px solid rgba(255,255,255,0.05);">
            <label style="color:var(--accent); font-weight:bold;">üíæ DATA & BACKUP</label>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn btn-primary" style="flex:1;" onclick="exportData()">Export Data</button>
                <button class="btn btn-ghost" style="flex:1;" onclick="document.getElementById('importFile').click()">Import Data</button>
                <input type="file" id="importFile" style="display:none;" onchange="importData(this)">
            </div>
        </div>

        <div style="margin-top:15px; background:rgba(255,255,255,0.02); padding:20px; border-radius:15px; border:1px solid rgba(255,255,255,0.05);">
            <label style="color:var(--accent); font-weight:bold;">üé® APPEARANCE</label>
            <select id="themeSelect" class="input" onchange="changeTheme(this.value)" style="margin-top:10px;">
                <option value="mint">Mint Fresh</option>
                <option value="sunset">Sunset Vibes</option>
                <option value="amoled">Pitch Black (AMOLED)</option>
                <option value="cyber">Cyberpunk Neon</option>
                <option value="midnight">Midnight Blue</option>
            </select>
            
            <div style="margin-top:15px; display:flex; flex-direction:column; gap:10px;">
                <a href="privacy.html" style="color:var(--text-muted); text-decoration:none; font-size:13px;">üîí Privacy Policy</a>
                <button class="btn btn-danger" style="width:100%;" onclick="hardReset()">‚ö†Ô∏è Reset App</button>
            </div>
        </div>
      </div>
    </div>

  </main>
</div>
<div id="claimModal" class="modal hidden">
  <div class="glass-panel" style="max-width: 350px; text-align: center; border: 2px solid var(--accent);">
    <div style="font-size:50px;">ü¶Å</div>
    <h2>Hey Champ!</h2>
    <p style="color:var(--text-muted); margin-bottom:20px;">Did you honestly complete your daily goal?</p>
    <div style="display:flex; gap:10px; justify-content:center;">
        <button class="btn btn-ghost" onclick="document.getElementById('claimModal').classList.add('hidden')">No, I Failed</button>
        <button class="btn btn-primary" onclick="confirmClaim()">YES, I DID IT! üî•</button>
    </div>
  </div>
</div>

<script>
/* --- üß† STUDY ARC V5.0 ULTIMATE LOGIC --- */

// 1. STATE MANAGEMENT
let profile = JSON.parse(localStorage.getItem('st_profile'));
let tasks = JSON.parse(localStorage.getItem('st_tasks') || '[]');
let streak = parseInt(localStorage.getItem('st_streak') || '0');
let history = JSON.parse(localStorage.getItem('st_history') || '{}');
let notes = localStorage.getItem('st_notes') || '';
let theme = localStorage.getItem('st_theme') || 'mint';
let challenge = JSON.parse(localStorage.getItem('st_challenge') || '{"active":false, "name":"None", "target":0, "day":1, "lastClaim":0, "status":"active"}');

// Timer Globals
let timerInterval, endTime, currentSubject, wakeLock;
let isPaused = false, timeRemaining = 0, sessionDuration = 0;

// --- üöÄ INITIALIZATION ---
function init() {
  if(!profile) {
    document.getElementById('onboardingModal').classList.remove('hidden');
  } else {
    checkChallengeStatus();
    updateUI();
  }
  
  // Load Theme & Data
  document.body.className = `theme-${theme}`;
  document.getElementById('themeSelect').value = theme;
  document.getElementById('scratchpad').value = notes;
  document.getElementById('userAvatar').innerText = profile ? profile.name.charAt(0).toUpperCase() : 'A';
  
  renderTasks();
  renderChart();
  
  // Mobile: Close sidebar on click outside
  document.addEventListener('click', (e) => {
      if(window.innerWidth <= 768) {
          const sb = document.getElementById('sidebarMenu');
          const ham = document.querySelector('.hamburger');
          if (!sb.contains(e.target) && !ham.contains(e.target) && sb.classList.contains('active')) {
              toggleSidebar();
          }
      }
  });
}

// --- üì± MOBILE UI ---
function toggleSidebar() {
    const sb = document.getElementById('sidebarMenu');
    const ov = document.getElementById('mobileOverlay');
    sb.classList.toggle('active');
    ov.classList.toggle('active');
}

// --- üë§ PROFILE ---
function completeOnboarding() {
    const n = document.getElementById('obName').value;
    const e = document.getElementById('obClass').value;
    if(!n) { alert("Please enter your name!"); return; }
    
    profile = { name: n, exam: e };
    localStorage.setItem('st_profile', JSON.stringify(profile));
    document.getElementById('onboardingModal').classList.add('hidden');
    init(); // Reload UI
}

function updateUI() {
    if(profile) {
        document.getElementById('userGreet').innerText = `Hello, ${profile.name.split(' ')[0]}`;
        document.getElementById('userExam').innerText = profile.exam;
        document.getElementById('editName').value = profile.name;
        document.getElementById('editExam').value = profile.exam;
    }
    
    // Rank Logic
    let rank = "üå± Beginner";
    if(streak >= 7) rank = "üî• Spark";
    if(streak >= 21) rank = "ü¶Å Beast";
    if(streak >= 50) rank = "üëë GOD MODE";
    document.getElementById('rankDisplay').innerHTML = `<div style="font-size:16px;">${rank}</div><div style="font-size:10px;opacity:0.7;">${streak} Day Streak</div>`;

    // Challenge Widget
    const cBox = document.querySelector('.challenge-box');
    if(!challenge.active) {
        cBox.style.display = 'none';
    } else {
        cBox.style.display = 'block';
        document.getElementById('challengeText').innerText = challenge.name;
        document.getElementById('challengeDay').innerText = challenge.day;
        document.getElementById('challengeTarget').innerText = challenge.target;
        document.getElementById('challengeBar').style.width = `${(challenge.day/challenge.target)*100}%`;
        
        // Claim Button (Show only if not claimed today)
        const last = new Date(challenge.lastClaim).toDateString();
        const today = new Date().toDateString();
        const btn = document.getElementById('challengeControl');
        
        if(challenge.status !== 'failed' && last !== today) {
            btn.style.display = 'block';
        } else {
            btn.style.display = 'none';
        }
    }
    
    // Stats
    const totalT = tasks.length;
    const doneT = tasks.filter(t => t.status === 'completed').length;
    const failT = tasks.filter(t => t.status === 'failed').length;
    
    document.getElementById('statTotalTasks').innerText = totalT;
    document.getElementById('statCompletedTasks').innerText = doneT;
    document.getElementById('statPendingTasks').innerText = failT;
}

// --- ‚úÖ TASK MANAGER (Advanced) ---
function addTask() {
    const n = document.getElementById('newTaskName').value;
    if(n) {
        tasks.unshift({id: Date.now(), name: n, status: 'pending'}); // status: pending, completed, failed
        localStorage.setItem('st_tasks', JSON.stringify(tasks));
        renderTasks();
        document.getElementById('newTaskName').value = '';
    }
}

function renderTasks() {
    const list = document.getElementById('taskListContainer');
    list.innerHTML = '';
    
    tasks.forEach(t => {
        let statusClass = '';
        let icon = '‚¨ú'; // Default
        
        if(t.status === 'completed') { statusClass = 'completed'; icon = '‚úÖ'; }
        if(t.status === 'failed') { statusClass = 'failed'; icon = '‚ùå'; }
        
        list.innerHTML += `
        <div class="task-item ${statusClass}">
            <span style="font-weight:500; ${t.status!=='pending'?'text-decoration:line-through; opacity:0.6':''}">${t.name}</span>
            
            ${t.status === 'pending' ? `
            <div style="display:flex; gap:10px;">
                <button class="btn btn-ghost" style="padding:8px 12px; color:var(--success); border-color:var(--success);" onclick="markTask(${t.id}, 'completed')">‚úî</button>
                <button class="btn btn-ghost" style="padding:8px 12px; color:var(--danger); border-color:var(--danger);" onclick="markTask(${t.id}, 'failed')">‚úñ</button>
            </div>
            ` : `<span>${icon}</span>`}
        </div>`;
    });
    updateUI();
}

function markTask(id, status) {
    const t = tasks.find(x => x.id === id);
    if(t) {
        t.status = status;
        localStorage.setItem('st_tasks', JSON.stringify(tasks));
        renderTasks();
        if(status === 'completed') {
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        }
    }
}

function clearCompletedTasks() {
    if(confirm("Delete all Completed and Failed tasks?")) {
        tasks = tasks.filter(t => t.status === 'pending');
        localStorage.setItem('st_tasks', JSON.stringify(tasks));
        renderTasks();
    }
}

// --- ‚ö° FOCUS TIMER (With Warning & Logic) ---
function checkCustomSubject(el) {
    const inp = document.getElementById('customSubjectInput');
    if(el.value === "Other") {
        inp.style.display = 'block';
        inp.focus();
    } else {
        inp.style.display = 'none';
    }
}

function startQuickFocus() {
    const h = parseInt(document.getElementById('quickHrs').value)||0;
    const m = parseInt(document.getElementById('quickMins').value)||0;
    
    // Subject Logic
    let subj = document.getElementById('quickSubject').value;
    if(subj === "Other") {
        subj = document.getElementById('customSubjectInput').value;
        if(!subj) return alert("Please enter subject name!");
    }
    
    if(h===0 && m===0) return alert("Please set duration!");
    
    currentSubject = subj;
    sessionDuration = (h*3600) + (m*60);
    timeRemaining = sessionDuration;
    isPaused = false;
    
    document.getElementById('focusOverlay').classList.add('active');
    document.getElementById('focusSubjectDisplay').innerText = currentSubject;
    
    try { wakeLock = navigator.wakeLock.request('screen'); } catch(e){}
    runTimer();
}

function runTimer() {
    clearInterval(timerInterval);
    endTime = Date.now() + (timeRemaining * 1000);
    updateTimerDisplay();
    
    timerInterval = setInterval(() => {
        if(isPaused) return;
        const diff = Math.ceil((endTime - Date.now())/1000);
        
        if(diff <= 0) {
            finishFocus();
        } else {
            timeRemaining = diff;
            updateTimerDisplay();
        }
    }, 1000);
}

function updateTimerDisplay() {
    const h = Math.floor(timeRemaining/3600).toString().padStart(2,'0');
    const m = Math.floor((timeRemaining%3600)/60).toString().padStart(2,'0');
    const s = (timeRemaining%60).toString().padStart(2,'0');
    document.getElementById('focusTimerDisplay').innerText = `${h}:${m}:${s}`;
}

function toggleTimer() {
    isPaused = !isPaused;
    const btn = document.getElementById('btnPause');
    if(isPaused) {
        clearInterval(timerInterval);
        btn.innerText = "‚ñ∂ Resume";
        btn.style.background = "rgba(255,255,255,0.2)";
    } else {
        runTimer();
        btn.innerText = "‚è∏ Pause";
        btn.style.background = "transparent";
    }
}

function attemptExitFocus() {
    // üö® WARNING SYSTEM
    if(confirm("‚ö†Ô∏è Give Up?\nIf you stop now, only the time you studied will be saved.\n\nAre you sure?")) {
        exitFocus();
    }
}

function finishFocus() {
    const audio = new AudioContext(); 
    const osc = audio.createOscillator(); osc.connect(audio.destination); osc.start(); osc.stop(audio.currentTime+0.5);
    alert("üî• Session Complete! Well done!");
    exitFocus();
}

function exitFocus() {
    clearInterval(timerInterval);
    if(wakeLock) wakeLock.release();
    document.getElementById('focusOverlay').classList.remove('active');
    
    // Calculate ACTUAL time spent
    let actualTime = sessionDuration - timeRemaining;
    if(actualTime < 0) actualTime = sessionDuration; // If finished naturally
    
    if(actualTime > 60) { // Save only if > 1 min
        if(!history[currentSubject]) history[currentSubject] = 0;
        history[currentSubject] += actualTime;
        localStorage.setItem('st_history', JSON.stringify(history));
    }
    
    updateUI(); renderChart();
    // Refresh to reset timer states cleanly
    setTimeout(()=> location.reload(), 500); 
}

// --- üèÜ CHALLENGES ---
function startChallenge() {
    const name = document.getElementById('challengeNameInput').value;
    const days = document.getElementById('challengeDaysInput').value;
    if(!name) return alert("Enter challenge name!");
    
    if(confirm(`Start "${name}" for ${days} Days?\nThis will reset your current challenge progress.`)) {
        challenge = { active: true, name: name, target: parseInt(days), day: 1, lastClaim: 0, status: "active" };
        localStorage.setItem('st_challenge', JSON.stringify(challenge));
        alert("Challenge Started! Good Luck ü¶Å");
        updateUI();
    }
}

function checkChallengeStatus() {
    if(!challenge.active || challenge.lastClaim === 0) return;
    const diff = Math.floor((new Date() - new Date(challenge.lastClaim)) / (1000*60*60*24));
    
    if(diff > 1) { // Missed a day
        challenge.status = "failed";
        // Optional: Auto reset or show failed state
    }
    localStorage.setItem('st_challenge', JSON.stringify(challenge));
}

function openClaimModal() { document.getElementById('claimModal').classList.remove('hidden'); }

function confirmClaim() {
    streak++;
    challenge.day++;
    challenge.lastClaim = Date.now();
    challenge.status = 'active'; // Unfreeze
    
    if(challenge.day > challenge.target) {
        alert("üèÜ CONGRATULATIONS! CHALLENGE COMPLETED!");
        challenge.active = false;
    }
    
    localStorage.setItem('st_streak', streak);
    localStorage.setItem('st_challenge', JSON.stringify(challenge));
    
    document.getElementById('claimModal').classList.add('hidden');
    confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
    updateUI();
}

// --- ü§ñ AI PLANNER (Smart Regex) ---
function generatePlan() {
    const txt = document.getElementById('aiSyllabus').value;
    const date = document.getElementById('aiDate').value;
    if(!txt || !date) return alert("Please fill all details!");
    
    let count = 0;
    // Smart Check: Number vs List
    if(!isNaN(txt) && txt.trim().length > 0) {
        count = parseInt(txt);
    } else {
        count = txt.split(',').filter(x=>x.trim()!=='').length;
    }
    
    const days = Math.ceil((new Date(date) - new Date())/(1000*60*60*24));
    
    if(days <= 0) return alert("Exam date must be in future!");
    if(count === 0) return alert("Enter chapters correctly!");
    
    const rate = (count/days).toFixed(1);
    
    document.getElementById('aiResult').innerHTML = `
    <div style="background:rgba(255,255,255,0.1); padding:20px; border-radius:15px; border:1px solid var(--accent);">
        <h3 style="margin:0 0 10px 0; color:var(--accent);">üöÄ Target: ${rate} Chapters/Day</h3>
        <p style="margin:0; font-size:14px;">To finish <strong>${count} Chapters</strong> in <strong>${days} Days</strong>.</p>
        <div style="margin-top:10px; font-size:12px; opacity:0.7;">Tip: Use the 'Focus Timer' to hit this goal!</div>
    </div>`;
}

// --- üìä CHART & UTILS ---
function renderChart() {
    const ctx = document.getElementById('subjectChart').getContext('2d');
    const data = Object.values(history).map(s => (s/3600).toFixed(1));
    const labels = Object.keys(history);
    
    if(window.myChart) window.myChart.destroy();
    
    window.myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: labels.length ? labels : ['No Data'],
            datasets: [{
                data: data.length ? data : [1],
                backgroundColor: ['#34d399', '#38bdf8', '#fbbf24', '#ef4444', '#a78bfa'],
                borderWidth: 0
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%'
        }
    });
}

// Helper Functions
function showSection(id) {
    if(window.innerWidth <= 768) {
        document.getElementById('sidebarMenu').classList.remove('active');
        document.getElementById('mobileOverlay').classList.remove('active');
    }
    document.querySelectorAll('[id^="section-"]').forEach(d => d.classList.add('hidden'));
    document.getElementById(`section-${id}`).classList.remove('hidden');
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
}

function updateProfile() {
    const n = document.getElementById('editName').value;
    const e = document.getElementById('editExam').value;
    if(n) { 
        profile.name = n; profile.exam = e; 
        localStorage.setItem('st_profile', JSON.stringify(profile)); 
        updateUI(); alert("Profile Updated!"); 
    }
}

function toggleGuide(el) {
    el.nextElementSibling.classList.toggle('open');
    const span = el.querySelector('span');
    span.innerText = span.innerText === '‚ñº' ? '‚ñ≤' : '‚ñº';
}

function exportData() {
    const d = {profile, tasks, history, notes, challenge, streak};
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([JSON.stringify(d)], {type:'application/json'}));
    a.download = 'StudyArc_Backup.json'; a.click();
}

function importData(input) {
    const r = new FileReader();
    r.onload = e => {
        try {
            const d = JSON.parse(e.target.result);
            localStorage.setItem('st_profile', JSON.stringify(d.profile));
            localStorage.setItem('st_history', JSON.stringify(d.history));
            localStorage.setItem('st_tasks', JSON.stringify(d.tasks));
            localStorage.setItem('st_challenge', JSON.stringify(d.challenge));
            alert("Data Restored Successfully!"); location.reload();
        } catch(err) { alert("Invalid Backup File!"); }
    };
    if(input.files[0]) r.readAsText(input.files[0]);
}

function changeTheme(v) { 
    localStorage.setItem('st_theme', v); 
    document.body.className = `theme-${v}`; 
}

function hardReset() { 
    if(confirm("‚ö†Ô∏è ARE YOU SURE?\nThis will delete ALL data permanently.")) { 
        localStorage.clear(); 
        location.reload(); 
    } 
}

function downloadNotes() { 
    const b = new Blob([document.getElementById('scratchpad').value], {type:'text/plain'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'Notes.txt'; a.click(); 
}

function insSym(s) { 
    const ta = document.getElementById('scratchpad'); 
    ta.value += s; 
    localStorage.setItem('st_notes', ta.value); 
}
document.getElementById('scratchpad').addEventListener('input', e => localStorage.setItem('st_notes', e.target.value));

// Init App
init();

// Service Worker (Offline Support)
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
}
</script>
</body>
</html>