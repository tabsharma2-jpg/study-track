<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.2, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#2a0845">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Study Arc V7.0 â€” Ultimate</title>
<link rel="icon" href="icons/app-logo-192.png" type="image/png">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';</script>
<script>
  // 1. Permission Maango (Jab App load ho)
  function requestNotifyPermission() {
    if (!("Notification" in window)) {
      console.log("Browser does not support notifications");
      return;
    }
    
    if (Notification.permission !== "granted") {
      Notification.requestPermission().then(permission => {
        if (permission === "granted") {
          sendLocalNotification("Welcome Abhinav!", "Notifications are active now. ğŸš€");
        }
      });
    }
  }

  // 2. Notification Bhejne wala function
  function sendLocalNotification(title, body) {
    if (Notification.permission === "granted") {
      // Mobile pe vibration ke liye
      if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
      
      const notif = new Notification(title, {
        body: body,
        icon: 'icons/app-logo-192.png', // Make sure icon folder me ye image ho
        vibrate: [200, 100, 200],
        tag: 'study-arc-alert'
      });
      
      // Notification par click karne par app khul jaye
      notif.onclick = function() {
        window.focus();
        notif.close();
      };
    }
  }

  // Page load hote hi permission maang lo
  window.addEventListener('load', requestNotifyPermission);
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5520401672645952"
     crossorigin="anonymous"></script>
<style>
/* --- ğŸ¨ STUDY ARC V7.0 ULTIMATE CSS --- */

:root {
  --font-main: 'Inter', system-ui, -apple-system, sans-serif;
  --glass-bg: rgba(255, 255, 255, 0.07);
  --glass-border: 1px solid rgba(255, 255, 255, 0.15);
  --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
  --backdrop: blur(20px);
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  
  /* ğŸŒ… Theme: Sunset (Default) */
  --bg-gradient: linear-gradient(135deg, #2a0845 0%, #6441a5 100%);
  --sidebar-bg: rgba(20, 5, 40, 0.6);
  --accent: #fbbf24; 
  --accent-grad: linear-gradient(135deg, #fbbf24, #f59e0b);
  --text: #ffffff;
  --text-muted: rgba(255, 255, 255, 0.7);
  --card-bg: rgba(255, 255, 255, 0.05);
  --danger: #ef4444;
  --success: #10b981;
}

/* ğŸŒ‘ Theme: Midnight Blue */
body.theme-midnight { 
    --bg-gradient: linear-gradient(135deg, #02111b 0%, #0c2d48 100%); 
    --sidebar-bg: rgba(2, 10, 20, 0.8);
    --accent: #5da9e9; --accent-grad: linear-gradient(135deg, #4facfe, #00f2fe); 
}

/* ğŸ‘‘ Theme: Royal Gold */
body.theme-royal { 
    --bg-gradient: linear-gradient(135deg, #1c1c1c 0%, #3a3a3a 100%); 
    --sidebar-bg: rgba(0, 0, 0, 0.8);
    --accent: #ffd700; --accent-grad: linear-gradient(135deg, #fceabb, #f8b500); 
    --glass-border: 1px solid rgba(255, 215, 0, 0.3);
}

/* ğŸ’» Theme: Matrix */
body.theme-matrix { 
    --bg-gradient: #000000; 
    --sidebar-bg: #050505;
    --accent: #00ff00; --accent-grad: linear-gradient(135deg, #00ff00, #008f00); 
    --text: #e0ffe0; --glass-border: 1px solid #00ff00;
}

/* ğŸ”’ GLOBAL LOCK */
* { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
/* âœ… à¤¨à¤¯à¤¾ à¤•à¥‹à¤¡ (Zoom Fix) */
html, body { 
    margin: 0; padding: 0; 
    font-size: 16px;
    font-family: var(--font-main); 
    background: var(--bg-gradient); 
    color: var(--text); 
    width: 100%; height: 100%; 
    overflow: hidden; 
    
    /* ğŸ”¥ à¤¸à¤¬à¤¸à¥‡ à¤œà¤°à¥‚à¤°à¥€ à¤²à¤¾à¤‡à¤¨à¥‡à¤‚: Zoom à¤°à¥‹à¤•à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ ğŸ”¥ */
    touch-action: pan-x pan-y; 
    -webkit-text-size-adjust: 100%;
    overscroll-behavior: none;
    
    -webkit-user-select: none; 
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}
/* Main Layout */
.app-container { 
    max-width: 1400px; margin: 0 auto; padding: 15px; 
    display: grid; grid-template-columns: 280px 1fr; gap: 20px; 
    height: 100vh; overflow-y: auto; position: relative; 
}

/* âœ¨ Premium Components (High Contrast) */
.glass-panel { 
    background: var(--card-bg); backdrop-filter: var(--backdrop); -webkit-backdrop-filter: var(--backdrop); 
    border: var(--glass-border); border-radius: 24px; box-shadow: var(--glass-shadow); padding: 24px; 
    overflow-y: auto; transition: var(--transition); position: relative;
}
/* Double Border Effect for Visibility */
.glass-panel::after {
    content: ''; position: absolute; inset: 0; border-radius: 24px; padding: 1px; 
    background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0)); 
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor; mask-composite: exclude; pointer-events: none;
}

.btn { border: none; padding: 12px 24px; border-radius: 14px; font-weight: 700; cursor: pointer; transition: var(--transition); display: inline-flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; letter-spacing: 0.5px; }
.btn:active { transform: scale(0.96); }
.btn-primary { background: var(--accent-grad); color: #000; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
.btn-ghost { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); }
.btn-danger { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.4); }

.input { 
    width: 100%; padding: 16px; 
    background: rgba(0,0,0,0.4); 
    border: 1px solid rgba(255,255,255,0.15); 
    border-radius: 14px; 
    color: white; 
    margin-bottom: 15px; 
    font-family: var(--font-main); 
    transition: 0.3s;
    font-size: 16px; /* ğŸš¨ Important: Stops zoom on mobile */
}
.input:focus { border-color: var(--accent); background: rgba(0,0,0,0.6); outline: none; }

/* ğŸ§Š Sidebar (Fixed Scroll) */
.sidebar { 
    display: flex; flex-direction: column; gap: 10px; height: 100%; z-index: 900; 
    background: var(--sidebar-bg); border-right: 1px solid rgba(255,255,255,0.05);
    border-radius: 24px; padding: 20px;
    overflow-y: auto; /* âœ… Scroll enabled */
}
.brand { font-size: 26px; font-weight: 900; letter-spacing: -1px; background: var(--accent-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; margin-bottom: 10px; }

.nav-item { padding: 14px; border-radius: 14px; cursor: pointer; transition: 0.2s; color: var(--text-muted); display: flex; align-items: center; gap: 15px; font-weight: 600; font-size: 15px; }
.nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.1); color: var(--accent); border-left: 4px solid var(--accent); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

/* âœ… à¤¨à¤¯à¤¾ à¤«à¤¿à¤•à¥à¤¸à¥à¤¡ à¤•à¥‹à¤¡ */
.challenge-box-premium { 
    border: 1px solid var(--glass-border); 
    padding: 15px; 
    border-radius: 18px; 
    text-align: center; 
    background: rgba(0,0,0,0.3); 
    
    /* ğŸ”¥ margin-top: auto HATA DIYA ğŸ”¥ */
    margin-bottom: 20px; /* à¤¤à¤¾à¤•à¥€ à¤¨à¥€à¤šà¥‡ à¤µà¤¾à¤²à¥‡ à¤®à¥‡à¤¨à¥‚ à¤¸à¥‡ à¤¥à¥‹à¤¡à¤¼à¤¾ à¤—à¥ˆà¤ª à¤°à¤¹à¥‡ */
    
    box-shadow: inset 0 0 20px rgba(0,0,0,0.5); 
}
/* ğŸ†” Header & User Box */
.header-glass { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.user-box { 
    display: flex; align-items: center; gap: 12px; background: rgba(0,0,0,0.3); 
    padding: 8px 20px 8px 8px; border-radius: 50px; border: 1px solid var(--glass-border);
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}
.avatar-circle { width: 38px; height: 38px; border-radius: 50%; background: var(--accent-grad); display: flex; align-items: center; justify-content: center; font-weight: bold; color: black; font-size: 18px; }

/* âš¡ XP & Countdown Cards */
.info-card { 
    background: rgba(0,0,0,0.2); border-radius: 20px; padding: 20px; 
    border: 1px solid var(--glass-border); margin-bottom: 15px; position: relative; overflow: hidden;
}
.xp-bar-bg { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-top: 10px; }
.xp-bar-fill { height: 100%; background: var(--accent-grad); width: 0%; transition: width 0.5s ease; box-shadow: 0 0 10px var(--accent); }

/* ğŸ“š Syllabus Wizard */
.wizard-step { display: none; animation: fadeIn 0.3s ease; }
.wizard-step.active { display: block; }
/* âœ… FORMULA WIZARD FIX (Add this) */
.fw-step { display: none; animation: fadeIn 0.3s ease; }
.fw-step.active { display: block; }
.selection-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px; }
.select-btn { padding: 20px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: 15px; text-align: center; cursor: pointer; transition: 0.2s; font-weight: bold; }
.select-btn.selected { background: var(--accent); color: black; border-color: var(--accent); transform: scale(1.05); }

/* âœ… Tasks (V5 Style - Tick/Cross on Right) */
.task-row { 
    display: flex; align-items: center; justify-content: space-between; 
    padding: 15px; margin-bottom: 10px; background: rgba(0,0,0,0.3); 
    border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; 
}
.task-actions { display: flex; gap: 10px; }
.btn-icon { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: none; font-size: 14px; }

/* ğŸ›’ Shop Item */
.shop-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 15px; margin-bottom: 10px; border: 1px solid var(--glass-border); }

/* ğŸ§˜ Focus Overlay */
#focusOverlay { position: fixed; inset: 0; background: var(--bg-gradient); z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; }
#focusOverlay.active { display: flex; } 

/* ğŸ“± Mobile Styling */
.mobile-header { display: none; justify-content: space-between; align-items: center; padding-bottom: 15px; }
.overlay-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 800; display: none; backdrop-filter: blur(8px); }

/* --- ğŸ“± MOBILE FIX START --- */
@media (max-width: 1200px) {
  .app-container { 
      grid-template-columns: 1fr; 
      padding: 15px; 
      height: 100vh; 
      overflow-y: auto; 
      display: block; 
  }
  
  .sidebar { 
      position: fixed; top: 0; left: -350px; width: 280px; height: 100%; 
      /* ğŸ”¥ Z-Index increased for APK touch fix */
      z-index: 10000; 
      transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
      will-change: left;
      transform: translateZ(0); /* Hardware Acceleration */
      box-shadow: 10px 0 50px rgba(0,0,0,0.9);
      background: var(--sidebar-bg);
      backdrop-filter: blur(20px);
  }
  
  .sidebar.active { left: 0; }
  
  .overlay-bg.active { 
      display: block; 
      z-index: 9999;
  }
  
  .mobile-header { 
      display: flex; 
      position: relative;
      z-index: 1001;
      align-items: center;
  }

  /* Fix for Hamburger Click Area */
  .mobile-header button {
      cursor: pointer;
      padding: 10px;
      margin: -10px;
      z-index: 1002;
  }
  
  .main-content { padding-bottom: 100px; }
  #focusOverlay .timer-huge { font-size: 70px; }
}
/* --- ğŸ“± MOBILE FIX END --- */

/* Animations */
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.hidden { display: none !important; }
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(15px); z-index: 6000; display: flex; align-items: center; justify-content: center; }
/* --- ğŸ“Š V5 STYLE BIG STATS (Syllabus & Tasks) --- */
.v5-stats-container {
    display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; 
    margin-bottom: 20px; background: rgba(0,0,0,0.2); 
    padding: 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
}
.v5-stat-box {
    background: rgba(255,255,255,0.05); border-radius: 15px; padding: 10px; text-align: center;
    border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; align-items: center; justify-content: center;
}
.v5-val { font-size: 22px; font-weight: 900; color: white; }
.v5-lbl { font-size: 10px; text-transform: uppercase; opacity: 0.7; margin-top: 5px; font-weight: bold; }

/* --- ğŸ“š SYLLABUS GREEN SELECTION --- */
.chapter-select-row {
    padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; margin-bottom: 8px;
    display: flex; align-items: center; gap: 12px; cursor: pointer; border: 1px solid transparent; transition: 0.2s;
}
.chapter-select-row.selected {
    background: rgba(16, 185, 129, 0.2); /* Green Tint */
    border-color: #10b981;
    color: #10b981;
    font-weight: bold;
}
.chapter-circle { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; }
.chapter-select-row.selected .chapter-circle { background: #10b981; border-color: #10b981; }
/* --- ğŸ¨ NEW FREE THEMES --- */
body.theme-ocean { --bg-gradient: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%); --accent: #00ffff; --sidebar-bg: rgba(0,20,50,0.8); }
body.theme-nebula { --bg-gradient: linear-gradient(135deg, #8E2DE2 0%, #4A00E0 100%); --accent: #ff00cc; --sidebar-bg: rgba(30,0,50,0.8); }
/* ğŸŒŒ Theme: Aura Night (Deep Purple & Pink) */
body.theme-aura { 
    --bg-gradient: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%); 
    --sidebar-bg: rgba(15, 12, 41, 0.8);
    --accent: #ff0080; 
    --accent-grad: linear-gradient(135deg, #ff0080, #7928ca); 
    --glass-border: 1px solid rgba(255, 0, 128, 0.3);
}

/* â„ï¸ Theme: Arctic Frost (Clean & Professional) */
body.theme-arctic { 
    --bg-gradient: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%); 
    --sidebar-bg: rgba(255, 255, 255, 0.7);
    --accent: #00796b; 
    --accent-grad: linear-gradient(135deg, #00796b, #004d40); 
    --text: #002d2d; 
    --text-muted: rgba(0, 45, 45, 0.7);
    --card-bg: rgba(0, 0, 0, 0.05);
    --glass-border: 1px solid rgba(0, 121, 107, 0.2);
}
/* ğŸ¥ Soft Mint Theme (Doctor Mode) */
body.theme-mint { 
    --bg-gradient: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); 
    --sidebar-bg: rgba(255, 255, 255, 0.8);
    --accent: #16a34a; 
    --accent-grad: linear-gradient(135deg, #16a34a, #15803d); 
    --text: #14532d; 
    --text-muted: rgba(20, 83, 45, 0.7);
    --card-bg: rgba(255, 255, 255, 0.4);
    --glass-border: 1px solid rgba(22, 163, 74, 0.2);
}
/* ğŸ¤– Theme: Cyber Focus (Futuristic & Sharp) */
body.theme-cyber { 
    --bg-gradient: linear-gradient(135deg, #0f172a 0%, #020617 100%); 
    --sidebar-bg: rgba(2, 6, 23, 0.9);
    --accent: #06b6d4; 
    --accent-grad: linear-gradient(135deg, #06b6d4, #3b82f6); 
    --text: #e2e8f0;
    --glass-border: 1px solid rgba(6, 182, 212, 0.3);
    --card-bg: rgba(15, 23, 42, 0.6);
}

/* â˜• Theme: Midnight Coffee (Warm, Cozy & Relaxing) */
body.theme-coffee { 
    --bg-gradient: linear-gradient(135deg, #1c1917 0%, #292524 100%); 
    --sidebar-bg: rgba(28, 25, 23, 0.9);
    --accent: #d97706; 
    --accent-grad: linear-gradient(135deg, #d97706, #fbbf24); 
    --text: #fafaf9;
    --glass-border: 1px solid rgba(217, 119, 6, 0.3);
    --card-bg: rgba(41, 37, 36, 0.6);
}
</style>
</head>
<body class="theme-sunset">

<canvas id="confetti-canvas" style="position:fixed; pointer-events:none; top:0; left:0; width:100%; height:100%; z-index:100;"></canvas>
<div id="mobileOverlay" class="overlay-bg" onclick="toggleSidebar()"></div>

<div id="onboardingModal" class="modal hidden">
  <div class="glass-panel" style="max-width: 350px; text-align: center; border: 1px solid var(--accent);">
    <div style="font-size: 50px; margin-bottom: 15px;">ğŸš€</div>
    <h2 style="margin-bottom: 5px;">Setup Profile</h2>
    <p style="font-size:12px; margin-bottom:15px; opacity:0.7;">Let's customize your journey.</p>
    
    <input id="obName" class="input" placeholder="Your Name" style="margin-bottom: 10px;">
    <input id="obExamName" class="input" placeholder="Target Exam (e.g. NEET 2027)" style="margin-bottom: 10px;">
    
    <label style="font-size:12px; display:block; text-align:left; margin-bottom:5px; margin-left:5px;">Exam Date:</label>
    <input id="obTarget" class="input" type="date" style="margin-bottom: 15px;">
    
    <button class="btn btn-primary" style="width:100%;" onclick="completeOnboarding()">Start Journey ğŸ¯</button>
  </div>
</div>

<div id="focusOverlay" style="display:none;">
  <div style="font-size: 14px; letter-spacing: 3px; color: var(--accent); opacity: 0.8; margin-bottom: 10px;">CURRENT SESSION</div>
  <div style="font-size: 32px; font-weight: bold; color: white; margin-bottom: 20px;" id="focusSubjectDisplay">SUBJECT</div>
  
  <div class="timer-huge" id="focusTimerDisplay" style="font-size: 80px; font-weight: 900; background: var(--accent-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 10px 0;">00:00:00</div>
  <div id="endTimeDisplay" style="font-size:16px; color:var(--accent); font-weight:bold; margin-bottom:20px; letter-spacing:1px;"></div>
  
  <div style="display: flex; gap: 15px;">
    <button id="btnPause" class="btn btn-ghost" style="padding: 15px 25px; border:1px solid white;" onclick="toggleTimer()">â¸ï¸ Pause</button>
    <button class="btn btn-primary" style="padding: 15px 30px;" onclick="finishFocus()">âœ… Finish</button>
  </div>
  
  <button class="btn btn-danger" style="margin-top: 30px; font-size: 12px; opacity: 0.8;" onclick="giveUpFocus()">ğŸ³ï¸ Give Up (Exit)</button>
</div>
<div class="app-container">
  
  <div class="mobile-header">
      <button style="font-size: 28px; background: none; border: none; color: white;" onclick="toggleSidebar()">â˜°</button>
      <div class="brand" style="font-size: 20px; margin:0;">STUDY ARC</div>
      <div style="width: 30px;"></div> 
  </div>

  <aside class="sidebar" id="sidebarMenu">
    <div class="brand">STUDY ARC <span style="font-size:10px; color:var(--accent); vertical-align: super;">V7</span></div>
    
    <div class="challenge-box-premium" id="challengeWidget" style="display:none;">
        <div style="font-size:10px; font-weight:bold; color:var(--accent); margin-bottom:5px; text-transform:uppercase; letter-spacing:1px;">Active Challenge</div>
        <div id="challengeText" style="font-size:20px; font-weight:900; color:white; margin-bottom:5px;">75 Hard</div>
        <div style="font-size:12px; opacity:0.8;">Day <span id="challengeDay">1</span> of <span id="challengeTarget">75</span></div>
        <div style="margin-top:8px; height:4px; background:rgba(255,255,255,0.1); border-radius:2px;">
            <div id="challengeBarSidebar" style="height:100%; width:0%; background:var(--accent); border-radius:2px;"></div>
        </div>
        <div id="challengeMedal" style="font-size:30px; margin-top:10px; display:none;">ğŸ¥‡</div>
    </div>

    <nav style="display: flex; flex-direction: column; gap: 5px; margin-top:20px;">
      <div class="nav-item active" onclick="showSection('dashboard', this)">ğŸ  Dashboard</div>
      <div class="nav-item" onclick="showSection('syllabus', this)">ğŸ“š Syllabus Wizard</div>
      <div class="nav-item" onclick="showSection('tasks', this)">âœ… Task Manager</div>
      <div class="nav-item" onclick="showSection('challenges', this)">ğŸ† Challenges</div>
      <div class="nav-item" onclick="showSection('guide', this)">â„¹ï¸ Exam Guide</div>
      <div class="nav-item" onclick="showSection('notes', this)">ğŸ““ Mistake Notebook</div>
      <div class="nav-item" onclick="showSection('formulas', this)">ğŸ“ Formula Wizard</div>
      <div class="nav-item" onclick="showSection('settings', this)">âš™ï¸ Settings</div>
    </nav>
  </aside>

  <main class="main-content">
    
<div id="section-dashboard">
      
      <div class="header-glass">
        <div class="user-box" style="border: 1px solid var(--accent); background: rgba(0,0,0,0.4); padding: 10px 20px;">
            <div class="avatar-circle" id="userAvatar">A</div>
            <div>
                <span id="userGreet" style="font-size:15px; font-weight:700;">Hello</span>
                <div id="userExamDisplay" style="font-size:10px; opacity:0.8; color:var(--accent);">Exam Target</div>
            </div>
        </div>
        
        <div class="user-box" style="gap:5px; border: 1px solid var(--success); background: rgba(0,0,0,0.4); padding: 10px 20px;">
            <span style="font-size:16px;">ğŸ”¥</span> 
            <div style="display:flex; flex-direction:column; align-items:flex-end;">
                <span id="streakDisplay" style="font-weight:800; font-size:14px;">0</span>
                <span style="font-size:8px; opacity:0.7; letter-spacing:1px;">BEGINNER</span>
            </div>
        </div>
      </div>

      <div class="glass-panel" style="padding:15px; text-align:center; margin-bottom:15px; border-left: 3px solid var(--accent); display:flex; align-items:center; justify-content:center;">
          <i style="font-size:13px; font-style:italic;" id="dailyQuote">"Your competition is not others. Your competition is your procrastination."</i>
      </div>

      <div class="info-card" style="border: 1px solid var(--accent); background: rgba(0,0,0,0.3);">
          <div style="display:flex; justify-content:space-between; align-items:center;">
              <div>
                  <div style="font-size:10px; text-transform:uppercase; letter-spacing:1px; color:var(--accent);">Time Remaining</div>
                  <div style="font-size:24px; font-weight:900;" id="daysLeftDisplay">000 Days</div>
                  <div style="font-size:12px; opacity:0.7;">Until <span id="targetDateDisplay">Big Day</span></div>
              </div>
              <div style="font-size:40px;">â³</div>
          </div>
      </div>

      <div class="info-card" style="border: 1px solid rgba(255,255,255,0.2);">
          <div style="display:flex; justify-content:space-between; align-items:center;">
              <div>
                  <h3 style="margin:0; font-size:18px;">Level <span id="userLevel">1</span></h3>
                  <div style="font-size:12px; color:var(--text-muted);" id="userRankTitle">Novice Student</div>
              </div>
              <div style="text-align:right;">
                  <div style="font-size:14px; font-weight:bold; color:var(--accent);"><span id="currentXP">0</span> XP</div>
              </div>
          </div>
          <div class="xp-bar-bg">
              <div class="xp-bar-fill" id="xpBar"></div>
          </div>
      </div>

      <div class="glass-panel" style="margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1);">
        <h3 style="margin:0 0 15px 0;">âš¡ Quick Focus</h3>
        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 10px;">
            <select id="quickSubject" class="input" style="margin:0;" onchange="checkCustomSubject(this)">
                <option value="Physics">Physics</option>
                <option value="Chemistry">Chemistry</option>
                <option value="Biology">Biology</option>
                <option value="Other">Other...</option>
            </select>
            <input id="customSubjectInput" class="input" placeholder="Subject" style="margin:0; display:none;">
           <input id="quickHrs" type="number" min="0" class="input" placeholder="Hr" value="0" style="margin:0;">
            <input id="quickMins" type="number" min="0" class="input" placeholder="Min" value="45" style="margin:0;">
            <button class="btn btn-primary" onclick="startQuickFocus()">â–¶</button>
        </div>
      </div>
<div style="text-align:center; margin-top: 20px;">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5520401672645952"
         crossorigin="anonymous"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-5520401672645952"
         data-ad-slot="2938617898"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
    </div>

   <div id="section-syllabus" class="hidden">
      <div class="glass-panel">
        
        <div id="wiz-step-1" class="wizard-step active">
            <h2 style="text-align:center;">Select Class ğŸ“š</h2>
            <div class="selection-grid">
                <div class="select-btn" onclick="wizSelectClass('11')">Class 11th</div>
                <div class="select-btn" onclick="wizSelectClass('12')">Class 12th</div>
            </div>
        </div>

        <div id="wiz-step-2" class="wizard-step">
            <h2 style="text-align:center;">Target Exam ğŸ¯</h2>
            <div class="selection-grid">
                <div class="select-btn" onclick="wizSelectExam('NEET')">NEET (Medical)</div>
                <div class="select-btn" onclick="wizSelectExam('JEE')">JEE (Engineering)</div>
            </div>
        </div>

        <div id="wiz-step-3" class="wizard-step">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>Select Chapters</h3>
                <button class="btn btn-primary" onclick="wizGenerateGoal()">Create Goal</button>
            </div>
            <div id="wiz-chapter-container" style="margin-top:15px; max-height:60vh; overflow-y:auto;"></div>
        </div>

        <div id="wiz-active-dashboard" class="wizard-step">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h2 style="margin:0;">Weekly Goal</h2>
                <div style="font-size:12px; color:var(--accent);">Resets on Sunday</div>
            </div>

            <div class="v5-stats-container">
                <div class="v5-stat-box"><div class="v5-val" id="weekTotalCount">0</div><div class="v5-lbl">Total Goal</div></div>
                <div class="v5-stat-box"><div class="v5-val" id="weekDoneCount" style="color:var(--success);">0</div><div class="v5-lbl">Completed</div></div>
                <div class="v5-stat-box"><div class="v5-val" id="weekPendingCount" style="color:var(--danger);">0</div><div class="v5-lbl">Pending</div></div>
            </div>
            
            <div id="active-goal-list" style="display:grid; gap:10px; margin-top:20px;"></div>
            
            <button id="claimSyllabusXPBtn" class="btn btn-success" style="width:100%; margin-top:20px; display:none; box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);" onclick="claimSyllabusXP()">ğŸ Claim 100 XP (Goal Progress)</button>

            <div style="margin-top:20px; display:flex; gap:10px;">
                <button class="btn btn-ghost" style="flex:1;" onclick="resetSyllabusWizard()">ğŸ”„ Reset Goal</button>
                <button class="btn btn-primary" style="flex:1;" onclick="downloadReport()">ğŸ“¥ Report</button>
            </div>
        </div>

      </div>
    </div>
   <div id="section-tasks" class="hidden">
        <div class="glass-panel">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2>âœ… Task Manager</h2>
                <button class="btn btn-danger" style="font-size: 11px; padding: 5px 10px;" onclick="clearDoneTasks()">Clean Up</button>
            </div>
            
            <div class="v5-stats-container">
                <div class="v5-stat-box"><div class="v5-val" id="tTotal">0</div><div class="v5-lbl">Total Tasks</div></div>
                <div class="v5-stat-box"><div class="v5-val" id="tDone" style="color:var(--success);">0</div><div class="v5-lbl">Done</div></div>
                <div class="v5-stat-box"><div class="v5-val" id="tPending" style="color:var(--danger);">0</div><div class="v5-lbl">Pending</div></div>
            </div>

            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <input id="newTaskName" class="input" placeholder="New Task..." style="margin:0;">
                <button class="btn btn-primary" onclick="addTask()">Add</button>
            </div>

            <div id="taskListContainer"></div>
        </div>
    </div>
    <div id="section-challenges" class="hidden">
      <div class="glass-panel">
        <h2>ğŸ† Challenges</h2>
        <div class="challenge-box-premium" id="challengeSetupBox">
            <h3>Start New Challenge</h3>
            <input id="challengeNameInput" class="input" placeholder="Name (e.g. 75 Hard)">
            <select id="challengeDaysInput" class="input">
                <option value="21">21 Days Habit</option>
                <option value="30">30 Days Sprint</option>
                <option value="75">75 Hard Challenge</option>
            </select>
            <button class="btn btn-primary" style="width:100%;" onclick="startChallenge()">Begin ğŸ”¥</button>
        </div>
        
        <div id="challengeActiveView" style="display:none; text-align:center;">
             <h1 id="activeChallengeTitle" style="color:var(--accent); margin-bottom:5px;">75 Hard</h1>
             <p style="font-size:14px; margin-bottom:20px;">Day <span id="activeChallengeDay">1</span> / <span id="activeChallengeTarget">75</span></p>
             
             <div style="display:grid; grid-template-columns: repeat(7, 1fr); gap:5px; margin-bottom:20px;" id="challengeCalendar">
                 </div>

             <button class="btn btn-success" style="width:100%; padding:15px; font-size:16px;" onclick="confirmClaim()">âœ… Mark Today Complete</button>
             <button class="btn btn-danger" emargin-top:15px;" onclick="deleteChallenge()">ğŸ—‘ï¸ Delete Challenge</button>
        </div>
      </div>
<div style="text-align:center; margin-top: 20px;">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5520401672645952"
         crossorigin="anonymous"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-5520401672645952"
         data-ad-slot="4459868531"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
    </div>

    <div id="section-guide" class="hidden"><div class="glass-panel"><h2>â„¹ï¸ Exam Guide</h2><div id="guide-content-area"></div></div></div>
  <div id="section-notes" class="hidden">
      <div class="glass-panel">
        <h2>ğŸ““ Mistake Notebook</h2>
        <p style="font-size:12px; opacity:0.7; margin-bottom:15px;">Write down your daily mistakes to avoid repeating them.</p>
        
        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <select id="mistakeSubject" class="input" style="width: 35%; margin:0; padding: 0 10px;">
                <option value="Phy">Physics</option>
                <option value="Chem">Chemistry</option>
                <option value="Bio">Biology</option>
                <option value="Mock">Mock Test</option>
            </select>
            <input id="newMistakeInput" class="input" placeholder="What went wrong?" style="margin:0;">
            <button class="btn btn-primary" onclick="addMistake()">Add</button>
        </div>
        
        <div id="mistakeListContainer"></div>
      </div>
    </div>
<div id="section-formulas" class="hidden">
  <div class="glass-panel">
    
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">
        <h2 style="margin:0;">ğŸ“ Formula Wizard</h2>
        </div>

    <div id="form-wizard-view">
        <div id="fw-step-1" class="fw-step active">
            <h3 style="text-align:center; color:var(--accent);">Step 1: Select Subject</h3>
            <div class="selection-grid">
                <div class="select-btn" onclick="fwSelectSubject('Physics')">ğŸ”­ Physics</div>
                <div class="select-btn" onclick="fwSelectSubject('Chemistry')">ğŸ§ª Chemistry</div>
                <div class="select-btn" onclick="fwSelectSubject('Maths')">ğŸ“ Maths</div>
                <div class="select-btn" onclick="fwSelectSubject('Bio')">ğŸ§¬ Biology</div>
            </div>
            <div style="text-align:center; margin-top:20px;">
                <button class="btn btn-ghost" onclick="toggleFormulaView('saved')">ğŸ“‚ Open Saved Formulas</button>
            </div>
        </div>

        <div id="fw-step-2" class="fw-step">
            <h3 style="text-align:center; color:var(--accent);">Step 2: Chapter Name</h3>
            <input id="fwChapterInput" class="input" placeholder="e.g. Rotational Motion">
            <div style="display:flex; gap:10px;">
                <button class="btn btn-ghost" style="flex:1" onclick="fwGoStep(1)">Back</button>
                <button class="btn btn-primary" style="flex:1" onclick="fwGoStep(3)">Next â</button>
            </div>
        </div>

        <div id="fw-step-3" class="fw-step">
            <h3 style="text-align:center; color:var(--accent);">Step 3: Import Content</h3>
            
            <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:15px; border:2px dashed var(--text-muted); text-align:center; margin-bottom:20px;">
                <p style="margin-bottom:10px;">Upload PDF Notes/Cheat Sheet</p>
                <input type="file" id="pdfUploader" accept="application/pdf" style="display:none" onchange="extractTextFromPDF(this)">
                <button class="btn btn-primary" onclick="document.getElementById('pdfUploader').click()">ğŸ“„ Select PDF</button>
                <p id="pdfStatus" style="font-size:12px; margin-top:10px; color:var(--accent);">Waiting...</p>
            </div>

            <p style="font-size:12px; opacity:0.7;">Preview (You can edit this text):</p>
            <textarea id="fwContentArea" class="input" rows="8" placeholder="Extracted text will appear here..."></textarea>
            
            <button class="btn btn-success" style="width:100%; margin-top:10px;" onclick="fwSaveFinal()">ğŸ’¾ Save Formula Sheet</button>
        </div>
    </div>

    <div id="form-saved-view" class="hidden">
        <button class="btn btn-ghost" style="width:100%; margin-bottom:15px; border:1px dashed var(--accent);" onclick="toggleFormulaView('wizard')">â• Add New Chapter</button>
        <div id="savedFormulaContainer"></div>
    </div>

    <div id="fw-reader-view" class="hidden" style="height:100%; display:flex; flex-direction:column;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <button class="btn btn-ghost" style="padding:5px 15px;" onclick="toggleFormulaView('saved')">â¬… Back</button>
            <span id="readerTitle" style="color:var(--accent); font-weight:bold;">Chapter</span>
            <button class="btn btn-danger" style="padding:5px 10px;" onclick="fwDeleteCurrent()">ğŸ—‘ï¸</button>
        </div>

        <div class="glass-panel" style="flex:1; background:rgba(0,0,0,0.4); overflow-y:auto; padding:15px; margin-bottom:15px; border:1px solid var(--accent);">
            <pre id="readerContent" style="white-space: pre-wrap; font-family: 'Courier New', monospace; color:#e2e8f0; font-size:14px; line-height:1.6; outline:none;" contenteditable="true"></pre>
        </div>

        <div style="display:flex; gap:10px;">
            <button class="btn" style="flex:1; background:#ef4444; color:white;" onclick="fwMarkRevision('hard')">ğŸ”´ Hard</button>
            <button class="btn" style="flex:1; background:#f59e0b; color:black;" onclick="fwMarkRevision('medium')">ğŸŸ¡ Medium</button>
            <button class="btn" style="flex:1; background:#10b981; color:black;" onclick="fwMarkRevision('easy')">ğŸŸ¢ Easy</button>
        </div>
        <p style="text-align:center; font-size:10px; opacity:0.5; margin-top:5px;">Tip: Tap text to fix spelling.</p>
    </div>

  </div>
</div>

<script>
/* --- ğŸ§ª FORMULA WIZARD LOGIC (FIXED) --- */
let formulaDB = JSON.parse(localStorage.getItem('st_formula_db') || '{}');
let fwTemp = { subject: '', chapter: '' };
let currentReader = { sub: null, chap: null };

function toggleFormulaView(view) {
    document.getElementById('form-wizard-view').classList.add('hidden');
    document.getElementById('form-saved-view').classList.add('hidden');
    document.getElementById('fw-reader-view').classList.add('hidden');

    if(view === 'saved') {
        document.getElementById('form-saved-view').classList.remove('hidden');
        renderSavedFormulas();
    } else if(view === 'wizard') {
        document.getElementById('form-wizard-view').classList.remove('hidden');
        fwGoStep(1);
    } else if(view === 'reader') {
        document.getElementById('fw-reader-view').classList.remove('hidden');
    }
}

function fwGoStep(n) {
    // ğŸ”¥ FIX: Now targeting .fw-step instead of .wizard-step
    document.querySelectorAll('#form-wizard-view .fw-step').forEach(el => el.classList.remove('active'));
    document.getElementById(`fw-step-${n}`).classList.add('active');
}

function fwSelectSubject(sub) {
    fwTemp.subject = sub;
    fwGoStep(2);
}

async function extractTextFromPDF(input) {
    const file = input.files[0];
    if(!file) return;
    document.getElementById('pdfStatus').innerText = "â³ Extracting... (Wait)";
    try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        let fullText = "";
        const maxPages = Math.min(pdf.numPages, 5);
        for (let i = 1; i <= maxPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            fullText += `--- Page ${i} ---\n` + textContent.items.map(item => item.str).join(' ') + "\n\n";
        }
        document.getElementById('fwContentArea').value = fullText;
        document.getElementById('pdfStatus').innerText = "âœ… Done!";
    } catch (error) {
        console.error(error);
        alert("PDF Error. Try another file.");
    }
}

function fwSaveFinal() {
    fwTemp.chapter = document.getElementById('fwChapterInput').value;
    const content = document.getElementById('fwContentArea').value;
    if(!fwTemp.chapter || !content) return alert("Required fields missing!");
    
    if(!formulaDB[fwTemp.subject]) formulaDB[fwTemp.subject] = {};
    formulaDB[fwTemp.subject][fwTemp.chapter] = content;
    localStorage.setItem('st_formula_db', JSON.stringify(formulaDB));
    
    alert("Saved! ğŸ‰");
    document.getElementById('fwChapterInput').value = '';
    document.getElementById('fwContentArea').value = '';
    toggleFormulaView('saved');
}

function renderSavedFormulas() {
    const container = document.getElementById('savedFormulaContainer');
    container.innerHTML = '';
    const subjects = Object.keys(formulaDB);
    if(subjects.length === 0) return container.innerHTML = '<div style="text-align:center; padding:20px; opacity:0.6">No Saved Formulas.</div>';

    subjects.forEach(sub => {
        let html = `<div style="margin-bottom:15px;"><h3 style="color:var(--accent); font-size:14px; border-bottom:1px solid rgba(255,255,255,0.1);">${sub}</h3>`;
        Object.keys(formulaDB[sub]).forEach(chap => {
            html += `<div class="glass-panel" style="padding:15px; margin-bottom:8px; cursor:pointer; background:rgba(255,255,255,0.05); display:flex; justify-content:space-between;" onclick="fwOpenReader('${sub}', '${chap}')"><b>${chap}</b><span>ğŸ‘‰</span></div>`;
        });
        container.innerHTML += html + `</div>`;
    });
}

function fwOpenReader(sub, chap) {
    currentReader = { sub, chap };
    document.getElementById('readerTitle').innerText = `${sub}: ${chap}`;
    document.getElementById('readerContent').innerText = formulaDB[sub][chap];
    toggleFormulaView('reader');
}

function fwMarkRevision(level) {
    alert(level === 'easy' ? "Great! ğŸŸ¢" : "Marked for Revision! ğŸ”´");
    toggleFormulaView('saved');
}

function fwDeleteCurrent() {
    if(confirm("Delete?")) {
        delete formulaDB[currentReader.sub][currentReader.chap];
        localStorage.setItem('st_formula_db', JSON.stringify(formulaDB));
        toggleFormulaView('saved');
    }
}
</script>
<div id="section-settings" class="hidden">
      
      <div class="glass-panel" style="border: 2px solid var(--accent); background: rgba(251, 191, 36, 0.05);">
        <h2 style="color:var(--accent); margin-top:0;">ğŸ›’ XP Shop</h2>
        <p style="margin-bottom:15px;">Balance: <span id="shopBalance">0</span> XP</p>
        
        <div class="shop-item">
            <div>â„ï¸ <b>Streak Freeze</b><br><span style="font-size:10px;">Protect streak for 1 day</span></div>
            <button class="btn btn-ghost" onclick="buyItem('freeze', 500)">Buy 500 XP</button>
        </div>
        
        <div class="shop-item">
            <div>âš¡ <b>1 Hour Boost</b><br><span style="font-size:10px;">Double XP for 1 hr</span></div>
            <button class="btn btn-ghost" onclick="buyItem('boost', 1000)">Buy 1k XP</button>
        </div>
      </div>

      <div class="glass-panel">
        <h2>âš™ï¸ App Settings</h2>
        
        <div style="margin-bottom:20px;">
            <label style="display:block; margin-bottom:10px;">ğŸ¨ App Theme (All Free)</label>
            <select id="themeSelect" class="input" onchange="changeTheme(this.value)">
                <option value="sunset">ğŸŒ… Sunset (Default)</option>
                <option value="midnight">ğŸŒ‘ Midnight Blue</option>
                <option value="royal">ğŸ‘‘ Royal Gold</option>
                <option value="matrix">ğŸ’» Matrix Green</option>
                <option value="ocean">ğŸŒŠ Ocean Depth</option>
                <option value="nebula">ğŸŒŒ Nebula</option>
                <option value="aura">ğŸŒŒ Aura Night (Premium)</option>
                <option value="arctic">â„ï¸ Arctic Frost (Clean)</option>
                <option value="mint">ğŸ¥ Soft Mint (Doctor Mode)</option>
                <option value="cyber">ğŸ¤– Cyber Focus (Best for Physics)</option>
                <option value="coffee">â˜• Midnight Coffee (Eye Friendly)</option>
            </select>
        </div>
        
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding:10px; background:rgba(255,255,255,0.05); border-radius:10px;">
            <span>ğŸ”Š Sound Effects</span>
            <input type="checkbox" checked style="accent-color:var(--accent);">
        </div>
        
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding:10px; background:rgba(255,255,255,0.05); border-radius:10px;">
            <span>ğŸ“³ Haptic Vibration</span>
            <input type="checkbox" checked style="accent-color:var(--accent);">
        </div>

    <div style="margin-top:20px; padding-top:20px; border-top:1px solid rgba(255,255,255,0.1);">
            <h4 style="margin-bottom:10px;">âš–ï¸ Legal & Support</h4>
            <div style="display:flex; flex-direction:column; gap:8px;">
                <button class="btn btn-ghost" style="justify-content:flex-start;" onclick="showSection('privacy')">ğŸ”’ Privacy Policy</button>
                <button class="btn btn-ghost" style="justify-content:flex-start;" onclick="showSection('terms')">ğŸ“œ Terms of Service</button>
                <button class="btn btn-ghost" style="justify-content:flex-start;" onclick="showSection('contact')">ğŸ“ Contact Us</button>
            </div>
        </div>

        <div style="text-align:center; margin-top:30px; font-size:12px; color:var(--text-muted);">
            Study Arc V7.2 â€¢ Powered by <b>Abhi Sarswat</b> â¤ï¸
        </div>
        <button class="btn btn-primary" style="width:100%; margin-top:10px;" onclick="window.location.reload()">ğŸ”„ Refresh App</button>
        <button class="btn btn-danger" style="width:100%; margin-top:10px;" onclick="hardReset()">âš ï¸ Factory Reset</button>
      </div>
    </div>
<div id="section-privacy" class="hidden">
        <div class="glass-panel">
            <h2>ğŸ”’ Privacy Policy</h2>
            <div style="font-size:12px; opacity:0.8; line-height:1.6; height:60vh; overflow-y:auto; padding-right:10px;">
                <p><strong>Effective Date: 2025</strong></p>
                <p>Welcome to Study Arc. Your privacy is important to us.</p>
                
                <h4>1. Information We Collect</h4>
                <p>We do not collect any personal information on our servers. All data (Study history, Tasks, Name) is stored locally on your device using <code>LocalStorage</code>. If you clear your browser cache, this data may be lost.</p>
                
                <h4>2. Third-Party Services</h4>
                <p>We use Google AdSense to display advertisements. Google may use cookies to serve ads based on your prior visits to our website or other websites.</p>
                
                <h4>3. User Rights</h4>
                <p>You have full control over your data. You can delete all stored data by using the "Factory Reset" option in the Settings menu.</p>
                
                <h4>4. Contact</h4>
                <p>If you have any questions, please contact us via the Contact section in the app.</p>
            </div>
            <button class="btn btn-primary" style="margin-top:15px; width:100%;" onclick="showSection('settings')">ğŸ”™ Back to Settings</button>
        </div>
    </div>

    <div id="section-terms" class="hidden">
        <div class="glass-panel">
            <h2>ğŸ“œ Terms of Service</h2>
            <div style="font-size:12px; opacity:0.8; line-height:1.6; height:60vh; overflow-y:auto; padding-right:10px;">
                <p><strong>1. Acceptance of Terms</strong><br>By accessing and using Study Arc, you accept and agree to be bound by the terms and provision of this agreement.</p>
                
                <p><strong>2. Use License</strong><br>This is a free-to-use productivity tool for students. You are granted a limited license to use this software for personal study tracking.</p>
                
                <p><strong>3. Disclaimer</strong><br>The materials on Study Arc are provided "as is". We make no warranties, expressed or implied, regarding exam results or accuracy of study metrics.</p>
                
                <p><strong>4. Ads</strong><br>This service is supported by ads from Google AdSense. By using the app, you consent to seeing these advertisements.</p>
            </div>
            <button class="btn btn-primary" style="margin-top:15px; width:100%;" onclick="showSection('settings')">ğŸ”™ Back to Settings</button>
        </div>
    </div>

    <div id="section-contact" class="hidden">
        <div class="glass-panel">
            <h2>ğŸ“ Contact Us</h2>
            <p style="margin-bottom:20px; opacity:0.8; font-size:13px;">We'd love to hear from you!</p>
            
            <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                <div style="margin-bottom:15px;">
                    <div style="font-size:10px; text-transform:uppercase; color:var(--accent);">Developer</div>
                    <div style="font-size:16px; font-weight:bold;">Abhi Sarswat</div>
                </div>
                
                <div style="margin-bottom:15px;">
                    <div style="font-size:10px; text-transform:uppercase; color:var(--accent);">Email Support</div>
                    <div style="font-size:16px;">support@studyarc.app</div>
                </div>
                
                <div>
                    <div style="font-size:10px; text-transform:uppercase; color:var(--accent);">Location</div>
                    <div style="font-size:16px;">Rajasthan, India</div>
                </div>
            </div>
            
            <button class="btn btn-primary" style="margin-top:20px; width:100%;" onclick="showSection('settings')">ğŸ”™ Back to Settings</button>
        </div>
    </div>
  </main>
</div>
<div id="claimModal" class="modal hidden">
  <div class="glass-panel" style="max-width: 350px; text-align: center; border: 2px solid var(--accent);">
    <div style="font-size:50px;">ğŸ¦</div>
    <h2>Hey Champ!</h2>
    <p style="color:var(--text-muted); margin-bottom:20px;">Did you honestly complete your daily goal?</p>
    <div style="display:flex; gap:10px; justify-content:center;">
        <button class="btn btn-ghost" onclick="closeModal('claimModal')">No</button>
        <button class="btn btn-primary" onclick="confirmClaim()">YES, I DID IT! ğŸ”¥</button>
    </div>
  </div>
</div>

<script>
/* --- ğŸ§  PART 3: DATA & CONTENT DATABASE --- */

// 1. ğŸ“š SYLLABUS DATABASE (NEET 2027 Updated)
const SYLLABUS_DB = {
    "11": {
        "Physics": ["Units & Measurements", "Motion in Straight Line", "Motion in Plane", "Laws of Motion", "Work, Energy & Power", "System of Particles & Rotational Motion", "Gravitation", "Mechanical Properties of Solids", "Mechanical Properties of Fluids", "Thermal Properties of Matter", "Thermodynamics", "Kinetic Theory", "Oscillations", "Waves"],
        "Chemistry": ["Some Basic Concepts of Chemistry", "Structure of Atom", "Classification of Elements", "Chemical Bonding", "Thermodynamics", "Equilibrium", "Redox Reactions", "Organic Chemistry: Basic Principles", "Hydrocarbons"],
        "Biology": ["Living World", "Biological Classification", "Plant Kingdom", "Animal Kingdom", "Morphology of Flowering Plants", "Anatomy of Flowering Plants", "Structural Organisation in Animals", "Cell: The Unit of Life", "Biomolecules", "Cell Cycle and Cell Division", "Photosynthesis in Higher Plants", "Respiration in Plants", "Plant Growth and Development", "Breathing and Exchange of Gases", "Body Fluids and Circulation", "Excretory Products and Elimination", "Locomotion and Movement", "Neural Control and Coordination", "Chemical Coordination and Integration"],
        "Maths": ["Sets", "Relations & Functions", "Trigonometric Functions", "Complex Numbers", "Linear Inequalities", "Permutations & Combinations", "Binomial Theorem", "Sequence & Series", "Straight Lines", "Conic Sections", "Limits & Derivatives", "Statistics", "Probability"]
    },
    "12": {
        "Physics": ["Electric Charges & Fields", "Potential & Capacitance", "Current Electricity", "Moving Charges & Magnetism", "Magnetism & Matter", "Electromagnetic Induction", "Alternating Current", "EM Waves", "Ray Optics", "Wave Optics", "Dual Nature of Radiation", "Atoms", "Nuclei", "Semiconductor Electronics"],
        "Chemistry": ["Solutions", "Electrochemistry", "Chemical Kinetics", "d- and f-Block Elements", "Coordination Compounds", "Haloalkanes & Haloarenes", "Alcohols, Phenols & Ethers", "Aldehydes, Ketones & Carboxylic Acids", "Amines", "Biomolecules"],
        "Biology": ["Sexual Reproduction in Flowering Plants", "Human Reproduction", "Reproductive Health", "Principles of Inheritance & Variation", "Molecular Basis of Inheritance", "Evolution", "Human Health and Disease", "Microbes in Human Welfare", "Biotechnology: Principles & Processes", "Biotechnology and its Applications", "Organisms and Populations", "Ecosystem", "Biodiversity and Conservation"],
        "Maths": ["Relations & Functions", "ITF", "Matrices", "Determinants", "Continuity & Differentiability", "AOD", "Integrals", "AOI", "Differential Equations", "Vectors", "3D Geometry", "Probability"]
    }
};

// 2. â„¹ï¸ EXAM GUIDE CONTENT (Injected via JS for cleanness)
const GUIDE_HTML = `
<div style="padding-bottom:50px;">
    <div class="glass-panel" style="margin-bottom:15px; background:rgba(255,255,255,0.03);">
        <h3 style="color:var(--accent); margin-bottom:10px;">ğŸ©º NEET Master Strategy (680+)</h3>
        <p style="font-size:14px; line-height:1.6;">NEET is 50% Knowledge and 50% Speed. Here is the breakdown:</p>
        
        <h4 style="color:#10b981; margin-top:15px;">ğŸ§¬ Biology (360/360)</h4>
        <ul style="font-size:13px; opacity:0.8; padding-left:20px; line-height:1.6;">
            <li><strong>NCERT is God:</strong> 90/90 questions come directly from NCERT lines. Read summaries and scientist intros too.</li>
            <li><strong>Diagrams:</strong> Practice labeling diagrams from memory.</li>
            <li><strong>High Yield Units:</strong> Genetics, Ecology, and Human Physiology.</li>
        </ul>

        <h4 style="color:#fbbf24; margin-top:15px;">ğŸ”­ Physics (160+)</h4>
        <ul style="font-size:13px; opacity:0.8; padding-left:20px; line-height:1.6;">
            <li><strong>Formula Sheet:</strong> Paste it on your wall. 60% questions are formula-based.</li>
            <li><strong>Modern Physics:</strong> Easiest unit with high weightage (Atoms, Nuclei, Semiconductors).</li>
            <li><strong>Mechanics:</strong> Focus on FBDs and Graphs.</li>
        </ul>
        
        <h4 style="color:#ef4444; margin-top:15px;">ğŸ§ª Chemistry (170+)</h4>
        <ul style="font-size:13px; opacity:0.8; padding-left:20px; line-height:1.6;">
            <li><strong>Inorganic:</strong> Pure memorization. Read P-Block & Coordination Compounds multiple times.</li>
            <li><strong>Organic:</strong> Master GOC & Reaction Mechanisms.</li>
        </ul>
    </div>

    <div class="glass-panel" style="margin-bottom:15px; background:rgba(255,255,255,0.03);">
        <h3 style="color:var(--accent); margin-bottom:10px;">ğŸ‘· JEE Mains & Advanced</h3>
        <p style="font-size:14px; line-height:1.6;">Accuracy is more important than attempting everything.</p>
        <ul style="font-size:13px; opacity:0.8; padding-left:20px; line-height:1.6;">
            <li><strong>Maths:</strong> Calculus and Vectors are the rank deciders.</li>
            <li><strong>Physics:</strong> HC Verma is mandatory for concept building.</li>
            <li><strong>Mock Tests:</strong> Give tests in 2 slots (9-12 and 2-5) to train your brain.</li>
        </ul>
    </div>

    <div class="glass-panel" style="background:rgba(255,255,255,0.03);">
        <h3 style="color:var(--accent); margin-bottom:10px;">ğŸ† The 1% Club Habits</h3>
        <ol style="font-size:13px; opacity:0.8; padding-left:20px; line-height:1.6;">
            <li><strong>Mistake Notebook:</strong> Write down every question you got wrong in mocks. Revise this daily.</li>
            <li><strong>Pomodoro:</strong> Study 50 mins, Break 10 mins. Zero distractions.</li>
            <li><strong>Sleep:</strong> 7 Hours sleep is crucial for memory retention.</li>
        </ol>
    </div>
</div>
`;

// 3. ğŸ¯ MOTIVATION QUOTES (For Failed Tasks)
const FAIL_MOTIVATION = [
    "It's okay! Just reschedule it. ğŸš€",
    "Don't give up. You are a warrior! âš”ï¸",
    "One bad day doesn't mean a bad life. ğŸ’ª",
    "Rest if you must, but don't quit. ğŸ”¥"
];

// Load Exam Guide on Start
document.getElementById('guide-content-area').innerHTML = GUIDE_HTML;

</script>
<script>
/* --- ğŸ§  PART 4: THE MASTER LOGIC (V7.0) --- */

// --- 1. STATE MANAGEMENT ---
let profile = JSON.parse(localStorage.getItem('st_profile'));
let tasks = JSON.parse(localStorage.getItem('st_tasks') || '[]');
let streak = parseInt(localStorage.getItem('st_streak') || '0');
let xp = parseInt(localStorage.getItem('st_xp') || '0');
let level = parseInt(localStorage.getItem('st_level') || '1');
let freezeCount = parseInt(localStorage.getItem('st_freeze') || '0');
let activeSyllabus = JSON.parse(localStorage.getItem('st_active_syllabus') || 'null'); // {class, exam, chapters: []}
let challenge = JSON.parse(localStorage.getItem('st_challenge') || '{"active":false}');
let history = JSON.parse(localStorage.getItem('st_history') || '{}');
let lastStudyDate = localStorage.getItem('st_last_date');
// âœ… NEW: Settings Variables (Yahan se settings control hongi)
let soundEnabled = localStorage.getItem('st_sound') !== 'false'; // Default ON hai
let vibrationEnabled = localStorage.getItem('st_vibrate') !== 'false'; // Default ON hai

// Timer Globals
let timerInterval, endTime, currentSubject, wakeLock;
let isPaused = false, timeRemaining = 0, sessionDuration = 0;
let soundAudio = null;

// --- ğŸš€ INITIALIZATION ---
// âœ… NEW: Init Function (Settings + Sound Fix)
function init() {
    if(!profile) {
        document.getElementById('onboardingModal').classList.remove('hidden');
    } else {
        updateUI();
        checkStreak();
    }
    
    // 1. Daily Quote Load
    if(document.getElementById('dailyQuote')) {
        document.getElementById('dailyQuote').innerText = `"${DAILY_QUOTES[Math.floor(Math.random() * DAILY_QUOTES.length)]}"`;
    }
    
    // 2. Theme Load
    let savedTheme = localStorage.getItem('st_theme') || 'sunset';
    document.body.className = `theme-${savedTheme}`;
    document.getElementById('themeSelect').value = savedTheme;

    // 3. ğŸ”¥ SETTINGS LOGIC (Live Buttons)
    const checks = document.querySelectorAll('#section-settings input[type="checkbox"]');
    if(checks.length >= 2) {
        // Sound Button
        checks[0].checked = soundEnabled;
        checks[0].onchange = (e) => {
            soundEnabled = e.target.checked;
            localStorage.setItem('st_sound', soundEnabled);
            alert(soundEnabled ? "ğŸ”Š Sound ON" : "ğŸ”‡ Sound OFF");
        };

        // Vibration Button
        checks[1].checked = vibrationEnabled;
        checks[1].onchange = (e) => {
            vibrationEnabled = e.target.checked;
            localStorage.setItem('st_vibrate', vibrationEnabled);
            alert(vibrationEnabled ? "ğŸ“³ Vibration ON" : "ğŸ“´ Vibration OFF");
        };
    }

    // 4. Load Data
    renderTasks();
    checkChallenge();
    initSyllabusUI();
    renderMistakes();
renderSavedFormulas(); 
    checkWeeklyReset();
}

// --- ğŸ“± UI NAVIGATION ---
function showSection(id, element) {
    if(window.innerWidth <= 768) toggleSidebar();
    document.querySelectorAll('[id^="section-"]').forEach(d => d.classList.add('hidden'));
    document.getElementById(`section-${id}`).classList.remove('hidden');
    
    // Sidebar Highlight Logic
    if(element) {
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
    }
}

function toggleSidebar() {
    document.getElementById('sidebarMenu').classList.toggle('active');
    document.getElementById('mobileOverlay').classList.toggle('active');
}

// --- âš™ï¸ DASHBOARD UPDATES (Exam Name & Quotes) ---
const DAILY_QUOTES = [
    "Your competition is not others. Your competition is your procrastination.",
    "Study like there's no tomorrow because if you keep putting it off, there won't be.",
    "The pain you feel today is the strength you feel tomorrow.",
    "Don't stop when you're tired. Stop when you're done.",
    "Dream big. Work hard. Stay humble."
];

function completeOnboarding() {
    const name = document.getElementById('obName').value;
    const exam = document.getElementById('obExamName').value;
    const date = document.getElementById('obTarget').value;
    
    if(!name) return alert("Name required!");
    
    profile = { name, examName: exam, examDate: date };
    localStorage.setItem('st_profile', JSON.stringify(profile));
    document.getElementById('onboardingModal').classList.add('hidden');


    init();}

function updateUI() {
    if(!profile) return;
    
    // Header Info
    // ğŸ‘‡ Smart Greeting Logic
    const hr = new Date().getHours();
    let greetMsg = "Hello";
    
    if (hr < 12) greetMsg = "Good Morning â˜€ï¸";
    else if (hr < 17) greetMsg = "Good Afternoon ğŸŒ¤ï¸";
    else if (hr < 21) greetMsg = "Good Evening ğŸŒ†";
    else greetMsg = "Late Night Grind ğŸ¦‰";

    document.getElementById('userGreet').innerText = `${greetMsg}, ${profile.name}`;
    if(profile.examName) document.getElementById('userExamDisplay').innerText = profile.examName;
    document.getElementById('streakDisplay').innerText = streak;
    
    // XP & Level
    let reqXP = level * 1000;
    document.getElementById('userLevel').innerText = level;
    document.getElementById('currentXP').innerText = `${xp} / ${reqXP}`;
    document.getElementById('xpBar').style.width = `${(xp/reqXP)*100}%`;
    document.getElementById('shopBalance').innerText = xp;

    // Exam Countdown
    if(profile.examDate) {
        const diff = new Date(profile.examDate) - new Date();
        const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
        document.getElementById('daysLeftDisplay').innerText = days > 0 ? `${days} Days` : "TODAY!";
        document.getElementById('targetDateDisplay').innerText = new Date(profile.examDate).toDateString().slice(4, 10);
    }
}

// --- ğŸ“š SYLLABUS WIZARD (V7.1 Updated) ---
let wizClass = null, wizExam = null;

function initSyllabusUI() {
    if(activeSyllabus) {
        document.querySelectorAll('.wizard-step').forEach(el => el.classList.remove('active'));
        document.getElementById('wiz-active-dashboard').classList.add('active');
        renderActiveSyllabus();
    } else {
        resetSyllabusWizardUI();
    }
}
// âœ… FIX: Report Download Function (Ye missing tha)
function downloadReport() {
    // 1. Check karo ki goal bana hai ya nahi
    if (!activeSyllabus) return alert("Pehle Syllabus Goal to banao bhai! ğŸ˜…");
    
    // 2. Report ka text taiyar karo
    let report = "ğŸ“ STUDY ARC - SYLLABUS REPORT\n";
    report += "--------------------------------\n";
    report += `Class: ${activeSyllabus.class}\n`;
    report += `Exam: ${activeSyllabus.exam}\n`;
    // Agar startDate nahi hai to aaj ki date lelo
    let dateStr = activeSyllabus.startDate ? new Date(activeSyllabus.startDate).toDateString() : new Date().toDateString();
    report += `Started: ${dateStr}\n\n`;
    
    let completed = activeSyllabus.chapters.filter(c => c.done).length;
    let total = activeSyllabus.chapters.length;
    let percent = total > 0 ? Math.round((completed / total) * 100) : 0;
    
    report += `ğŸ“Š PROGRESS: ${percent}% Done (${completed}/${total})\n`;
    report += "--------------------------------\n\n";
    
    report += "CHAPTER STATUS:\n";
    activeSyllabus.chapters.forEach(c => {
        report += `[${c.done ? 'âœ… DONE' : 'âŒ PENDING'}]  ${c.name}\n`;
    });
    
    report += "\nGenerated by Study Arc V7 Ultimate";

    // 3. File Download karwao (Magic ğŸª„)
    const blob = new Blob([report], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'My_Syllabus_Report.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}
// âœ… MISSION 5: Weekly Reset Logic
function checkWeeklyReset() {
    if(!activeSyllabus) return; 
    
    const today = new Date();
    // 0 = Sunday
    if(today.getDay() === 0) { 
        const lastReset = localStorage.getItem('st_last_reset_date');
        const todayStr = today.toDateString();

        if(lastReset !== todayStr) {
            alert("ğŸ“… It's Sunday! Report download ho rahi hai...");
            if(typeof downloadReport === 'function') downloadReport(); 

            // Reset Data
            activeSyllabus.chapters.forEach(c => c.done = false);
            activeSyllabus.xpClaimed = false;
            
            localStorage.setItem('st_active_syllabus', JSON.stringify(activeSyllabus));
            localStorage.setItem('st_last_reset_date', todayStr);

            setTimeout(() => {
                alert("ğŸ”„ Weekly Goals Reset! Naye hafte ke liye taiyar ho jao! ğŸš€");
                renderActiveSyllabus();
            }, 2000); 
        }
    }
}
function wizSelectClass(c) {
    wizClass = c;
    document.getElementById('wiz-step-1').classList.remove('active');
    document.getElementById('wiz-step-2').classList.add('active');
}

function wizSelectExam(e) {
    wizExam = e;
    document.getElementById('wiz-step-2').classList.remove('active');
    document.getElementById('wiz-step-3').classList.add('active');
    renderChapterSelection();
}

function renderChapterSelection() {
    const container = document.getElementById('wiz-chapter-container');
    container.innerHTML = '';
    const subjects = SYLLABUS_DB[wizClass]; 
    
    let keys = Object.keys(subjects);
    if(wizExam === 'NEET') keys = keys.filter(k => k !== 'Maths');
    if(wizExam === 'JEE') keys = keys.filter(k => k !== 'Biology');

    keys.forEach(sub => {
        let html = `<h4 style="color:var(--accent); margin:15px 0 5px 0;">${sub}</h4>`;
        subjects[sub].forEach(chap => {
            // New Green Selection HTML
            html += `
            <div class="chapter-select-row" onclick="this.classList.toggle('selected')">
                <div class="chapter-circle"></div>
                <span>${chap}</span>
            </div>`;
        });
        container.innerHTML += html;
    });
}

function wizGenerateGoal() {
    const selected = [];
    document.querySelectorAll('.chapter-select-row.selected span').forEach(el => selected.push({name: el.innerText, done: false}));
    
    if(selected.length === 0) return alert("Select at least 1 chapter!");
    
    // XP Claimed flag added
    activeSyllabus = { class: wizClass, exam: wizExam, chapters: selected, startDate: Date.now(), xpClaimed: false };
    localStorage.setItem('st_active_syllabus', JSON.stringify(activeSyllabus));
    
    initSyllabusUI(); 
    confetti();
}

function renderActiveSyllabus() {
    const list = document.getElementById('active-goal-list');
    list.innerHTML = '';
    let done = 0;
    
    activeSyllabus.chapters.forEach((ch, idx) => {
        if(ch.done) done++;
        list.innerHTML += `
        <div class="task-row" style="${ch.done ? 'opacity:0.6; border-color:var(--success);' : ''}">
            <span style="${ch.done ? 'text-decoration:line-through' : ''}">${ch.name}</span>
            <button class="btn-icon" style="background:${ch.done ? 'var(--success)' : 'rgba(255,255,255,0.1)'}" onclick="toggleChapter(${idx})">
                ${ch.done ? 'âœ”' : ''}
            </button>
        </div>`;
    });
    
    // Update V5 Stats
    document.getElementById('weekTotalCount').innerText = activeSyllabus.chapters.length;
    document.getElementById('weekDoneCount').innerText = done;
    document.getElementById('weekPendingCount').innerText = activeSyllabus.chapters.length - done;

    // Show Reward Button if 5+ chapters done
    const btn = document.getElementById('claimSyllabusXPBtn');
    if(done >= 5 && !activeSyllabus.xpClaimed) {
        btn.style.display = 'block';
    } else {
        btn.style.display = 'none';
    }
}

function toggleChapter(idx) {
    const isComplete = !activeSyllabus.chapters[idx].done;
    
    if(isComplete) {
        if(!confirm("Did you really complete this chapter? ğŸ†")) return;
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
    }
    
    activeSyllabus.chapters[idx].done = isComplete;
    localStorage.setItem('st_active_syllabus', JSON.stringify(activeSyllabus));
    renderActiveSyllabus();
}

function claimSyllabusXP() {
    addXP(100);
    activeSyllabus.xpClaimed = true;
    localStorage.setItem('st_active_syllabus', JSON.stringify(activeSyllabus));
    renderActiveSyllabus();
    alert("ğŸ‰ 100 XP Claimed!");
    confetti();
}

function resetSyllabusWizard() {
    if(confirm("Reset Syllabus Goal?")) {
        activeSyllabus = null;
        localStorage.removeItem('st_active_syllabus');
        resetSyllabusWizardUI();
    }
}

function resetSyllabusWizardUI() {
    document.querySelectorAll('.wizard-step').forEach(el => el.classList.remove('active'));
    document.getElementById('wiz-step-1').classList.add('active');
}
// --- ğŸ§˜ FOCUS TIMER (Fixed & Safe) ---
/* --- ğŸ”¥ NEW: Other Subject & Sound Fix --- */
// 1. "Other" select karne par input box dikhana
function checkCustomSubject(el) {
    const customInput = document.getElementById('customSubjectInput');
    if (el.value === "Other") {
        customInput.style.display = "block"; 
        customInput.style.marginTop = "10px"; // Thoda gap diya
        customInput.focus();
    } else {
        customInput.style.display = "none";
    }
}

// 2. Sound Setup (Timer khtm hone par bajegi)
// âœ… Sound Function (Bina Internet ke Beep bajega)
const AudioContext = window.AudioContext || window.webkitAudioContext;
// âœ… NEW: Smart Beep (Setting check karega)
function playBeep() {
    if (!soundEnabled) return; // ğŸ”‡ Agar setting OFF hai, to chup raho!
    
    if (!AudioContext) return;
    const ctx = new AudioContext();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.frequency.value = 800; 
    osc.type = "sine";
    gain.gain.setValueAtTime(0.1, ctx.currentTime);
    osc.start();
    osc.stop(ctx.currentTime + 0.5);
}
function startQuickFocus() {
    // 1. Negative Value Fix
    const hInput = document.getElementById('quickHrs');
    const mInput = document.getElementById('quickMins');
    if(hInput.value < 0) hInput.value = 0;
    if(mInput.value < 0) mInput.value = 0;

    const h = parseInt(hInput.value)||0;
    const m = parseInt(mInput.value)||0;
    
    let subj = document.getElementById('quickSubject').value;
    if(subj === "Other") subj = document.getElementById('customSubjectInput').value;
    
    if(!subj || (h===0 && m===0)) return alert("Please set time & subject!");
    
    currentSubject = subj;
    sessionDuration = (h*3600) + (m*60);
    timeRemaining = sessionDuration;
    isPaused = false;
    
    // 2. Show Screen FIRST (Important)
    document.getElementById('focusOverlay').style.display = 'flex';
// ğŸ‘‡ Start Time Calculation Code
    const now = new Date();
    const finishTime = new Date(now.getTime() + sessionDuration * 1000);
    const timeString = finishTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    document.getElementById('endTimeDisplay').innerText = `ğŸ”” Finish at ${timeString}`;
    document.getElementById('focusSubjectDisplay').innerText = subj;
    
    // 3. Safe Wake Lock (Crash Proof)
    try { 
        if('wakeLock' in navigator) {
            navigator.wakeLock.request('screen')
            .then(w => { wakeLock = w; })
            .catch(err => console.log("Wake Lock Error:", err));
        }
    } catch(e) { console.log("Wake Lock not supported"); }

    runTimer();
}

function runTimer() {
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        if(!isPaused) {
            timeRemaining--;
            updateTimerDisplay();
            if(timeRemaining <= 0) finishFocus();
        }
    }, 1000);
    updateTimerDisplay();
}

function updateTimerDisplay() {
    const h = Math.floor(timeRemaining/3600).toString().padStart(2,'0');
    const m = Math.floor((timeRemaining%3600)/60).toString().padStart(2,'0');
    const s = (timeRemaining%60).toString().padStart(2,'0');
    document.getElementById('focusTimerDisplay').innerText = `${h}:${m}:${s}`;
}

function toggleTimer() {
    isPaused = !isPaused;
    document.getElementById('btnPause').innerText = isPaused ? "â–¶ Resume" : "â¸ Pause";
}

function giveUpFocus() {
    if(confirm("âš ï¸ Give up? Progress won't be saved.")) {
        closeFocus();
    }
}

function finishFocus() {
    let studied = sessionDuration - timeRemaining;
    
    // ğŸ”¥ SOUND PLAY KARO (Sirf yahi line nayi hai)
    playBeep();
sendLocalNotification("Focus Session Complete! ğŸ‰", "Target achieved! Take a break.");

    if(studied > 60) {
        let today = new Date().toDateString();
        history[today] = (history[today] || 0) + studied;
        localStorage.setItem('st_history', JSON.stringify(history));
        addXP(Math.floor(studied/60)); 
        alert(`ğŸ”¥ Session Saved! You earned ${Math.floor(studied/60)} XP`);
        
        // Confetti animation
        try { confetti(); } catch(e) {}
    }
    closeFocus();
}

function closeFocus() {
    // ğŸ”´ Hide Screen FIRST (Critical Fix)
    document.getElementById('focusOverlay').style.display = 'none';
    
    clearInterval(timerInterval);
    stopSounds();
    // Safe Release Logic
    try { if(wakeLock) wakeLock.release(); } catch(e){}
    updateUI();
}
// ğŸµ Sounds
function toggleSound(type) {
    if(soundAudio) soundAudio.pause();
    // In a real app, use local files. Here using placeholders or muted logic for demo.
    // Assuming simple loop if files existed.
    // For this version:
    alert(`ğŸµ Playing ${type} sound... (Imagine relaxing noise)`); 
}
function stopSounds() { if(soundAudio) soundAudio.pause(); }

// --- âœ… TASK MANAGER (V5 Style & Bug Fixes) ---
function addTask() {
    const name = document.getElementById('newTaskName').value;
    if(!name) return;
    
    // Create new task
    tasks.unshift({id: Date.now(), name, status: 'pending'});
    saveTasks();
    document.getElementById('newTaskName').value = '';
}

function renderTasks() {
    const list = document.getElementById('taskListContainer');
    list.innerHTML = '';
    
    // Reset Counters
    let total = 0, done = 0, pending = 0;
    
    tasks.forEach(task => {
        total++;
        if(task.status === 'done') done++; else pending++;
        
        let isDone = task.status === 'done';
        
        // V5 Style Row (Buttons on Right)
        list.innerHTML += `
        <div class="task-row" style="${isDone ? 'opacity:0.6' : ''}">
            <div style="text-align:left;">
                <div style="font-weight:bold; ${isDone ? 'text-decoration:line-through' : ''}">${task.name}</div>
            </div>
            <div class="task-actions">
                ${!isDone ? `<button class="btn-icon" style="background:var(--success); color:black;" onclick="completeTask(${task.id})">âœ”</button>` : ''}
                <button class="btn-icon" style="background:var(--danger); color:white;" onclick="deleteTask(${task.id})">âœ–</button>
            </div>
        </div>`;
    });
    
    // Update Stats (Bug Fixed: Directly updating IDs)
    if(document.getElementById('tTotal')) {
        document.getElementById('tTotal').innerText = total;
        document.getElementById('tDone').innerText = done;
        document.getElementById('tPending').innerText = pending;
    }
}

function completeTask(id) {
    const task = tasks.find(t => t.id === id);
    if(task) {
        task.status = 'done';
        saveTasks();
        addXP(50);
        confetti({particleCount: 50, origin: {y: 0.8}});
    }
}

function deleteTask(id) {
    const task = tasks.find(t => t.id === id);
    if(task && task.status === 'pending') {
        // Motivation Popup before giving up
        const quote = FAIL_MOTIVATION[Math.floor(Math.random() * FAIL_MOTIVATION.length)];
        if(!confirm(`Wait! ${quote}\nStill want to delete?`)) return;
    }
    tasks = tasks.filter(t => t.id !== id);
    saveTasks();
}

function saveTasks() { 
    localStorage.setItem('st_tasks', JSON.stringify(tasks)); 
    renderTasks(); 
}

function clearDoneTasks() { 
    if(confirm("Remove all completed tasks?")) {
        tasks = tasks.filter(t => t.status === 'pending'); 
        saveTasks(); 
    }
}

// --- ğŸ† CHALLENGES ---
function startChallenge() {
    if(challenge.active && !confirm("Start new? Old progress will be deleted.")) return;
    
    const name = document.getElementById('challengeNameInput').value;
    const days = document.getElementById('challengeDaysInput').value;
    
    challenge = { active:true, name, target: parseInt(days), day: 1, lastClaim: 0 };
    localStorage.setItem('st_challenge', JSON.stringify(challenge));
    checkChallenge();
}

function checkChallenge() {
    const setup = document.getElementById('challengeSetupBox');
    const view = document.getElementById('challengeActiveView');
    const widget = document.getElementById('challengeWidget');
    
    if(!challenge.active) {
        setup.style.display = 'block'; view.style.display = 'none'; widget.style.display = 'none';
        return;
    }
    
    // Show View
    setup.style.display = 'none'; view.style.display = 'block'; widget.style.display = 'block';
    
    // Update UI Texts
    [document.getElementById('challengeText'), document.getElementById('activeChallengeTitle')].forEach(e => e.innerText = challenge.name);
    [document.getElementById('challengeDay'), document.getElementById('activeChallengeDay')].forEach(e => e.innerText = challenge.day);
    [document.getElementById('challengeTarget'), document.getElementById('activeChallengeTarget')].forEach(e => e.innerText = challenge.target);
    
    // Sidebar Progress
    let pct = (challenge.day / challenge.target) * 100;
    document.getElementById('challengeBarSidebar').style.width = `${pct}%`;
}

// âœ… NEW: Honest Challenge Claim (Confirmation ke sath)
function confirmClaim() {
    const today = new Date().toDateString();
    const lastActive = localStorage.getItem('st_last_active_date');

    // 1. Pehle check karo ki aaj ka ho chuka hai kya?
    if (lastActive === today) {
        return alert("ğŸ“… Aaj ka quota pura ho chuka hai! Kal aana.");
    }

    // 2. ğŸ”¥ CONFIRMATION DIALOG (Ye tumhari demand thi)
    if (!confirm("Kya tumne sach me aaj ka target pura kiya? Jhooth bolega to paap lagega! ğŸ¤¨")) {
        return; // Agar Cancel kiya to yahin ruk jao
    }

    // 3. Agar 'OK' kiya, tabhi aage badho
    challenge.day++;
    challenge.lastClaim = Date.now();
    
    // Streak Badhao (Sirf yahan badhegi)
    streak++;
    localStorage.setItem('st_streak', streak);
    localStorage.setItem('st_last_active_date', today); // Aaj ki date save karo

    // XP aur Challenge Logic
    addXP(100);
    
    if(challenge.day > challenge.target) {
        alert("ğŸ† CHALLENGE COMPLETED! You are a LEGEND!");
        document.getElementById('challengeMedal').style.display = 'block';
        addXP(1000);
    } else {
        alert("ğŸ”¥ Streak +1! Great job!");
    }
    
    localStorage.setItem('st_challenge', JSON.stringify(challenge));
    
    // UI Update karo
    checkChallenge();
    updateUI();
    confetti();
}

function deleteChallenge() {
    if(confirm("Delete Challenge?")) {
        challenge = {active:false};
        localStorage.setItem('st_challenge', JSON.stringify(challenge));
        checkChallenge();
    }
}

// --- âš™ï¸ SETTINGS & HELPERS ---

// --- ğŸ““ MISTAKE NOTEBOOK LOGIC ---
let mistakes = JSON.parse(localStorage.getItem('st_mistakes') || '[]');

function addMistake() {
    const txt = document.getElementById('newMistakeInput').value;
    const sub = document.getElementById('mistakeSubject').value;
    if(!txt) return;
    mistakes.unshift({id: Date.now(), text: txt, subject: sub});
    saveMistakes();
    document.getElementById('newMistakeInput').value = '';
}

function renderMistakes() {
    const list = document.getElementById('mistakeListContainer');
    if(!list) return;
    list.innerHTML = '';
    
    if(mistakes.length === 0) {
        list.innerHTML = '<div style="text-align:center; opacity:0.5; font-size:12px;">No mistakes recorded yet. Good job!</div>';
        return;
    }

    const colors = {'Phy': '#ef4444', 'Chem': '#fbbf24', 'Bio': '#10b981', 'Mock': '#a855f7'};

    mistakes.forEach(m => {
        let col = colors[m.subject] || '#fff';
        list.innerHTML += `
        <div class="task-row" style="border-left: 4px solid ${col};">
            <div style="flex:1;">
                <span style="font-size:10px; background:${col}; color:black; padding:2px 5px; border-radius:4px; font-weight:bold; margin-right:5px;">${m.subject}</span>
                <span style="font-size:13px;">${m.text}</span>
            </div>
            <button class="btn-icon" style="background:rgba(255,255,255,0.1); color:var(--danger);" onclick="deleteMistake(${m.id})">âœ–</button>
        </div>`;
    });
}

function deleteMistake(id) {
    mistakes = mistakes.filter(m => m.id !== id);
    saveMistakes();
}

function saveMistakes() {
    localStorage.setItem('st_mistakes', JSON.stringify(mistakes));
    renderMistakes();
}

// --- âš™ï¸ SETTINGS & XP FIX ---
function changeTheme(t) {
    localStorage.setItem('st_theme', t);
    document.body.className = `theme-${t}`;
}

// âœ… NEW: Smart Streak Checker (Sirf tooti hui streak check karega)
function checkStreak() {
   const today = new Date().toDateString();
   const lastActive = localStorage.getItem('st_last_active_date');
   
   // Agar pehli baar app khola hai (New User)
   if(!lastActive) return;

   const yesterday = new Date();
   yesterday.setDate(yesterday.getDate() - 1);
   const yesterdayStr = yesterday.toDateString();
   
   // Logic: Agar last active date "Aaj" nahi hai AUR "Kal" bhi nahi thi
   if(lastActive !== today && lastActive !== yesterdayStr) {
       
       // ğŸ”¥ Freeze Check Logic
       if(freezeCount > 0) {
           freezeCount--; 
           localStorage.setItem('st_freeze', freezeCount);
           // System ko trick karo ki kal active the (Taaki streak bachi rahe)
           localStorage.setItem('st_last_active_date', yesterdayStr);
           alert(`â„ï¸ STREAK SAVED! Ek Freeze use ho gaya. Bache hain: ${freezeCount}`);
       } else {
           // Freeze nahi hai, Streak gayi
           streak = 0;
           localStorage.setItem('st_streak', 0);
           alert("ğŸ’” Oops! Kal padhai nahi ki, Streak 0 ho gayi.");
       }
       updateUI();
   }
}
// XP Bug Fix: Ensures XP rolls over correctly
function addXP(n) {
    xp = parseInt(xp) + parseInt(n); // Ensure numbers
    let req = level * 1000;
    
    // Level Up Loop (in case multiple levels gained)
    while(xp >= req) { 
        xp -= req; 
        level++; 
        alert("ğŸ‰ LEVEL UP! You are now Level " + level);
        req = level * 1000; // Next level requirement increases
    }
    
    localStorage.setItem('st_xp', xp);
    localStorage.setItem('st_level', level);
    updateUI();
}
// --- ğŸ›ï¸ XP SHOP LOGIC (Ye missing tha) ---
function buyItem(type, cost) {
    // 1. Check karo XP hai ya nahi
    if(xp >= cost) {
        // 2. Confirmation lo
        if(confirm(`Kya aap sach me ${cost} XP kharch karke ye item lena chahte hain?`)) {
            
            // 3. XP Kaato
            xp = xp - cost;
            localStorage.setItem('st_xp', xp);
            
            // 4. Item Delivery logic
            if(type === 'freeze') {
                freezeCount++;
                localStorage.setItem('st_freeze', freezeCount);
                alert(`â„ï¸ Success! Streak Freeze khareed liya. Ab total freezes: ${freezeCount}`);
            } 
            else if(type === 'boost') {
                alert("âš¡ 1 Hour Boost Active! (Agli baar padhne par double maza aayega!)");
            }

            // 5. Balance update karo
            updateUI();
        }
    } else {
        alert("âŒ Gareebi! Aapke paas enough XP nahi hai. Padhai karke kamao! ğŸ˜…");
    }
}

function hardReset() {
    if(confirm("Factory Reset App? All data will be lost.")) {
        localStorage.clear();
        location.reload();
    }
}

// Global Note Save
// âœ… Correct Place for Modal Close
function closeModal(id) {
    document.getElementById(id).classList.add('hidden');
}

// Init
init();
</script>
  <script>
  // ğŸš€ Offline Support (Service Worker Link)
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('âœ… Service Worker Registered!', reg.scope))
        .catch(err => console.log('âŒ SW Failed!', err));
    });
  }
</script>

</body>

</html>
