<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Study Tracker — Upgraded</title>
<link rel="manifest" href="/manifest.json">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<!-- Google AdSense loader -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5520401672645952"
     crossorigin="anonymous"></script>
<style>
:root{
  --bg: linear-gradient(120deg,#0f1724,#071633);
  --card: rgba(255,255,255,0.04);
  --glass: rgba(255,255,255,0.06);
  --accent: #fff;
  --muted: rgba(255,255,255,0.75);
  --primary: #7c3aed;
  --success: #10b981;
  --danger: #ef4444;
  --rounded: 14px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:var(--accent)}
body{background:var(--bg);display:flex;align-items:center;justify-content:center;padding:18px}
.app{width:100%;max-width:1100px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:18px;padding:18px;backdrop-filter:blur(8px);box-shadow:0 20px 60px rgba(2,6,23,0.6);min-height:80vh;display:flex;flex-direction:column;gap:12px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#7c3aed,#2563eb);display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;font-size:18px}
.title{font-weight:700}
.controls{display:flex;gap:8px;align-items:center}
.btn{padding:8px 12px;border-radius:10px;border:none;background:rgba(255,255,255,0.06);color:var(--accent);cursor:pointer}
.btn.primary{background:var(--primary);color:white;font-weight:700}
.layout{display:grid;grid-template-columns:1fr 380px;gap:16px;margin-top:8px;flex:1;overflow:hidden}
.left{overflow:auto;padding-right:8px}
.right{overflow:auto;padding-left:8px}
.card{background:var(--card);padding:14px;border-radius:var(--rounded);box-shadow:0 8px 30px rgba(2,6,23,0.4)}
.section-title{display:flex;justify-content:space-between;align-items:center}
.task-form{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.input,select{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--accent)}
.addBtn{background:linear-gradient(90deg,#fff,#e6e6e6);color:#1f2937;padding:10px 14px;border-radius:10px;border:none}
.task-list{margin-top:12px;display:flex;flex-direction:column;gap:10px}
.task-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:linear-gradient(120deg,rgba(255,255,255,0.01),rgba(255,255,255,0.02));border-left:6px solid var(--primary)}
.small{font-size:13px;color:var(--muted)}
.timer-big{font-size:36px;font-weight:800;text-align:center}
.flex{display:flex;gap:8px}
.progress{height:8px;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden}
.progress > i{display:block;height:100%;background:linear-gradient(90deg,#7c3aed,#2563eb);width:0}
.charts{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.footer{display:flex;justify-content:space-between;align-items:center;margin-top:8px;font-size:13px;color:var(--muted)}
.toggle{display:inline-flex;align-items:center;gap:8px}
/* responsive */
@media (max-width:980px){.layout{grid-template-columns:1fr}.charts{grid-template-columns:1fr}.right{order:2}}
</style>
</head>
<body>
<div class="app" id="app">
  <div class="header">
    <div class="brand">
      <div class="logo">ST</div>
      <div>
        <div class="title">Study Tracker — Upgraded</div>
        <div class="small">Plan • Focus • Finish</div>
      </div>
    </div>
    <div class="controls">
      <select id="themePack" class="input" title="Theme packs">
        <option value="default">Default</option>
        <option value="neo-blue">Neo Blue</option>
        <option value="sunset">Sunset</option>
        <option value="mint">Mint</option>
        <option value="dark-pro">Dark Pro</option>
        <option value="auto">Auto</option>
      </select>
      <div class="toggle small" id="darkToggle">Dark</div>
      <button class="btn" id="importBtn" title="Import JSON">Import</button>
      <button class="btn" id="exportBtn">Export</button>
      <button class="btn primary" id="addTaskBtnTop">New Task</button>
    </div>
  </div>

  <div class="layout">
    <div class="left">
      <div class="card">
        <div class="section-title"><h3 style="margin:0">Profile</h3><div class="small" id="profileActions"></div></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
          <div>
            <div id="userHello" style="font-weight:800">Hello, Student</div>
            <div class="small" id="userClass">Add your class</div>
          </div>
          <div>
            <button class="btn" id="editProfile">Edit</button>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="section-title"><h3 style="margin:0">Tasks</h3><div class="small" id="taskSummary">0 tasks • 0 min</div></div>

        <div class="task-form" style="margin-top:8px">
          <input id="taskName" class="input" placeholder="Task / Topic">
          <input id="taskHours" class="input" type="number" min="0" placeholder="hrs" style="width:100px">
          <input id="taskMins" class="input" type="number" min="0" placeholder="mins" style="width:100px">
          <select id="taskSub" class="input" style="min-width:120px"><option>General</option><option>Math</option><option>Physics</option><option>Chemistry</option><option>Biology</option></select>
          <button class="addBtn" id="addTask">Add</button>
        </div>

        <div class="task-list" id="tasksList"></div>

      </div>

      <div class="card" style="margin-top:12px">
        <div class="section-title"><h3 style="margin:0">Pomodoro / Focus</h3><div class="small">Auto-logging enabled</div></div>
        <div style="display:flex;gap:12px;align-items:center;margin-top:10px">
          <input id="pomMinutes" type="number" class="input" value="25" style="width:90px">
          <button class="btn primary" id="pomStart">Start</button>
          <button class="btn" id="pomPause">Pause</button>
          <button class="btn" id="pomStop">Stop</button>
        </div>
        <div style="margin-top:12px;text-align:center">
          <div class="timer-big" id="pomTimer">25:00</div>
          <div class="small">Current Task: <span id="pomTask">—</span></div>
        </div>
      </div>

    </div>

    <div class="right">
      <div class="card">
        <div class="section-title"><h3 style="margin:0">Stats</h3><div class="small">Last 7 days</div></div>
        <div style="margin-top:12px">
          <canvas id="weeklyChart" height="120"></canvas>
        </div>
        <div class="charts" style="margin-top:12px">
          <div class="card" style="padding:10px">
            <div class="small">Today</div>
            <div style="font-weight:800;font-size:20px;margin-top:6px" id="todayStat">0 min</div>
            <div class="small" style="margin-top:8px" id="todayTasks">0 tasks</div>
          </div>
          <div class="card" style="padding:10px">
            <div class="small">Streak</div>
            <div style="font-weight:800;font-size:20px;margin-top:6px" id="streak">0 days</div>
            <div class="small" style="margin-top:8px" id="goalProgress">Goal: 0/0 min</div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="section-title"><h3 style="margin:0">Quick Actions</h3><div class="small">Export, reminders, cache</div></div>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn" id="exportCSV">Export CSV</button>
          <button class="btn" id="clearData">Clear</button>
          <button class="btn" id="enableNotif">Enable Notifications</button>
        </div>
        <div style="margin-top:12px" class="small">Reminders:</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="remTime" type="time" class="input" style="width:130px">
          <button class="btn" id="addReminder">Add</button>
        </div>
        <div id="remList" style="margin-top:10px" class="small"></div>
      </div>

    </div>
  </div>

  <div class="footer">
    <div>POWERED BY ABHI SARSWAT — Upgraded • Offline-ready</div>
    <div class="small">Version 2.0</div>
  </div>
</div>

<script>
/* -------------------- State & Storage -------------------- */
const uid = ()=>Date.now().toString(36)+Math.random().toString(36).slice(2,6);
let profile = JSON.parse(localStorage.getItem('st_profile')||'null');
let tasks = JSON.parse(localStorage.getItem('st_tasks')||'[]');
let history = JSON.parse(localStorage.getItem('st_history')||'{}'); // { '2025-11-24': 1500 }
let reminders = JSON.parse(localStorage.getItem('st_reminders')||'[]');
let settings = JSON.parse(localStorage.getItem('st_settings')||'{}');
settings.goal = settings.goal || 60; // daily goal minutes

/* DOM */
const userHello = document.getElementById('userHello');
const userClass = document.getElementById('userClass');
const editProfile = document.getElementById('editProfile');
const tasksList = document.getElementById('tasksList');
const taskSummary = document.getElementById('taskSummary');
const addTaskBtn = document.getElementById('addTask');
const addTaskBtnTop = document.getElementById('addTaskBtnTop');
const taskName = document.getElementById('taskName');
const taskHours = document.getElementById('taskHours');
const taskMins = document.getElementById('taskMins');
const taskSub = document.getElementById('taskSub');
const weeklyChartCtx = document.getElementById('weeklyChart').getContext('2d');
const todayStat = document.getElementById('todayStat');
const todayTasks = document.getElementById('todayTasks');
const streakEl = document.getElementById('streak');
const goalProgress = document.getElementById('goalProgress');
const exportBtn = document.getElementById('exportBtn');
const importBtn = document.getElementById('importBtn');
const exportCSV = document.getElementById('exportCSV');
const clearDataBtn = document.getElementById('clearData');
const enableNotif = document.getElementById('enableNotif');
const remTime = document.getElementById('remTime');
const addReminder = document.getElementById('addReminder');
const remList = document.getElementById('remList');
const pomStart = document.getElementById('pomStart');
const pomPause = document.getElementById('pomPause');
const pomStop = document.getElementById('pomStop');
const pomMinutes = document.getElementById('pomMinutes');
const pomTimer = document.getElementById('pomTimer');
const pomTask = document.getElementById('pomTask');
const themePack = document.getElementById('themePack');
const darkToggle = document.getElementById('darkToggle');

/* Helpers */
function todayISO(){ return new Date().toISOString().slice(0,10); }
function formatTime(sec){ const m=Math.floor(sec/60); const s=sec%60; return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}` }
function saveAll(){ localStorage.setItem('st_tasks', JSON.stringify(tasks)); localStorage.setItem('st_history', JSON.stringify(history)); localStorage.setItem('st_profile', JSON.stringify(profile)); localStorage.setItem('st_reminders', JSON.stringify(reminders)); localStorage.setItem('st_settings', JSON.stringify(settings)); }

/* -------------------- Profile -------------------- */
function applyProfile(){ if(profile){ userHello.textContent = `Hello, ${profile.name}`; userClass.textContent = profile.cls; } else { userHello.textContent = 'Hello, Student'; userClass.textContent = 'Add your class'; }}
editProfile.onclick = ()=>{ const n = prompt('Naam'); const c = prompt('Class / Exam'); if(n && c){ profile={name:n,cls:c}; saveAll(); applyProfile(); }};
applyProfile();

/* -------------------- Tasks UI -------------------- */
function pickColor(sub){ const map={Math:'#ef4444',Physics:'#60a5fa',Chemistry:'#fb923c',Biology:'#34d399',General:'#7c3aed'}; return map[sub]||'#7c3aed'; }

function renderTasks(){ tasksList.innerHTML=''; let totalDone=0; tasks.forEach((t,idx)=>{
  const div=document.createElement('div'); div.className='task-item'; div.style.borderLeft=`6px solid ${t.color||pickColor(t.sub)}`;
  const left=document.createElement('div'); left.innerHTML=`<div style="font-weight:700">${escapeHtml(t.name)}</div><div class="small">${t.sub} • Target ${Math.floor(t.time/60)}h ${t.time%60}m</div>`;
  const right=document.createElement('div'); right.style.textAlign='right';
  const timer=document.createElement('div'); timer.className='small'; const doneSec = (t.time*60 - (t.timeLeft||0)); totalDone += Math.round(doneSec/60);
  timer.textContent = `Done: ${Math.round(doneSec/60)} min`;
  const actions=document.createElement('div'); actions.className='flex';
  const start=document.createElement('button'); start.className='btn'; start.textContent = t.running? 'Pause':'Start';
  const focus=document.createElement('button'); focus.className='btn'; focus.textContent='Focus';
  const del=document.createElement('button'); del.className='btn'; del.textContent='Delete';
  actions.append(start,focus,del);
  right.append(timer,actions);
  div.append(left,right);
  tasksList.appendChild(div);

  start.onclick = ()=>{ if(!t.timeLeft) t.timeLeft = t.time*60; t.running = !t.running; if(t.running) playBeep('start'); saveAll(); renderTasks(); };
  focus.onclick = ()=>{ startFocusOnTask(t); };
  del.onclick = ()=>{ if(confirm('Delete?')){ tasks.splice(idx,1); saveAll(); renderTasks(); updateStats(); } };
});
 taskSummary.textContent = `${tasks.length} tasks • ${totalDone} min`;
}

addTaskBtn.onclick = addTask; addTaskBtnTop.onclick = ()=>{ document.getElementById('taskName').focus(); };
function addTask(){ const name=(taskName.value||'').trim(); if(!name){ alert('Task name'); return; } let h=parseInt(taskHours.value)||0; let m=parseInt(taskMins.value)||0; if(h===0 && m===0){ alert('Time set karo'); return; } const total=h*60+m; const t={id:uid(),name,sub:taskSub.value||'General',time:total,timeLeft:total*60,running:false,color:pickColor(taskSub.value||'General')}; tasks.unshift(t); taskName.value=''; taskHours.value=''; taskMins.value=''; saveAll(); renderTasks(); updateStats(); }

function escapeHtml(s){ return String(s).replace(/[&<>'"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* -------------------- Global ticker -------------------- */
setInterval(()=>{
  let dirty=false; const today=todayISO(); tasks.forEach(t=>{
    if(t.running && t.timeLeft>0){ t.timeLeft--; dirty=true; history[today]=(history[today]||0)+1; }
    if(t.running && t.timeLeft===0){ t.running=false; playBeep('end'); notify('Task complete', t.name); launchConfetti(); }
  });
  if(dirty){ saveAll(); renderTasks(); updateChart(); updateStats(); }
},1000);

/* -------------------- Pomodoro -------------------- */
let pomInterval=null, pomSeconds=0, pomTarget=null;
function startFocusOnTask(task){ pomTarget = task; openPom(); startPom(); }
function openPom(){ pomTask.textContent = pomTarget? pomTarget.name : '—'; }
function startPom(){ const mins = parseInt(pomMinutes.value)||25; if(pomTarget){ pomSeconds = Math.min(pomTarget.timeLeft || (pomTarget.time*60), mins*60); } else pomSeconds = mins*60; if(pomInterval) clearInterval(pomInterval);
 pomInterval = setInterval(()=>{ if(pomSeconds>0){ pomSeconds--; updatePomUI(); if(pomTarget){ pomTarget.timeLeft = pomSeconds; } } else { clearInterval(pomInterval); pomInterval=null; playBeep('end'); notify('Focus complete','Good job!'); launchConfetti(); saveAll(); renderTasks(); updateStats(); } },1000); }
function updatePomUI(){ pomTimer.textContent = formatTime(pomSeconds); }
function pausePom(){ if(pomInterval) clearInterval(pomInterval), pomInterval=null; }
function stopPom(){ if(pomInterval) clearInterval(pomInterval); pomInterval=null; pomSeconds=0; pomTimer.textContent='00:00'; pomTarget=null; pomTask.textContent='—'; }
pomStart.onclick = ()=> startPom(); pomPause.onclick = ()=> pausePom(); pomStop.onclick = ()=> stopPom();

/* -------------------- Chart -------------------- */
let chart=null; function initChart(){ const labels = lastNDates(7).map(d=>d.slice(5)); const data = lastNDates(7).map(d=>Math.round((history[d]||0)/60)); chart = new Chart(weeklyChartCtx, { type:'line', data:{ labels, datasets:[{label:'Minutes', data, fill:true, tension:0.35, backgroundColor:'rgba(255,255,255,0.06)', borderColor:'rgba(255,255,255,0.95)', pointRadius:4}]}, options:{scales:{y:{beginAtZero:true,ticks:{color:'rgba(255,255,255,0.9)'}},x:{ticks:{color:'rgba(255,255,255,0.9)'}}},plugins:{legend:{display:false}} } }); }
function updateChart(){ if(!chart) initChart(); const labels = lastNDates(7).map(d=>d.slice(5)); chart.data.labels = labels; chart.data.datasets[0].data = lastNDates(7).map(d=>Math.round((history[d]||0)/60)); chart.update(); }
function lastNDates(n){ const arr=[]; for(let i=n-1;i>=0;i--){ const dt=new Date(); dt.setDate(dt.getDate()-i); arr.push(dt.toISOString().slice(0,10)); } return arr; }

/* -------------------- Stats -------------------- */
function updateStats(){ const today=todayISO(); const mins = Math.round((history[today]||0)/60); todayStat.textContent = `${mins} min`; todayTasks.textContent = `${tasks.length} tasks`; const streak = calcStreak(); streakEl.textContent = `${streak} days`; goalProgress.textContent = `Goal: ${mins}/${settings.goal} min`; }
function calcStreak(){ let s=0; const arr=lastNDates(30).reverse(); for(const d of arr){ const m = Math.round((history[d]||0)/60); if(m>=settings.goal) s++; else break; } return s; }

/* -------------------- Notifications & Reminders -------------------- */
let notificationsAllowed = Notification && Notification.permission==='granted';
function requestNotifications(){ if(!('Notification' in window)) return; if(Notification.permission==='default') Notification.requestPermission().then(p=>{ notificationsAllowed = p==='granted'; }); else notificationsAllowed = Notification.permission==='granted'; }
enableNotif.onclick = requestNotifications;
function notify(title, body){ if(notificationsAllowed){ try{ new Notification(title, { body }); }catch(e){ console.log('notify err',e); } } else requestNotifications(); }

addReminder.onclick = ()=>{ const t = remTime.value; if(!t) return alert('Time choose karo'); reminders.push({id:uid(),time:t}); saveAll(); renderReminders(); }
function renderReminders(){ remList.innerHTML=''; reminders.forEach(r=>{ const d=document.createElement('div'); d.className='small'; d.textContent = r.time + ' '; const del=document.createElement('button'); del.className='btn'; del.style.marginLeft='8px'; del.textContent='Remove'; del.onclick=()=>{ reminders = reminders.filter(x=>x.id!==r.id); saveAll(); renderReminders(); }; d.appendChild(del); remList.appendChild(d); }); }
setInterval(()=>{ const now = new Date(); const hh = String(now.getHours()).padStart(2,'0'); const mm = String(now.getMinutes()).padStart(2,'0'); const key=`${hh}:${mm}`; reminders.forEach(r=>{ if(r.time===key){ notify('Reminder', `Time for ${r.time}`); } }); },60000);

/* -------------------- Export / Import -------------------- */
exportBtn.onclick = ()=>{ const data = {profile,tasks,history,reminders,settings}; const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='study-tracker-backup.json'; a.click(); URL.revokeObjectURL(url); };
importBtn.onclick = ()=>{ const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json'; inp.onchange = e=>{ const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload = ()=>{ try{ const data = JSON.parse(r.result); if(confirm('Import will overwrite local data. Continue?')){ profile=data.profile||profile; tasks=data.tasks||tasks; history=data.history||history; reminders=data.reminders||reminders; settings=data.settings||settings; saveAll(); renderAll(); } }catch(err){ alert('Invalid file'); } }; r.readAsText(f); }; inp.click(); };

exportCSV.onclick = ()=>{ const rows=[['date','minutes']]; Object.entries(history).forEach(([k,v])=> rows.push([k, Math.round(v/60)])); const csv = rows.map(r=>r.join(',')).join('\n'); const blob = new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='study-history.csv'; a.click(); URL.revokeObjectURL(url); };

clearDataBtn.onclick = ()=>{ if(confirm('Clear all local data?')){ localStorage.clear(); profile=null; tasks=[]; history={}; reminders=[]; settings={goal:60}; saveAll(); renderAll(); } };

/* -------------------- Confetti & Sounds -------------------- */
const confCanvas = document.createElement('canvas'); confCanvas.style.position='fixed'; confCanvas.style.inset='0'; confCanvas.style.pointerEvents='none'; confCanvas.style.zIndex='9999'; document.body.appendChild(confCanvas); const confCtx = confCanvas.getContext('2d'); function resizeConf(){ confCanvas.width=window.innerWidth; confCanvas.height=window.innerHeight; } window.addEventListener('resize', resizeConf); resizeConf(); let confetti=[]; function launchConfetti(){ confetti=[]; const W=confCanvas.width,H=confCanvas.height; for(let i=0;i<120;i++){ confetti.push({x:Math.random()*W,y:Math.random()*H-100, r:Math.random()*8+4, dx:(Math.random()-0.5)*6, dy:Math.random()*3+2, rot:Math.random()*360, color:`hsl(${Math.random()*360},90%,60%)`, life:Math.random()*60+60}); } requestAnimationFrame(confLoop); setTimeout(()=>confetti=[],2000); }
function confLoop(){ confCtx.clearRect(0,0,confCanvas.width,confCanvas.height); confetti.forEach(p=>{ confCtx.save(); confCtx.translate(p.x,p.y); confCtx.rotate(p.rot*Math.PI/180); confCtx.fillStyle=p.color; confCtx.fillRect(-p.r/2,-p.r/2,p.r,p.r*0.6); confCtx.restore(); p.x+=p.dx; p.y+=p.dy; p.rot+=6; }); if(confetti.length) requestAnimationFrame(confLoop); }

const AudioCtx = window.AudioContext || window.webkitAudioContext; const audioCtx = new AudioCtx(); function playBeep(type){ const now=audioCtx.currentTime; const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); if(type==='start'){ o.frequency.setValueAtTime(330,now); o.frequency.linearRampToValueAtTime(660,now+0.12); g.gain.setValueAtTime(0.0001,now); g.gain.exponentialRampToValueAtTime(0.3,now+0.02); g.gain.exponentialRampToValueAtTime(0.0001,now+0.18); } else { o.frequency.setValueAtTime(660,now); o.frequency.exponentialRampToValueAtTime(220,now+0.18); g.gain.setValueAtTime(0.0001,now); g.gain.exponentialRampToValueAtTime(0.25,now+0.02); g.gain.exponentialRampToValueAtTime(0.0001,now+0.3); } o.start(now); o.stop(now+0.35); }

/* -------------------- Theme Packs -------------------- */
const THEME_PRESETS = { default:{'--bg':'linear-gradient(120deg,#0f1724,#071633)'}, 'neo-blue':{'--bg':'linear-gradient(120deg,#0ea5e9,#6366f1)'}, 'sunset':{'--bg':'linear-gradient(120deg,#ff7a18,#af002d)'}, 'mint':{'--bg':'linear-gradient(120deg,#a7f3d0,#4ade80)'}, 'dark-pro':{'--bg':'linear-gradient(120deg,#020617,#071633)'} };
function applyTheme(key){ if(key==='auto'){ const h=new Date().getHours(); key = (h>=6 && h<18)? 'mint':'dark-pro'; } const preset = THEME_PRESETS[key]||THEME_PRESETS.default; Object.entries(preset).forEach(([k,v])=> document.documentElement.style.setProperty(k,v)); localStorage.setItem('st_themePack',key); }
const savedPack = localStorage.getItem('st_themePack')||'default'; themePack.value = savedPack; applyTheme(savedPack); themePack.addEventListener('change', ()=> applyTheme(themePack.value));

/* -------------------- Reminder check and init -------------------- */
function checkRemindersLoop(){ const now=new Date(); const hh=String(now.getHours()).padStart(2,'0'); const mm=String(now.getMinutes()).padStart(2,'0'); const key=`${hh}:${mm}`; reminders.forEach(r=>{ if(r.time===key){ notify('Reminder', `It's time: ${r.time}`); } }); }
setInterval(checkRemindersLoop,60000);

/* -------------------- Render all -------------------- */
function renderAll(){ renderTasks(); renderReminders(); updateChart(); updateStats(); applyProfile(); }
renderAll();

/* -------------------- Import initial demo if empty -------------------- */
if(!tasks.length && !Object.keys(history).length){ const demoTask={id:uid(),name:'Revision: Algebra',sub:'Math',time:60,timeLeft:60*60,running:false,color:pickColor('Math')}; tasks.push(demoTask); history[todayISO()]=60*60; saveAll(); renderAll(); }
/* -------------------- Service Worker registration -------------------- */
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js')
    .then(() => console.log('Service Worker registered'))
    .catch(e => console.log('SW registration failed', e));
}
/* -------------------- Utility: start focus on a selected task -------------------- */
function startFocusOnTaskById(id){ const t=tasks.find(x=>x.id===id); if(t){ startFocusOnTask(t); } }

/* -------------------- Initial chart init -------------------- */
initChart();

</script>

</body>
</html>
