<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="theme-color" content="#0f1724">
<title>Study Arc ‚Äî Focus & Conquer</title>
<link rel="icon" href="icons/app-logo-192.png" type="image/png">
<link rel="manifest" href="manifest.json?v=3">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5520401672645952" crossorigin="anonymous"></script>

<style>
/* --- ORIGINAL PREMIUM CSS (Untouched) --- */
:root {
  --bg-gradient: linear-gradient(135deg, #0f1724 0%, #071633 100%);
  --glass-bg: rgba(255, 255, 255, 0.05);
  --glass-border: 1px solid rgba(255, 255, 255, 0.1);
  --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
  --backdrop: blur(12px);
  --accent: #38bdf8;
  --accent-grad: linear-gradient(90deg, #38bdf8, #818cf8);
  --text: #ffffff;
  --text-muted: rgba(255, 255, 255, 0.6);
  --danger: #ef4444;
  --success: #10b981;
  --font-main: 'Inter', system-ui, -apple-system, sans-serif;
}

body.theme-sunset { --bg-gradient: linear-gradient(135deg, #4c1d95, #be185d); --accent: #fbbf24; --accent-grad: linear-gradient(90deg, #fbbf24, #f59e0b); }
body.theme-mint { --bg-gradient: linear-gradient(135deg, #064e3b, #065f46); --accent: #34d399; --accent-grad: linear-gradient(90deg, #34d399, #10b981); }
/* --- üëá NEW THEMES (Paste below existing themes) --- */
/* 1. AMOLED (Pitch Black) */
body.theme-amoled { --bg-gradient: #000000; --glass-bg: rgba(20, 20, 20, 0.9); --glass-border: 1px solid #333; --accent: #ffffff; --accent-grad: linear-gradient(90deg, #ffffff, #999999); --text-muted: #888; }

/* 2. Cyberpunk (Neon) */
body.theme-cyber { --bg-gradient: linear-gradient(135deg, #0b0014, #180028); --glass-bg: rgba(255, 0, 200, 0.05); --glass-border: 1px solid rgba(0, 255, 234, 0.3); --accent: #00ffea; --accent-grad: linear-gradient(90deg, #f000ff, #00ffea); --text: #fff; --text-muted: #f000ff; }

/* 3. Midnight (Deep Blue) */
body.theme-midnight { --bg-gradient: linear-gradient(135deg, #02111b, #0c2d48); --glass-bg: rgba(100, 150, 255, 0.05); --accent: #5da9e9; --accent-grad: linear-gradient(90deg, #4facfe, #00f2fe); }

/* --- CHALLENGE PROGRESS BAR --- */
.challenge-box { margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 15px; border: 1px solid var(--glass-border); }
.progress-container { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-top: 10px; overflow: hidden; }
.progress-fill { height: 100%; background: var(--accent-grad); width: 0%; transition: width 0.5s ease; }

* { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
body { margin: 0; font-family: var(--font-main); background: var(--bg-gradient); color: var(--text); min-height: 100vh; overflow-x: hidden; }

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }

/* Layout */
.app-container { max-width: 1200px; margin: 0 auto; padding: 20px; display: grid; grid-template-columns: 280px 1fr; gap: 20px; height: 100vh; overflow: hidden; }

/* Glass Components */
.glass-panel {
  background: var(--glass-bg);
  backdrop-filter: var(--backdrop);
  -webkit-backdrop-filter: var(--backdrop);
  border: var(--glass-border);
  border-radius: 20px;
  box-shadow: var(--glass-shadow);
  padding: 20px;
  overflow-y: auto;
}

/* Sidebar */
.sidebar { display: flex; flex-direction: column; gap: 20px; height: 100%; }
.brand { font-size: 24px; font-weight: 800; background: var(--accent-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -1px; }
.nav-item { padding: 12px; border-radius: 12px; cursor: pointer; transition: 0.3s; color: var(--text-muted); display: flex; align-items: center; gap: 10px; font-weight: 500; }
.nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.1); color: var(--text); border-left: 4px solid var(--accent); }
.community-widget { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(6, 78, 59, 0.2)); padding: 15px; border-radius: 15px; border: 1px solid rgba(16, 185, 129, 0.3); font-size: 13px; animation: pulse 3s infinite; }
@keyframes pulse { 0% {box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4);} 70% {box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);} 100% {box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);} }

/* Main Content */
.main-content { display: flex; flex-direction: column; gap: 20px; height: 100%; overflow-y: auto; }
.header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; }
.greeting h1 { margin: 0; font-size: 28px; }
.greeting p { margin: 5px 0 0; color: var(--text-muted); font-size: 14px; }

/* Cards & Stats */
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
.stat-card { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 16px; text-align: center; border: 1px solid rgba(255,255,255,0.05); position: relative; overflow: hidden; }
.stat-val { font-size: 28px; font-weight: 800; margin-top: 5px; color: var(--accent); }
.stat-label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }

/* Buttons & Inputs */
.btn { border: none; padding: 10px 20px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: 0.2s; font-family: var(--font-main); }
.btn-primary { background: var(--accent-grad); color: #000; box-shadow: 0 4px 15px rgba(56, 189, 248, 0.3); }
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(56, 189, 248, 0.4); }
.btn-ghost { background: rgba(255,255,255,0.1); color: white; }
.input, .select { width: 100%; padding: 12px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: white; margin-bottom: 10px; font-family: var(--font-main); }
.input:focus { border-color: var(--accent); }

/* Task List */
.task-item { display: flex; align-items: center; justify-content: space-between; padding: 15px; margin-bottom: 10px; background: rgba(255,255,255,0.03); border-radius: 12px; border-left: 4px solid var(--accent); transition: 0.2s; }
.task-item:hover { transform: translateX(5px); background: rgba(255,255,255,0.06); }
.task-actions { display: flex; gap: 8px; }

/* SIMPLE FOCUS MODE OVERLAY (No Flip Clock) */
#focusOverlay { position: fixed; inset: 0; background: var(--bg-gradient); z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; transform: translateY(100%); transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
#focusOverlay.active { transform: translateY(0); }
.timer-huge { font-size: 80px; font-weight: 900; font-variant-numeric: tabular-nums; background: var(--accent-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

/* Modals & New Features */
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 2000; display: flex; align-items: center; justify-content: center; }
.hidden { display: none !important; }

/* Exam Guide Cards */
.guide-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; margin-bottom: 15px; overflow: hidden; transition: 0.3s; }
.guide-header { padding: 15px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; background: rgba(255,255,255,0.02); }
.guide-content { padding: 0 15px; max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; color: var(--text-muted); font-size: 14px; line-height: 1.6; }
.guide-content.open { padding: 15px; max-height: 1000px; border-top: 1px solid rgba(255,255,255,0.1); }

/* Math Toolbar */
.math-toolbar { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 5px; }
.math-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 5px 12px; border-radius: 8px; cursor: pointer; font-size: 14px; }

/* Ads Area */
.ad-slot { width: 100%; text-align: center; margin: 10px 0; background: rgba(0,0,0,0.2); border-radius: 12px; overflow: hidden; min-height: 60px; display:flex; justify-content:center; align-items:center; flex-direction:column; }
.ad-label { font-size: 10px; color: #555; text-transform: uppercase; margin-bottom: 2px; }

@media (max-width: 768px) {
  .app-container { grid-template-columns: 1fr; height: auto; overflow: visible; padding: 10px; }
  .sidebar { display: none; }
  .timer-huge { font-size: 60px; }
}
</style>
</head>
<body class="theme-mint">

<canvas id="confetti-canvas" style="position:fixed; pointer-events:none; top:0; left:0; width:100%; height:100%; z-index:3000;"></canvas>

<div id="onboardingModal" class="modal hidden">
  <div class="glass-panel" style="max-width: 400px; text-align: center;">
    <h2>üöÄ Welcome to Study Arc</h2>
    <p>Let's personalize your experience.</p>
    <input id="obName" class="input" placeholder="Your Name (e.g., Abhinav)">
    <input id="obClass" class="input" placeholder="Target Exam (e.g., NEET)">
    <button class="btn btn-primary" style="width: 100%;" onclick="completeOnboarding()">Start Journey</button>
  </div>
</div>

<div id="focusOverlay">
  <div style="font-size: 16px; letter-spacing: 2px; text-transform: uppercase; color: var(--accent); margin-bottom: 20px;" id="focusSubjectDisplay">PHYSICS</div>
  
  <div class="timer-huge" id="focusTimerDisplay">00:00:00</div>
  
  <div style="margin-top: 20px; color: var(--text-muted); font-style: italic;">"Pain is temporary. Glory is forever."</div>
  
  <div style="display: flex; gap: 20px; margin-top: 40px;">
    <button id="btnPause" class="btn btn-ghost" style="border:1px solid white;" onclick="toggleTimer()">‚è∏Ô∏è Pause</button>
    <button class="btn" style="background: var(--danger); color: white;" onclick="exitFocus()">Stop Session</button>
  </div>
  <div style="margin-top: 20px; font-size: 10px; opacity: 0.5;">SCREEN WAKE LOCK ACTIVE üí°</div>
</div>

<div class="app-container">
  
  <aside class="sidebar glass-panel">
    <div class="brand">STUDY ARC</div>
    
    <div class="challenge-box">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span style="font-size:12px; font-weight:bold; color:var(--accent);">MY CHALLENGE</span>
            <span id="challengeStatus" style="font-size:10px;">Active</span>
        </div>
        <div id="challengeText" style="font-size:18px; font-weight:800; margin-top:5px;">Set Goal üëá</div>
        <div class="progress-container">
            <div id="challengeBar" class="progress-fill" style="width: 0%;"></div>
        </div>
        <div style="font-size:11px; margin-top:5px; text-align:right; opacity:0.7;">
            Day <span id="challengeDay">0</span> / <span id="challengeTarget">0</span>
        </div>
    </div>

    <nav style="display: flex; flex-direction: column; gap: 10px; margin-top:10px;">
      <div class="nav-item active" onclick="showSection('dashboard')">üìä Dashboard</div>
      <div class="nav-item" onclick="showSection('guide')">‚ÑπÔ∏è Exam Guide</div>
      <div class="nav-item" onclick="showSection('planner')">ü§ñ AI Planner</div>
      <div class="nav-item" onclick="showSection('notes')">üìù Scratchpad</div>
      <div class="nav-item" onclick="showSection('settings')">‚öôÔ∏è Settings</div>
    </nav>
    
    <div style="margin-top: auto;">
      <div class="community-widget">
        <div style="display:flex; align-items:center; gap:8px; margin-bottom:5px;">
          <div style="width:8px; height:8px; background:#10b981; border-radius:50%;"></div>
          <strong style="color:#10b981">LIVE NOW</strong>
        </div>
        <span id="liveUsers">1,240</span> students focusing.
      </div>
      
      <div class="ad-slot">
          <span class="ad-label">Sponsored</span>
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-5520401672645952"
               data-ad-slot="9706016855"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
          <script>
               (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
      </div>
    </div>
  </aside>

  <main class="main-content">
    
    <div id="section-dashboard">
      <div class="header">
        <div class="greeting">
          <h1 id="userGreet">Hello, Student</h1>
          <p id="dateDisplay">Let's crush your goals today!</p>
        </div>
        
        <div style="display:flex; gap:10px; align-items:center;">
            <div class="glass-panel" style="padding: 10px 15px; min-width: 140px; text-align: center; border: 1px solid var(--accent);">
                <div id="rankDisplay" style="font-weight:bold;">üå± Beginner</div>
                <div style="font-size:10px; opacity:0.7;">Lifetime Streak</div>
            </div>
            <button id="btnClaim" class="btn" style="background:var(--success); padding:10px 15px; display:none;" onclick="openClaimModal()">
                üèÜ Claim
            </button>
        </div>
      </div>

      <div class="ad-slot">
          <span class="ad-label">Sponsored</span>
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-5520401672645952"
               data-ad-slot="2938617898"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
          <script>
               (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
      </div>

      <div class="glass-panel" style="margin-bottom: 20px; border: 1px solid var(--accent);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <h3 style="margin:0;">‚ö° Quick Focus Session</h3>
        </div>
        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 10px; align-items: center;">
            <select id="quickSubject" class="input" style="margin:0;">
                <option value="Physics">Physics</option>
                <option value="Chemistry">Chemistry</option>
                <option value="Biology">Biology</option>
                <option value="Maths">Maths</option>
            </select>
            <input id="quickHrs" type="number" class="input" placeholder="Hr" value="0" style="margin:0;">
            <input id="quickMins" type="number" class="input" placeholder="Min" value="45" style="margin:0;">
            <button class="btn btn-primary" onclick="startQuickFocus()">START ‚ñ∂</button>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Studied Today</div>
          <div class="stat-val" id="todayTime">0h 0m</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Focus</div>
          <div class="stat-val" id="totalFocusTime">0h</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Subject Analysis</div>
          <div style="height: 100px; margin-top: 10px;">
            <canvas id="subjectChart"></canvas>
          </div>
        </div>
      </div>

      <div class="glass-panel" style="margin-top: 20px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
          <h3>‚úÖ Tasks Checklist</h3>
          <button class="btn btn-ghost" style="font-size:12px;" onclick="toggleTaskForm()">+ New Task</button>
        </div>
        
        <div id="addTaskForm" style="display:none; margin-bottom:15px; background:rgba(0,0,0,0.2); padding:10px; border-radius:10px;">
          <input id="newTaskName" class="input" placeholder="Task Name (e.g., Physics Chapter 1)">
          <div style="display:flex; gap:10px;">
            <button class="btn btn-primary" onclick="addTask()">Add Task</button>
          </div>
        </div>

        <div id="taskListContainer"></div>
      </div>
    </div>

   <div id="section-guide" class="hidden">
      <div class="glass-panel">
        <h2>‚ÑπÔ∏è Exam Success Hub</h2>
        <p style="color:var(--text-muted); margin-bottom:20px;">Detailed strategy, subject-wise hacks & official resources.</p>
        
        <div class="guide-card">
            <div class="guide-header" onclick="toggleGuide(this)">
                <strong>ü©∫ NEET (Medical) Master Strategy</strong> <span>‚ñº</span>
            </div>
            <div class="guide-content">
                <h4 style="color:var(--accent); margin-top:0;">üéØ The 720 Marks Strategy</h4>
                <ul>
                    <li><strong>Biology (360/360):</strong> NCERT is your Bible. Read it line-by-line. Diagrams and summaries are crucial. Don't read external books for Bio unless necessary.</li>
                    <li><strong>Physics (180/180):</strong> Stop memorizing! Understand the concept. Practice 50+ MCQs daily. Focus on Mechanics and Electrodynamics.</li>
                    <li><strong>Chemistry (180/180):</strong>
                        <ul>
                            <li><em>Organic:</em> Understand mechanisms (GOC is key).</li>
                            <li><em>Inorganic:</em> Ratta-fication of NCERT exceptions.</li>
                            <li><em>Physical:</em> Formula sheet is mandatory.</li>
                        </ul>
                    </li>
                </ul>
                <p><strong>Pro Tip:</strong> Attempt at least 1 full mock test every Sunday.</p>
            </div>
        </div>

        <div class="guide-card">
            <div class="guide-header" onclick="toggleGuide(this)">
                <strong>üë∑ JEE Mains & Advanced Roadmap</strong> <span>‚ñº</span>
            </div>
            <div class="guide-content">
                <h4 style="color:var(--accent); margin-top:0;">üöÄ Engineering Excellence</h4>
                <ul>
                    <li><strong>Maths:</strong> Practice is everything. Focus on Calculus and Vectors. Speed matters in Mains, accuracy in Advanced.</li>
                    <li><strong>Physics:</strong> HCV (H.C. Verma) is a must. Solve Irodov only if you are targeting Top 100 AIR.</li>
                    <li><strong>Chemistry:</strong> NCERT is enough for Mains. For Advanced, refer to standard books like J.D. Lee (Inorganic).</li>
                </ul>
                <p><strong>Golden Rule:</strong> PYQs (Previous Year Questions) of last 15 years are mandatory.</p>
            </div>
        </div>

        <div class="guide-card">
            <div class="guide-header" onclick="toggleGuide(this)">
                <strong>üèÜ 5 Habits of Toppers</strong> <span>‚ñº</span>
            </div>
            <div class="guide-content">
                <ol>
                    <li><strong>Consistency > Intensity:</strong> Studying 6 hours daily for a year is better than studying 14 hours for a week and then burning out.</li>
                    <li><strong>Error Notebook:</strong> Note down every mistake you make in mock tests. Revise this notebook before every exam.</li>
                    <li><strong>Digital Detox:</strong> No Instagram/Reels during study hours. Use apps like "Study Arc" to stay focused.</li>
                    <li><strong>Sleep:</strong> 7 Hours of sleep is non-negotiable for memory retention.</li>
                    <li><strong>Revision:</strong> The 1-3-7 Rule. Revise a topic on Day 1, Day 3, and Day 7.</li>
                </ol>
            </div>
        </div>

        <div class="guide-card">
            <div class="guide-header" onclick="toggleGuide(this)">
                <strong>üîó Official Links & Resources</strong> <span>‚ñº</span>
            </div>
            <div class="guide-content">
                <p>Bookmark these official websites to stay updated:</p>
                <div style="display:flex; flex-direction:column; gap:10px;">
                    <a href="https://neet.nta.nic.in/" target="_blank" class="btn btn-ghost" style="text-align:left; border:1px solid var(--accent);">üëâ Official NEET Website</a>
                    <a href="https://jeemain.nta.nic.in/" target="_blank" class="btn btn-ghost" style="text-align:left; border:1px solid var(--accent);">üëâ Official JEE Website</a>
                    <a href="https://ncert.nic.in/textbook.php" target="_blank" class="btn btn-ghost" style="text-align:left; border:1px solid var(--accent);">üëâ Download NCERT Books (Free)</a>
                </div>
            </div>
        </div>

      </div>
    </div>

    <div id="section-planner" class="hidden">
      <div class="glass-panel">
        <h2>ü§ñ AI Syllabus Planner</h2>
        <textarea id="aiSyllabus" class="input" rows="5" placeholder="Enter chapters separated by commas..."></textarea>
        <div style="display:flex; gap:10px; margin-bottom:15px;">
          <input type="date" id="aiDate" class="input">
          <button class="btn btn-primary" onclick="generatePlan()">Generate Plan</button>
        </div>
        <div id="aiResult" style="margin-top:20px;"></div>
        
        <div class="ad-slot">
             <span class="ad-label">Sponsored</span>
             <ins class="adsbygoogle"
                  style="display:block"
                  data-ad-client="ca-pub-5520401672645952"
                  data-ad-slot="4459868531"
                  data-ad-format="auto"
                  data-full-width-responsive="true"></ins>
             <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
      </div>
    </div>

    <div id="section-notes" class="hidden">
      <div class="glass-panel" style="height:100%; display:flex; flex-direction:column;">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
          <h2>üìù Smart Notes</h2>
          <button class="btn btn-ghost" onclick="downloadNotes()">üíæ Save</button>
        </div>
        
        <div class="math-toolbar">
            <button class="math-btn" onclick="insSym('‚àö')">‚àö</button>
            <button class="math-btn" onclick="insSym('Œ∏')">Œ∏</button>
            <button class="math-btn" onclick="insSym('œÄ')">œÄ</button>
            <button class="math-btn" onclick="insSym('¬≤')">x¬≤</button>
            <button class="math-btn" onclick="insSym('Œî')">Œî</button>
        </div>

        <textarea id="scratchpad" class="input" style="flex:1; resize:none; font-family:monospace; font-size:16px; line-height:1.5;" placeholder="Type here..."></textarea>
      </div>
    </div>

    <div id="section-settings" class="hidden">
      <div class="glass-panel">
        <h2>‚öôÔ∏è Settings</h2>

        <div style="margin-top:20px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:15px;">
           <label>üî• Challenge Settings</label>
           <div style="display:flex; gap:10px; margin-top:5px;">
               <select id="setChallenge" class="input" style="margin:0;">
                   <option value="30">30 Days Challenge</option>
                   <option value="50">50 Days Challenge</option>
                   <option value="75">75 Hard Challenge</option>
                   <option value="100">100 Days Marathon</option>
               </select>
               <button class="btn btn-primary" onclick="startChallenge()">Set</button>
           </div>
        </div>

        <div style="margin-top:15px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:15px;">
           <label>üë§ Edit Profile</label>
           <div style="display:flex; gap:10px; margin-top:5px;">
               <input id="editName" class="input" placeholder="Name" style="margin:0;">
               <input id="editExam" class="input" placeholder="Exam" style="margin:0;">
           </div>
           <button class="btn btn-ghost" style="width:100%; margin-top:10px; border:1px solid var(--accent);" onclick="updateProfile()">üíæ Update Profile</button>
        </div>

        <div style="margin-top:15px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:15px;">
            <label>üíæ Data Backup</label>
            <p style="font-size:12px; color:var(--text-muted); margin-bottom:10px;">Save data before clearing history.</p>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-primary" style="flex:1;" onclick="exportData()">üì§ Export JSON</button>
                <button class="btn btn-ghost" style="flex:1; border:1px solid var(--accent);" onclick="document.getElementById('importFile').click()">üì• Import JSON</button>
                <input type="file" id="importFile" style="display:none;" onchange="importData(this)">
            </div>
        </div>

        <div style="margin-top:15px;">
            <label>üé® Theme</label>
            <select id="themeSelect" class="input" onchange="changeTheme(this.value)">
                <option value="mint">Mint Fresh</option>
                <option value="sunset">Sunset Vibes</option>
                <option value="amoled">Pitch Black (AMOLED)</option>
                <option value="cyber">Cyberpunk Neon</option>
                <option value="midnight">Midnight Blue</option>
            </select>
            
            <div style="margin-top:20px; display:flex; flex-direction:column; gap:8px;">
                <button class="btn btn-ghost" onclick="window.location.href='privacy.html'">üîí Privacy Policy</button>
                <button class="btn btn-ghost" onclick="shareApp()">‚ù§Ô∏è Share App</button>
            </div>
            
            <button class="btn" style="background:var(--danger); color:white; width:100%; margin-top:20px;" onclick="hardReset()">‚ö†Ô∏è Reset Everything</button>
        </div>
      </div>
    </div>

    <div class="footer">
    POWERED BY <span>ABHI</span> ‚Ä¢ Study Arc v4.0 <br>
    <div style="margin-top: 5px;">
        <a href="privacy.html" style="color: var(--text-muted); font-size: 11px; text-decoration: none;">Privacy Policy</a>
    </div>
</div>
  </main>
</div>

<div id="claimModal" class="modal hidden">
  <div class="glass-panel" style="max-width: 350px; text-align: center; border: 2px solid var(--accent);">
    <div style="font-size:40px;">ü¶Å</div>
    <h2>Hey Champ!</h2>
    <p style="color:var(--text-muted); margin-bottom:20px;">
        Did you honestly complete your study goals today? <br>
        <span style="font-size:12px; color:var(--danger);">Cheating here = Cheating your Dream.</span>
    </p>
    <div style="display:flex; gap:10px; justify-content:center;">
        <button class="btn btn-ghost" onclick="document.getElementById('claimModal').classList.add('hidden')">‚ùå No</button>
        <button class="btn btn-primary" onclick="confirmClaim()">‚úÖ YES, I DID IT!</button>
    </div>
  </div>
</div>

<script>
/* --- üß† CORE LOGIC v4.0 (Pro Features) --- */

// 1. STATE MANAGEMENT
let profile = JSON.parse(localStorage.getItem('st_profile'));
let tasks = JSON.parse(localStorage.getItem('st_tasks') || '[]');
let streak = parseInt(localStorage.getItem('st_streak') || '0');
let history = JSON.parse(localStorage.getItem('st_history') || '{}');
let notes = localStorage.getItem('st_notes') || '';
let theme = localStorage.getItem('st_theme') || 'mint';
let settings = JSON.parse(localStorage.getItem('st_settings') || '{"sound":true, "vibration":true}');
let challenge = JSON.parse(localStorage.getItem('st_challenge') || '{"active":false, "target":0, "day":1, "lastClaim":0, "status":"active"}');

// Timer State
let timerInterval = null;
let endTime = null;
let currentSubject = '';
let wakeLock = null;
let isPaused = false;
let timeRemaining = 0;

// --- üöÄ INITIALIZATION ---
function init() {
  if(!profile) {
    document.getElementById('onboardingModal').classList.remove('hidden');
  } else {
    checkChallengeStatus();
    updateUI();
  }
  document.body.className = `theme-${theme}`;
  document.getElementById('themeSelect').value = theme;
  document.getElementById('scratchpad').value = notes;
  document.getElementById('dateDisplay').innerText = new Date().toLocaleDateString('en-IN', { weekday: 'long', month: 'long', day: 'numeric' });
  renderTasks();
  renderChart();
  updateSettingsUI();
  if("Notification" in window && Notification.permission !== "granted") Notification.requestPermission();
}

// --- üé® UI UPDATES ---
function updateUI() {
    if(profile) {
        document.getElementById('userGreet').innerText = `Hello, ${profile.name}`;
        document.getElementById('editName').value = profile.name;
        document.getElementById('editExam').value = profile.exam;
    }
    // Rank
    let rank = "üå± Beginner";
    if(streak >= 7) rank = "üî• Spark";
    if(streak >= 21) rank = "ü¶Å Beast";
    if(streak >= 50) rank = "üëë GOD MODE";
    document.getElementById('rankDisplay').innerHTML = `<div style="font-size:16px; font-weight:bold; color:var(--accent);">${rank}</div><div style="font-size:11px; opacity:0.7;">Lifetime Streak: ${streak} Days</div>`;

    // Challenge Sidebar
    const cBox = document.querySelector('.challenge-box');
    if(!challenge.active) {
        cBox.style.display = 'none';
        document.getElementById('challengeText').innerText = "Set Goal üëá";
    } else {
        cBox.style.display = 'block';
        document.getElementById('challengeText').innerText = `${challenge.target} Hard`;
        document.getElementById('challengeDay').innerText = challenge.day;
        document.getElementById('challengeTarget').innerText = challenge.target;
        const pct = (challenge.day / challenge.target) * 100;
        document.getElementById('challengeBar').style.width = `${pct}%`;
        
        const statusEl = document.getElementById('challengeStatus');
        if(challenge.status === 'frozen') { statusEl.innerText = "‚ùÑÔ∏è FROZEN"; statusEl.style.color = "#fbbf24"; }
        else if(challenge.status === 'failed') { statusEl.innerText = "‚ùå FAILED"; statusEl.style.color = "#ef4444"; }
        else { statusEl.innerText = "‚ö° ACTIVE"; statusEl.style.color = "#10b981"; }
    }

    // Claim Button
    const lastDate = new Date(challenge.lastClaim).toDateString();
    const todayDate = new Date().toDateString();
    const btnClaim = document.getElementById('btnClaim');
    if(challenge.active && challenge.status !== 'failed' && lastDate !== todayDate) {
        btnClaim.style.display = 'block';
    } else {
        btnClaim.style.display = 'none';
    }
    
    // Total Time
    let totalSecs = Object.values(history).reduce((a,b)=>a+b, 0);
    document.getElementById('totalFocusTime').innerText = `${(totalSecs/3600).toFixed(1)}h`;
}

// --- üî• CHALLENGE LOGIC ---
function startChallenge() {
    const days = document.getElementById('setChallenge').value;
    if(confirm(`Start ${days} Days Challenge? This resets current challenge!`)) {
        challenge = { active: true, target: parseInt(days), day: 1, lastClaim: 0, status: "active" };
        localStorage.setItem('st_challenge', JSON.stringify(challenge));
        alert("Challenge Started! Good Luck! üçÄ");
        updateUI();
    }
}
function checkChallengeStatus() {
    if(!challenge.active || challenge.lastClaim === 0) return;
    const diffDays = Math.ceil(Math.abs(new Date() - new Date(challenge.lastClaim)) / (1000 * 60 * 60 * 24)); 
    if(diffDays > 2) { challenge.status = "failed"; alert("‚ùå Challenge Failed! You missed 2 days."); }
    else if (diffDays > 1) { challenge.status = "frozen"; alert("‚ùÑÔ∏è Warning! Streak Frozen."); }
    else { challenge.status = "active"; }
    localStorage.setItem('st_challenge', JSON.stringify(challenge));
}
function openClaimModal() { document.getElementById('claimModal').classList.remove('hidden'); }
function confirmClaim() {
    streak++; localStorage.setItem('st_streak', streak);
    if(challenge.active) {
        challenge.day++; challenge.lastClaim = Date.now(); challenge.status = "active";
        if(challenge.day > challenge.target) { alert("üéâ CHALLENGE COMPLETED! üèÜ"); challenge.active = false; }
        localStorage.setItem('st_challenge', JSON.stringify(challenge));
    }
    document.getElementById('claimModal').classList.add('hidden');
    if(window.confetti) confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
    updateUI();
}

// --- ‚ö° TIMER (Pause/Resume) ---
function startQuickFocus() {
    const hrs = parseInt(document.getElementById('quickHrs').value)||0;
    const mins = parseInt(document.getElementById('quickMins').value)||0;
    const subj = document.getElementById('quickSubject').value;
    if(hrs===0 && mins===0) return alert("Set duration!");
    startFocusSession(subj, (hrs*3600)+(mins*60));
}
async function startFocusSession(subject, durationSecs) {
    currentSubject = subject; timeRemaining = durationSecs; isPaused = false;
    document.getElementById('focusOverlay').classList.add('active');
    document.getElementById('focusSubjectDisplay').innerText = subject;
    try { wakeLock = await navigator.wakeLock.request('screen'); } catch(e){}
    runTimer();
}
function runTimer() {
    clearInterval(timerInterval);
    endTime = Date.now() + (timeRemaining * 1000);
    updateTimerDisplay(timeRemaining);
    timerInterval = setInterval(() => {
        if(isPaused) return;
        const diff = Math.ceil((endTime - Date.now()) / 1000);
        if(diff <= 0) finishFocus();
        else { timeRemaining = diff; updateTimerDisplay(diff); }
    }, 1000);
}
function updateTimerDisplay(secs) {
    const h = Math.floor(secs / 3600), m = Math.floor((secs % 3600) / 60), s = secs % 60;
    document.getElementById('focusTimerDisplay').innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
}
function toggleTimer() {
    isPaused = !isPaused;
    if(isPaused) { clearInterval(timerInterval); document.getElementById('btnPause').innerText = "‚ñ∂Ô∏è Resume"; }
    else { runTimer(); document.getElementById('btnPause').innerText = "‚è∏Ô∏è Pause"; }
}
function finishFocus() {
    clearInterval(timerInterval);
    if(settings.sound) playBeep();
    if(settings.vibration && navigator.vibrate) navigator.vibrate([500,200,500]);
    alert("Session Complete! üéâ");
    exitFocus();
}
function exitFocus() {
    clearInterval(timerInterval); if(wakeLock) wakeLock.release();
    document.getElementById('focusOverlay').classList.remove('active');
    if(!history[currentSubject]) history[currentSubject]=0; history[currentSubject]+=1800; // Mock add, user needs logic
    localStorage.setItem('st_history', JSON.stringify(history)); updateUI(); renderChart();
}

// --- üíæ BACKUP & PLANNER ---
function exportData() {
    const d = {profile, tasks, history, notes, settings, streak, challenge};
    const b = new Blob([JSON.stringify(d)], {type:'application/json'});
    const a = document.createElement('a'); a.href=URL.createObjectURL(b); a.download='backup.json'; a.click();
}
function importData(input) {
    const f = input.files[0]; if(!f) return;
    const r = new FileReader();
    r.onload = e => {
        try {
            const d = JSON.parse(e.target.result);
            localStorage.setItem('st_profile', JSON.stringify(d.profile));
            localStorage.setItem('st_tasks', JSON.stringify(d.tasks));
            localStorage.setItem('st_history', JSON.stringify(d.history));
            localStorage.setItem('st_notes', d.notes);
            localStorage.setItem('st_streak', d.streak);
            if(d.challenge) localStorage.setItem('st_challenge', JSON.stringify(d.challenge));
            alert("Restored!"); location.reload();
        } catch(err) { alert("Invalid File!"); }
    }; r.readAsText(f);
}
function generatePlan() {
    const t = document.getElementById('aiSyllabus').value;
    const d = document.getElementById('aiDate').value;
    if(!t || !d) return alert("Enter details!");
    const days = Math.ceil((new Date(d) - new Date()) / (86400000));
    const ch = t.split(',').filter(x=>x.trim()).length;
    document.getElementById('aiResult').innerHTML = `<div style="background:rgba(255,255,255,0.1); padding:10px;"><h3>üéØ ${(ch/days).toFixed(1)} Chapters/Day</h3><p>Total: ${ch} Ch | Days: ${days}</p></div>`;
}

// --- ‚öôÔ∏è UTILS & NAVIGATION ---
function toggleSetting(k) { settings[k]=!settings[k]; localStorage.setItem('st_settings', JSON.stringify(settings)); updateSettingsUI(); }
function updateSettingsUI() { document.getElementById('btnSound').innerText=`üîä Sound: ${settings.sound?'ON':'OFF'}`; document.getElementById('btnVibe').innerText=`üì≥ Vibe: ${settings.vibration?'ON':'OFF'}`; }
function changeTheme(v) { localStorage.setItem('st_theme', v); document.body.className=`theme-${v}`; }
function hardReset() { if(confirm("Reset All?")) { localStorage.clear(); location.reload(); } }
function playBeep() { const a=new AudioContext(), o=a.createOscillator(), g=a.createGain(); o.connect(g); g.connect(a.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.00001, a.currentTime+1); o.stop(a.currentTime+1); }
function showSection(id) {
    ['dashboard','planner','notes','settings','guide'].forEach(s => document.getElementById(`section-${s}`).classList.add('hidden'));
    document.getElementById(`section-${id}`).classList.remove('hidden');
    document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
}
function updateProfile() {
    const n = document.getElementById('editName').value;
    if(n) { profile.name=n; profile.exam=document.getElementById('editExam').value; localStorage.setItem('st_profile', JSON.stringify(profile)); updateUI(); alert("Updated!"); }
}
function shareApp() { navigator.share ? navigator.share({title:'Study Arc', url:window.location.href}) : alert("Link Copied!"); }

// Tasks
function addTask() { const n=document.getElementById('newTaskName').value; if(n){ tasks.unshift({id:Date.now(), name:n, completed:false}); localStorage.setItem('st_tasks', JSON.stringify(tasks)); renderTasks(); document.getElementById('newTaskName').value=''; } }
function renderTasks() { document.getElementById('taskListContainer').innerHTML = tasks.map(t=>`<div class="task-item" style="opacity:${t.completed?0.5:1}"><span style="${t.completed?'text-decoration:line-through':''}">${t.name}</span><button class="btn btn-ghost" onclick="toggleTask(${t.id})">‚úîÔ∏è</button><button class="btn btn-ghost" onclick="delTask(${t.id})">‚úñ</button></div>`).join(''); }
function toggleTask(id) { const t=tasks.find(x=>x.id===id); t.completed=!t.completed; localStorage.setItem('st_tasks', JSON.stringify(tasks)); renderTasks(); }
function delTask(id) { tasks=tasks.filter(x=>x.id!==id); localStorage.setItem('st_tasks', JSON.stringify(tasks)); renderTasks(); }
function renderChart() {
    const ctx = document.getElementById('subjectChart').getContext('2d');
    const labels = Object.keys(history);
    const data = Object.values(history).map(s => (s/3600).toFixed(1));
    if(window.myChart) window.myChart.destroy();
    window.myChart = new Chart(ctx, { type:'doughnut', data:{labels:labels.length?labels:['Empty'], datasets:[{data:data.length?data:[1], borderWidth:0, backgroundColor:['#34d399','#38bdf8','#fbbf24','#ef4444']}]}, options:{plugins:{legend:{display:false}}, responsive:true, maintainAspectRatio:false} });
}
function downloadNotes() { const b=new Blob([document.getElementById('scratchpad').value], {type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='notes.txt'; a.click(); }
function toggleTaskForm() { const f=document.getElementById('addTaskForm'); f.style.display=f.style.display==='none'?'block':'none'; }
function toggleGuide(e) { const c=e.nextElementSibling; c.classList.toggle('open'); }
function insSym(s) { const sp=document.getElementById('scratchpad'); sp.value+=s; localStorage.setItem('st_notes', sp.value); }
document.getElementById('scratchpad').addEventListener('input', e => localStorage.setItem('st_notes', e.target.value));

init();
if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); }); }
</script>
</body>
</html>