<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#2a0845">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Study Arc V7.0 ‚Äî Ultimate</title>
<link rel="icon" href="icons/app-logo-192.png" type="image/png">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
/* --- üé® STUDY ARC V7.0 ULTIMATE CSS --- */

:root {
  --font-main: 'Inter', system-ui, -apple-system, sans-serif;
  --glass-bg: rgba(255, 255, 255, 0.07);
  --glass-border: 1px solid rgba(255, 255, 255, 0.15);
  --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
  --backdrop: blur(20px);
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  
  /* üåÖ Theme: Sunset (Default) */
  --bg-gradient: linear-gradient(135deg, #2a0845 0%, #6441a5 100%);
  --sidebar-bg: rgba(20, 5, 40, 0.6);
  --accent: #fbbf24; 
  --accent-grad: linear-gradient(135deg, #fbbf24, #f59e0b);
  --text: #ffffff;
  --text-muted: rgba(255, 255, 255, 0.7);
  --card-bg: rgba(255, 255, 255, 0.05);
  --danger: #ef4444;
  --success: #10b981;
}

/* üåë Theme: Midnight Blue */
body.theme-midnight { 
    --bg-gradient: linear-gradient(135deg, #02111b 0%, #0c2d48 100%); 
    --sidebar-bg: rgba(2, 10, 20, 0.8);
    --accent: #5da9e9; --accent-grad: linear-gradient(135deg, #4facfe, #00f2fe); 
}

/* üëë Theme: Royal Gold */
body.theme-royal { 
    --bg-gradient: linear-gradient(135deg, #1c1c1c 0%, #3a3a3a 100%); 
    --sidebar-bg: rgba(0, 0, 0, 0.8);
    --accent: #ffd700; --accent-grad: linear-gradient(135deg, #fceabb, #f8b500); 
    --glass-border: 1px solid rgba(255, 215, 0, 0.3);
}

/* üíª Theme: Matrix */
body.theme-matrix { 
    --bg-gradient: #000000; 
    --sidebar-bg: #050505;
    --accent: #00ff00; --accent-grad: linear-gradient(135deg, #00ff00, #008f00); 
    --text: #e0ffe0; --glass-border: 1px solid #00ff00;
}

/* üîí GLOBAL LOCK */
* { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
html, body { 
    margin: 0; padding: 0; 
    font-family: var(--font-main); 
    background: var(--bg-gradient); 
    color: var(--text); 
    width: 100%; height: 100%; 
    overflow: hidden; 
    touch-action: manipulation; /* Double tap zoom off */
    overscroll-behavior: none; /* No shake/bounce effect */
    -webkit-user-select: none; /* No text selection */
    user-select: none;
}
/* Main Layout */
.app-container { 
    max-width: 1400px; margin: 0 auto; padding: 15px; 
    display: grid; grid-template-columns: 280px 1fr; gap: 20px; 
    height: 100vh; overflow-y: auto; position: relative; 
}

/* ‚ú® Premium Components (High Contrast) */
.glass-panel { 
    background: var(--card-bg); backdrop-filter: var(--backdrop); -webkit-backdrop-filter: var(--backdrop); 
    border: var(--glass-border); border-radius: 24px; box-shadow: var(--glass-shadow); padding: 24px; 
    overflow-y: auto; transition: var(--transition); position: relative;
}
/* Double Border Effect for Visibility */
.glass-panel::after {
    content: ''; position: absolute; inset: 0; border-radius: 24px; padding: 1px; 
    background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0)); 
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor; mask-composite: exclude; pointer-events: none;
}

.btn { border: none; padding: 12px 24px; border-radius: 14px; font-weight: 700; cursor: pointer; transition: var(--transition); display: inline-flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; letter-spacing: 0.5px; }
.btn:active { transform: scale(0.96); }
.btn-primary { background: var(--accent-grad); color: #000; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
.btn-ghost { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); }
.btn-danger { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.4); }

.input { 
    width: 100%; padding: 16px; 
    background: rgba(0,0,0,0.4); 
    border: 1px solid rgba(255,255,255,0.15); 
    border-radius: 14px; 
    color: white; 
    margin-bottom: 15px; 
    font-family: var(--font-main); 
    transition: 0.3s;
    font-size: 16px; /* üö® Important: Stops zoom on mobile */
}
.input:focus { border-color: var(--accent); background: rgba(0,0,0,0.6); outline: none; }

/* üßä Sidebar (Fixed Scroll) */
.sidebar { 
    display: flex; flex-direction: column; gap: 10px; height: 100%; z-index: 900; 
    background: var(--sidebar-bg); border-right: 1px solid rgba(255,255,255,0.05);
    border-radius: 24px; padding: 20px;
    overflow-y: auto; /* ‚úÖ Scroll enabled */
}
.brand { font-size: 26px; font-weight: 900; letter-spacing: -1px; background: var(--accent-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; margin-bottom: 10px; }

.nav-item { padding: 14px; border-radius: 14px; cursor: pointer; transition: 0.2s; color: var(--text-muted); display: flex; align-items: center; gap: 15px; font-weight: 600; font-size: 15px; }
.nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.1); color: var(--accent); border-left: 4px solid var(--accent); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

/* üèÜ Premium Challenge Box */
.challenge-box-premium { 
    border: 1px solid var(--glass-border); padding: 15px; border-radius: 18px; 
    text-align: center; background: rgba(0,0,0,0.3); margin-top: auto;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
}

/* üÜî Header & User Box */
.header-glass { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.user-box { 
    display: flex; align-items: center; gap: 12px; background: rgba(0,0,0,0.3); 
    padding: 8px 20px 8px 8px; border-radius: 50px; border: 1px solid var(--glass-border);
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}
.avatar-circle { width: 38px; height: 38px; border-radius: 50%; background: var(--accent-grad); display: flex; align-items: center; justify-content: center; font-weight: bold; color: black; font-size: 18px; }

/* ‚ö° XP & Countdown Cards */
.info-card { 
    background: rgba(0,0,0,0.2); border-radius: 20px; padding: 20px; 
    border: 1px solid var(--glass-border); margin-bottom: 15px; position: relative; overflow: hidden;
}
.xp-bar-bg { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-top: 10px; }
.xp-bar-fill { height: 100%; background: var(--accent-grad); width: 0%; transition: width 0.5s ease; box-shadow: 0 0 10px var(--accent); }

/* üìö Syllabus Wizard */
.wizard-step { display: none; animation: fadeIn 0.3s ease; }
.wizard-step.active { display: block; }
.selection-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px; }
.select-btn { padding: 20px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: 15px; text-align: center; cursor: pointer; transition: 0.2s; font-weight: bold; }
.select-btn.selected { background: var(--accent); color: black; border-color: var(--accent); transform: scale(1.05); }

/* ‚úÖ Tasks (V5 Style - Tick/Cross on Right) */
.task-row { 
    display: flex; align-items: center; justify-content: space-between; 
    padding: 15px; margin-bottom: 10px; background: rgba(0,0,0,0.3); 
    border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; 
}
.task-actions { display: flex; gap: 10px; }
.btn-icon { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: none; font-size: 14px; }

/* üõí Shop Item */
.shop-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 15px; margin-bottom: 10px; border: 1px solid var(--glass-border); }

/* üßò Focus Overlay */
#focusOverlay { position: fixed; inset: 0; background: var(--bg-gradient); z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; }
#focusOverlay.active { display: flex; } 

/* üì± Mobile Styling */
.mobile-header { display: none; justify-content: space-between; align-items: center; padding-bottom: 15px; }
.overlay-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 800; display: none; backdrop-filter: blur(8px); }

@media (max-width: 768px) {
  .app-container { grid-template-columns: 1fr; padding: 15px; height: 100vh; overflow-y: auto; display: block; }
  .sidebar { 
      position: fixed; top: 0; left: -350px; width: 280px; height: 100%; 
      z-index: 2000; transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
      box-shadow: 10px 0 50px rgba(0,0,0,0.9);
  }
  .sidebar.active { left: 0; }
  .overlay-bg.active { display: block; }
  .mobile-header { display: flex; }
  .main-content { padding-bottom: 100px; }
  #focusOverlay .timer-huge { font-size: 70px; }
}

/* Animations */
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.hidden { display: none !important; }
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(15px); z-index: 6000; display: flex; align-items: center; justify-content: center; }
/* --- üìä V5 STYLE BIG STATS (Syllabus & Tasks) --- */
.v5-stats-container {
    display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; 
    margin-bottom: 20px; background: rgba(0,0,0,0.2); 
    padding: 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
}
.v5-stat-box {
    background: rgba(255,255,255,0.05); border-radius: 15px; padding: 10px; text-align: center;
    border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; align-items: center; justify-content: center;
}
.v5-val { font-size: 22px; font-weight: 900; color: white; }
.v5-lbl { font-size: 10px; text-transform: uppercase; opacity: 0.7; margin-top: 5px; font-weight: bold; }

/* --- üìö SYLLABUS GREEN SELECTION --- */
.chapter-select-row {
    padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; margin-bottom: 8px;
    display: flex; align-items: center; gap: 12px; cursor: pointer; border: 1px solid transparent; transition: 0.2s;
}
.chapter-select-row.selected {
    background: rgba(16, 185, 129, 0.2); /* Green Tint */
    border-color: #10b981;
    color: #10b981;
    font-weight: bold;
}
.chapter-circle { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; }
.chapter-select-row.selected .chapter-circle { background: #10b981; border-color: #10b981; }
/* --- üé® NEW FREE THEMES --- */
body.theme-ocean { --bg-gradient: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%); --accent: #00ffff; --sidebar-bg: rgba(0,20,50,0.8); }
body.theme-nebula { --bg-gradient: linear-gradient(135deg, #8E2DE2 0%, #4A00E0 100%); --accent: #ff00cc; --sidebar-bg: rgba(30,0,50,0.8); }
</style>
</head>
<body class="theme-sunset">

<canvas id="confetti-canvas" style="position:fixed; pointer-events:none; top:0; left:0; width:100%; height:100%; z-index:100;"></canvas>
<div id="mobileOverlay" class="overlay-bg" onclick="toggleSidebar()"></div>

<div id="onboardingModal" class="modal hidden">
  <div class="glass-panel" style="max-width: 350px; text-align: center; border: 1px solid var(--accent);">
    <div style="font-size: 50px; margin-bottom: 15px;">üöÄ</div>
    <h2 style="margin-bottom: 5px;">Setup Profile</h2>
    <p style="font-size:12px; margin-bottom:15px; opacity:0.7;">Let's customize your journey.</p>
    
    <input id="obName" class="input" placeholder="Your Name" style="margin-bottom: 10px;">
    <input id="obExamName" class="input" placeholder="Target Exam (e.g. NEET 2027)" style="margin-bottom: 10px;">
    
    <label style="font-size:12px; display:block; text-align:left; margin-bottom:5px; margin-left:5px;">Exam Date:</label>
    <input id="obTarget" class="input" type="date" style="margin-bottom: 15px;">
    
    <button class="btn btn-primary" style="width:100%;" onclick="completeOnboarding()">Start Journey üéØ</button>
  </div>
</div>

<div id="focusOverlay" style="display:none;">
  <div style="font-size: 14px; letter-spacing: 3px; color: var(--accent); opacity: 0.8; margin-bottom: 10px;">CURRENT SESSION</div>
  <div style="font-size: 32px; font-weight: bold; color: white; margin-bottom: 20px;" id="focusSubjectDisplay">SUBJECT</div>
  
  <div class="timer-huge" id="focusTimerDisplay" style="font-size: 80px; font-weight: 900; background: var(--accent-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 10px 0;">00:00:00</div>
  
  <div style="display: flex; gap: 15px;">
    <button id="btnPause" class="btn btn-ghost" style="padding: 15px 25px; border:1px solid white;" onclick="toggleTimer()">‚è∏Ô∏è Pause</button>
    <button class="btn btn-primary" style="padding: 15px 30px;" onclick="finishFocus()">‚úÖ Finish</button>
  </div>
  
  <button class="btn btn-danger" style="margin-top: 30px; font-size: 12px; opacity: 0.8;" onclick="giveUpFocus()">üè≥Ô∏è Give Up (Exit)</button>
</div>
<div class="app-container">
  
  <div class="mobile-header">
      <button style="font-size: 28px; background: none; border: none; color: white;" onclick="toggleSidebar()">‚ò∞</button>
      <div class="brand" style="font-size: 20px; margin:0;">STUDY ARC</div>
      <div style="width: 30px;"></div> 
  </div>

  <aside class="sidebar" id="sidebarMenu">
    <div class="brand">STUDY ARC <span style="font-size:10px; color:var(--accent); vertical-align: super;">V7</span></div>
    
    <div class="challenge-box-premium" id="challengeWidget" style="display:none;">
        <div style="font-size:10px; font-weight:bold; color:var(--accent); margin-bottom:5px; text-transform:uppercase; letter-spacing:1px;">Active Challenge</div>
        <div id="challengeText" style="font-size:20px; font-weight:900; color:white; margin-bottom:5px;">75 Hard</div>
        <div style="font-size:12px; opacity:0.8;">Day <span id="challengeDay">1</span> of <span id="challengeTarget">75</span></div>
        <div style="margin-top:8px; height:4px; background:rgba(255,255,255,0.1); border-radius:2px;">
            <div id="challengeBarSidebar" style="height:100%; width:0%; background:var(--accent); border-radius:2px;"></div>
        </div>
        <div id="challengeMedal" style="font-size:30px; margin-top:10px; display:none;">ü•á</div>
    </div>

    <nav style="display: flex; flex-direction: column; gap: 5px; margin-top:20px;">
      <div class="nav-item active" onclick="showSection('dashboard', this)">üè† Dashboard</div>
      <div class="nav-item" onclick="showSection('syllabus', this)">üìö Syllabus Wizard</div>
      <div class="nav-item" onclick="showSection('tasks', this)">‚úÖ Task Manager</div>
      <div class="nav-item" onclick="showSection('challenges', this)">üèÜ Challenges</div>
      <div class="nav-item" onclick="showSection('guide', this)">‚ÑπÔ∏è Exam Guide</div>
      <div class="nav-item" onclick="showSection('notes', this)">üìì Mistake Notebook</div>
      <div class="nav-item" onclick="showSection('settings', this)">‚öôÔ∏è Settings</div>
    </nav>
  </aside>

  <main class="main-content">
    
<div id="section-dashboard">
      
      <div class="header-glass">
        <div class="user-box" style="border: 1px solid var(--accent); background: rgba(0,0,0,0.4); padding: 10px 20px;">
            <div class="avatar-circle" id="userAvatar">A</div>
            <div>
                <span id="userGreet" style="font-size:15px; font-weight:700;">Hello</span>
                <div id="userExamDisplay" style="font-size:10px; opacity:0.8; color:var(--accent);">Exam Target</div>
            </div>
        </div>
        
        <div class="user-box" style="gap:5px; border: 1px solid var(--success); background: rgba(0,0,0,0.4); padding: 10px 20px;">
            <span style="font-size:16px;">üî•</span> 
            <div style="display:flex; flex-direction:column; align-items:flex-end;">
                <span id="streakDisplay" style="font-weight:800; font-size:14px;">0</span>
                <span style="font-size:8px; opacity:0.7; letter-spacing:1px;">BEGINNER</span>
            </div>
        </div>
      </div>

      <div class="glass-panel" style="padding:15px; text-align:center; margin-bottom:15px; border-left: 3px solid var(--accent); display:flex; align-items:center; justify-content:center;">
          <i style="font-size:13px; font-style:italic;" id="dailyQuote">"Your competition is not others. Your competition is your procrastination."</i>
      </div>

      <div class="info-card" style="border: 1px solid var(--accent); background: rgba(0,0,0,0.3);">
          <div style="display:flex; justify-content:space-between; align-items:center;">
              <div>
                  <div style="font-size:10px; text-transform:uppercase; letter-spacing:1px; color:var(--accent);">Time Remaining</div>
                  <div style="font-size:24px; font-weight:900;" id="daysLeftDisplay">000 Days</div>
                  <div style="font-size:12px; opacity:0.7;">Until <span id="targetDateDisplay">Big Day</span></div>
              </div>
              <div style="font-size:40px;">‚è≥</div>
          </div>
      </div>

      <div class="info-card" style="border: 1px solid rgba(255,255,255,0.2);">
          <div style="display:flex; justify-content:space-between; align-items:center;">
              <div>
                  <h3 style="margin:0; font-size:18px;">Level <span id="userLevel">1</span></h3>
                  <div style="font-size:12px; color:var(--text-muted);" id="userRankTitle">Novice Student</div>
              </div>
              <div style="text-align:right;">
                  <div style="font-size:14px; font-weight:bold; color:var(--accent);"><span id="currentXP">0</span> XP</div>
              </div>
          </div>
          <div class="xp-bar-bg">
              <div class="xp-bar-fill" id="xpBar"></div>
          </div>
      </div>

      <div class="glass-panel" style="margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1);">
        <h3 style="margin:0 0 15px 0;">‚ö° Quick Focus</h3>
        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 10px;">
            <select id="quickSubject" class="input" style="margin:0;" onchange="checkCustomSubject(this)">
                <option value="Physics">Physics</option>
                <option value="Chemistry">Chemistry</option>
                <option value="Biology">Biology</option>
                <option value="Other">Other...</option>
            </select>
            <input id="customSubjectInput" class="input" placeholder="Subject" style="margin:0; display:none;">
           <input id="quickHrs" type="number" min="0" class="input" placeholder="Hr" value="0" style="margin:0;">
            <input id="quickMins" type="number" min="0" class="input" placeholder="Min" value="45" style="margin:0;">
            <button class="btn btn-primary" onclick="startQuickFocus()">‚ñ∂</button>
        </div>
      </div>
<div class="ad-unit" style="width:100%; height:90px; background:rgba(255,255,255,0.03); border:1px dashed rgba(255,255,255,0.2); border-radius:15px; margin-top: 20px; display:flex; align-items:center; justify-content:center; flex-direction:column;">
          <span style="font-size:10px; text-transform:uppercase; letter-spacing:1px; opacity:0.5;">Advertisement</span>
          </div>
    </div>

   <div id="section-syllabus" class="hidden">
      <div class="glass-panel">
        
        <div id="wiz-step-1" class="wizard-step active">
            <h2 style="text-align:center;">Select Class üìö</h2>
            <div class="selection-grid">
                <div class="select-btn" onclick="wizSelectClass('11')">Class 11th</div>
                <div class="select-btn" onclick="wizSelectClass('12')">Class 12th</div>
            </div>
        </div>

        <div id="wiz-step-2" class="wizard-step">
            <h2 style="text-align:center;">Target Exam üéØ</h2>
            <div class="selection-grid">
                <div class="select-btn" onclick="wizSelectExam('NEET')">NEET (Medical)</div>
                <div class="select-btn" onclick="wizSelectExam('JEE')">JEE (Engineering)</div>
            </div>
        </div>

        <div id="wiz-step-3" class="wizard-step">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>Select Chapters</h3>
                <button class="btn btn-primary" onclick="wizGenerateGoal()">Create Goal</button>
            </div>
            <div id="wiz-chapter-container" style="margin-top:15px; max-height:60vh; overflow-y:auto;"></div>
        </div>

        <div id="wiz-active-dashboard" class="wizard-step">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h2 style="margin:0;">Weekly Goal</h2>
                <div style="font-size:12px; color:var(--accent);">Resets on Sunday</div>
            </div>

            <div class="v5-stats-container">
                <div class="v5-stat-box"><div class="v5-val" id="weekTotalCount">0</div><div class="v5-lbl">Total Goal</div></div>
                <div class="v5-stat-box"><div class="v5-val" id="weekDoneCount" style="color:var(--success);">0</div><div class="v5-lbl">Completed</div></div>
                <div class="v5-stat-box"><div class="v5-val" id="weekPendingCount" style="color:var(--danger);">0</div><div class="v5-lbl">Pending</div></div>
            </div>
            
            <div id="active-goal-list" style="display:grid; gap:10px; margin-top:20px;"></div>
            
            <button id="claimSyllabusXPBtn" class="btn btn-success" style="width:100%; margin-top:20px; display:none; box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);" onclick="claimSyllabusXP()">üéÅ Claim 100 XP (Goal Progress)</button>

            <div style="margin-top:20px; display:flex; gap:10px;">
                <button class="btn btn-ghost" style="flex:1;" onclick="resetSyllabusWizard()">üîÑ Reset Goal</button>
                <button class="btn btn-primary" style="flex:1;" onclick="downloadReport()">üì• Report</button>
            </div>
        </div>

      </div>
    </div>
   <div id="section-tasks" class="hidden">
        <div class="glass-panel">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2>‚úÖ Task Manager</h2>
                <button class="btn btn-danger" style="font-size: 11px; padding: 5px 10px;" onclick="clearDoneTasks()">Clean Up</button>
            </div>
            
            <div class="v5-stats-container">
                <div class="v5-stat-box"><div class="v5-val" id="tTotal">0</div><div class="v5-lbl">Total Tasks</div></div>
                <div class="v5-stat-box"><div class="v5-val" id="tDone" style="color:var(--success);">0</div><div class="v5-lbl">Done</div></div>
                <div class="v5-stat-box"><div class="v5-val" id="tPending" style="color:var(--danger);">0</div><div class="v5-lbl">Pending</div></div>
            </div>

            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <input id="newTaskName" class="input" placeholder="New Task..." style="margin:0;">
                <button class="btn btn-primary" onclick="addTask()">Add</button>
            </div>

            <div id="taskListContainer"></div>
        </div>
    </div>
    <div id="section-challenges" class="hidden">
      <div class="glass-panel">
        <h2>üèÜ Challenges</h2>
        <div class="challenge-box-premium" id="challengeSetupBox">
            <h3>Start New Challenge</h3>
            <input id="challengeNameInput" class="input" placeholder="Name (e.g. 75 Hard)">
            <select id="challengeDaysInput" class="input">
                <option value="21">21 Days Habit</option>
                <option value="30">30 Days Sprint</option>
                <option value="75">75 Hard Challenge</option>
            </select>
            <button class="btn btn-primary" style="width:100%;" onclick="startChallenge()">Begin üî•</button>
        </div>
        
        <div id="challengeActiveView" style="display:none; text-align:center;">
             <h1 id="activeChallengeTitle" style="color:var(--accent); margin-bottom:5px;">75 Hard</h1>
             <p style="font-size:14px; margin-bottom:20px;">Day <span id="activeChallengeDay">1</span> / <span id="activeChallengeTarget">75</span></p>
             
             <div style="display:grid; grid-template-columns: repeat(7, 1fr); gap:5px; margin-bottom:20px;" id="challengeCalendar">
                 </div>

             <button class="btn btn-success" style="width:100%; padding:15px; font-size:16px;" onclick="confirmClaim()">‚úÖ Mark Today Complete</button>
             <button class="btn btn-danger" emargin-top:15px;" onclick="deleteChallenge()">üóëÔ∏è Delete Challenge</button>
        </div>
      </div>
<div class="ad-unit" style="width:100%; height:90px; background:rgba(255,255,255,0.03); border:1px dashed rgba(255,255,255,0.2); border-radius:15px; margin-top: 20px; display:flex; align-items:center; justify-content:center; flex-direction:column;">
          <span style="font-size:10px; text-transform:uppercase; letter-spacing:1px; opacity:0.5;">Advertisement</span>
          </div>
    </div>

    <div id="section-guide" class="hidden"><div class="glass-panel"><h2>‚ÑπÔ∏è Exam Guide</h2><div id="guide-content-area"></div></div></div>
   <div id="section-notes" class="hidden">
      <div class="glass-panel">
        <h2>üìì Mistake Notebook</h2>
        <p style="font-size:12px; opacity:0.7; margin-bottom:15px;">Write down your daily mistakes to avoid repeating them.</p>
        
        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <input id="newMistakeInput" class="input" placeholder="E.g. Forgot Formula for Torque..." style="margin:0;">
            <button class="btn btn-primary" onclick="addMistake()">Add</button>
        </div>
        
        <div id="mistakeListContainer"></div>
      </div>
<div class="ad-unit" style="width:100%; height:90px; background:rgba(255,255,255,0.03); border:1px dashed rgba(255,255,255,0.2); border-radius:15px; margin-top: 20px; display:flex; align-items:center; justify-content:center; flex-direction:column;">
          <span style="font-size:10px; text-transform:uppercase; letter-spacing:1px; opacity:0.5;">Advertisement</span>
          </div>
    </div>
<div id="section-settings" class="hidden">
      
      <div class="glass-panel" style="border: 2px solid var(--accent); background: rgba(251, 191, 36, 0.05);">
        <h2 style="color:var(--accent); margin-top:0;">üõí XP Shop</h2>
        <p style="margin-bottom:15px;">Balance: <span id="shopBalance">0</span> XP</p>
        
        <div class="shop-item">
            <div>‚ùÑÔ∏è <b>Streak Freeze</b><br><span style="font-size:10px;">Protect streak for 1 day</span></div>
            <button class="btn btn-ghost" onclick="buyItem('freeze', 500)">Buy 500 XP</button>
        </div>
        
        <div class="shop-item">
            <div>‚ö° <b>1 Hour Boost</b><br><span style="font-size:10px;">Double XP for 1 hr</span></div>
            <button class="btn btn-ghost" onclick="buyItem('boost', 1000)">Buy 1k XP</button>
        </div>
      </div>

      <div class="glass-panel">
        <h2>‚öôÔ∏è App Settings</h2>
        
        <div style="margin-bottom:20px;">
            <label style="display:block; margin-bottom:10px;">üé® App Theme (All Free)</label>
            <select id="themeSelect" class="input" onchange="changeTheme(this.value)">
                <option value="sunset">üåÖ Sunset (Default)</option>
                <option value="midnight">üåë Midnight Blue</option>
                <option value="royal">üëë Royal Gold</option>
                <option value="matrix">üíª Matrix Green</option>
                <option value="ocean">üåä Ocean Depth</option>
                <option value="nebula">üåå Nebula</option>
            </select>
        </div>
        
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding:10px; background:rgba(255,255,255,0.05); border-radius:10px;">
            <span>üîä Sound Effects</span>
            <input type="checkbox" checked style="accent-color:var(--accent);">
        </div>
        
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding:10px; background:rgba(255,255,255,0.05); border-radius:10px;">
            <span>üì≥ Haptic Vibration</span>
            <input type="checkbox" checked style="accent-color:var(--accent);">
        </div>

    <div style="margin-top:20px; padding-top:20px; border-top:1px solid rgba(255,255,255,0.1);">
            <h4 style="margin-bottom:10px;">‚öñÔ∏è Legal & Support</h4>
            <div style="display:flex; flex-direction:column; gap:8px;">
                <button class="btn btn-ghost" style="justify-content:flex-start;" onclick="showSection('privacy')">üîí Privacy Policy</button>
                <button class="btn btn-ghost" style="justify-content:flex-start;" onclick="showSection('terms')">üìú Terms of Service</button>
                <button class="btn btn-ghost" style="justify-content:flex-start;" onclick="showSection('contact')">üìû Contact Us</button>
            </div>
        </div>

        <div style="text-align:center; margin-top:30px; font-size:12px; color:var(--text-muted);">
            Study Arc V7.2 ‚Ä¢ Powered by <b>Abhi Sarswat</b> ‚ù§Ô∏è
        </div>
        <button class="btn btn-danger" style="width:100%; margin-top:10px;" onclick="hardReset()">‚ö†Ô∏è Factory Reset</button>
      </div>
    </div>
<div id="section-privacy" class="hidden">
        <div class="glass-panel">
            <h2>üîí Privacy Policy</h2>
            <div style="font-size:12px; opacity:0.8; line-height:1.6; height:60vh; overflow-y:auto; padding-right:10px;">
                <p><strong>Effective Date: 2025</strong></p>
                <p>Welcome to Study Arc. Your privacy is important to us.</p>
                
                <h4>1. Information We Collect</h4>
                <p>We do not collect any personal information on our servers. All data (Study history, Tasks, Name) is stored locally on your device using <code>LocalStorage</code>. If you clear your browser cache, this data may be lost.</p>
                
                <h4>2. Third-Party Services</h4>
                <p>We use Google AdSense to display advertisements. Google may use cookies to serve ads based on your prior visits to our website or other websites.</p>
                
                <h4>3. User Rights</h4>
                <p>You have full control over your data. You can delete all stored data by using the "Factory Reset" option in the Settings menu.</p>
                
                <h4>4. Contact</h4>
                <p>If you have any questions, please contact us via the Contact section in the app.</p>
            </div>
            <button class="btn btn-primary" style="margin-top:15px; width:100%;" onclick="showSection('settings')">üîô Back to Settings</button>
        </div>
    </div>

    <div id="section-terms" class="hidden">
        <div class="glass-panel">
            <h2>üìú Terms of Service</h2>
            <div style="font-size:12px; opacity:0.8; line-height:1.6; height:60vh; overflow-y:auto; padding-right:10px;">
                <p><strong>1. Acceptance of Terms</strong><br>By accessing and using Study Arc, you accept and agree to be bound by the terms and provision of this agreement.</p>
                
                <p><strong>2. Use License</strong><br>This is a free-to-use productivity tool for students. You are granted a limited license to use this software for personal study tracking.</p>
                
                <p><strong>3. Disclaimer</strong><br>The materials on Study Arc are provided "as is". We make no warranties, expressed or implied, regarding exam results or accuracy of study metrics.</p>
                
                <p><strong>4. Ads</strong><br>This service is supported by ads from Google AdSense. By using the app, you consent to seeing these advertisements.</p>
            </div>
            <button class="btn btn-primary" style="margin-top:15px; width:100%;" onclick="showSection('settings')">üîô Back to Settings</button>
        </div>
    </div>

    <div id="section-contact" class="hidden">
        <div class="glass-panel">
            <h2>üìû Contact Us</h2>
            <p style="margin-bottom:20px; opacity:0.8; font-size:13px;">We'd love to hear from you!</p>
            
            <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                <div style="margin-bottom:15px;">
                    <div style="font-size:10px; text-transform:uppercase; color:var(--accent);">Developer</div>
                    <div style="font-size:16px; font-weight:bold;">Abhi Sarswat</div>
                </div>
                
                <div style="margin-bottom:15px;">
                    <div style="font-size:10px; text-transform:uppercase; color:var(--accent);">Email Support</div>
                    <div style="font-size:16px;">support@studyarc.app</div>
                </div>
                
                <div>
                    <div style="font-size:10px; text-transform:uppercase; color:var(--accent);">Location</div>
                    <div style="font-size:16px;">Rajasthan, India</div>
                </div>
            </div>
            
            <button class="btn btn-primary" style="margin-top:20px; width:100%;" onclick="showSection('settings')">üîô Back to Settings</button>
        </div>
    </div>
  </main>
</div>
<div id="claimModal" class="modal hidden">
  <div class="glass-panel" style="max-width: 350px; text-align: center; border: 2px solid var(--accent);">
    <div style="font-size:50px;">ü¶Å</div>
    <h2>Hey Champ!</h2>
    <p style="color:var(--text-muted); margin-bottom:20px;">Did you honestly complete your daily goal?</p>
    <div style="display:flex; gap:10px; justify-content:center;">
        <button class="btn btn-ghost" onclick="closeModal('claimModal')">No</button>
        <button class="btn btn-primary" onclick="confirmClaim()">YES, I DID IT! üî•</button>
    </div>
  </div>
</div>

<script>
/* --- üß† PART 3: DATA & CONTENT DATABASE --- */

// 1. üìö SYLLABUS DATABASE (NEET/JEE)
const SYLLABUS_DB = {
    "11": {
        "Physics": [
            "Physical World & Measurement", "Kinematics", "Laws of Motion", "Work, Energy & Power",
            "Motion of System of Particles", "Gravitation", "Properties of Bulk Matter",
            "Thermodynamics", "Behavior of Perfect Gas & Kinetic Theory", "Oscillations & Waves"
        ],
        "Chemistry": [
            "Some Basic Concepts of Chemistry", "Structure of Atom", "Classification of Elements",
            "Chemical Bonding & Molecular Structure", "States of Matter", "Thermodynamics",
            "Equilibrium", "Redox Reactions", "Hydrogen", "s-Block Elements",
            "Some p-Block Elements", "Organic Chemistry: Basic Principles", "Hydrocarbons", "Environmental Chemistry"
        ],
        "Biology": [
            "Diversity in Living World", "Structural Organisation in Animals/Plants",
            "Cell: Structure and Function", "Plant Physiology", "Human Physiology"
        ],
        "Maths": [
            "Sets & Functions", "Trigonometric Functions", "Complex Numbers", "Linear Inequalities",
            "Permutations & Combinations", "Binomial Theorem", "Sequence & Series", "Straight Lines",
            "Conic Sections", "Limits & Derivatives"
        ]
    },
    "12": {
        "Physics": [
            "Electrostatics", "Current Electricity", "Magnetic Effects of Current",
            "Magnetism & Matter", "Electromagnetic Induction", "Alternating Currents",
            "Electromagnetic Waves", "Optics (Ray & Wave)", "Dual Nature of Matter",
            "Atoms & Nuclei", "Electronic Devices"
        ],
        "Chemistry": [
            "Solid State", "Solutions", "Electrochemistry", "Chemical Kinetics", "Surface Chemistry",
            "Isolation of Elements", "p-Block Elements", "d- and f-Block Elements",
            "Coordination Compounds", "Haloalkanes & Haloarenes", "Alcohols, Phenols & Ethers",
            "Aldehydes, Ketones & Carboxylic Acids", "Amines", "Biomolecules", "Polymers"
        ],
        "Biology": [
            "Reproduction", "Genetics and Evolution", "Biology in Human Welfare",
            "Biotechnology", "Ecology and Environment"
        ],
        "Maths": [
            "Relations & Functions", "Inverse Trigonometric Functions", "Matrices", "Determinants",
            "Continuity & Differentiability", "Applications of Derivatives", "Integrals",
            "Differential Equations", "Vectors & 3D Geometry", "Probability"
        ]
    }
};

// 2. ‚ÑπÔ∏è EXAM GUIDE CONTENT (Injected via JS for cleanness)
const GUIDE_HTML = `
<div style="padding-bottom:50px;">
    <div class="glass-panel" style="margin-bottom:15px; background:rgba(255,255,255,0.03);">
        <h3 style="color:var(--accent); margin-bottom:10px;">ü©∫ NEET Master Strategy (680+)</h3>
        <p style="font-size:14px; line-height:1.6;">NEET is 50% Knowledge and 50% Speed. Here is the breakdown:</p>
        
        <h4 style="color:#10b981; margin-top:15px;">üß¨ Biology (360/360)</h4>
        <ul style="font-size:13px; opacity:0.8; padding-left:20px; line-height:1.6;">
            <li><strong>NCERT is God:</strong> 90/90 questions come directly from NCERT lines. Read summaries and scientist intros too.</li>
            <li><strong>Diagrams:</strong> Practice labeling diagrams from memory.</li>
            <li><strong>High Yield Units:</strong> Genetics, Ecology, and Human Physiology.</li>
        </ul>

        <h4 style="color:#fbbf24; margin-top:15px;">üî≠ Physics (160+)</h4>
        <ul style="font-size:13px; opacity:0.8; padding-left:20px; line-height:1.6;">
            <li><strong>Formula Sheet:</strong> Paste it on your wall. 60% questions are formula-based.</li>
            <li><strong>Modern Physics:</strong> Easiest unit with high weightage (Atoms, Nuclei, Semiconductors).</li>
            <li><strong>Mechanics:</strong> Focus on FBDs and Graphs.</li>
        </ul>
        
        <h4 style="color:#ef4444; margin-top:15px;">üß™ Chemistry (170+)</h4>
        <ul style="font-size:13px; opacity:0.8; padding-left:20px; line-height:1.6;">
            <li><strong>Inorganic:</strong> Pure memorization. Read P-Block & Coordination Compounds multiple times.</li>
            <li><strong>Organic:</strong> Master GOC & Reaction Mechanisms.</li>
        </ul>
    </div>

    <div class="glass-panel" style="margin-bottom:15px; background:rgba(255,255,255,0.03);">
        <h3 style="color:var(--accent); margin-bottom:10px;">üë∑ JEE Mains & Advanced</h3>
        <p style="font-size:14px; line-height:1.6;">Accuracy is more important than attempting everything.</p>
        <ul style="font-size:13px; opacity:0.8; padding-left:20px; line-height:1.6;">
            <li><strong>Maths:</strong> Calculus and Vectors are the rank deciders.</li>
            <li><strong>Physics:</strong> HC Verma is mandatory for concept building.</li>
            <li><strong>Mock Tests:</strong> Give tests in 2 slots (9-12 and 2-5) to train your brain.</li>
        </ul>
    </div>

    <div class="glass-panel" style="background:rgba(255,255,255,0.03);">
        <h3 style="color:var(--accent); margin-bottom:10px;">üèÜ The 1% Club Habits</h3>
        <ol style="font-size:13px; opacity:0.8; padding-left:20px; line-height:1.6;">
            <li><strong>Mistake Notebook:</strong> Write down every question you got wrong in mocks. Revise this daily.</li>
            <li><strong>Pomodoro:</strong> Study 50 mins, Break 10 mins. Zero distractions.</li>
            <li><strong>Sleep:</strong> 7 Hours sleep is crucial for memory retention.</li>
        </ol>
    </div>
</div>
`;

// 3. üéØ MOTIVATION QUOTES (For Failed Tasks)
const FAIL_MOTIVATION = [
    "It's okay! Just reschedule it. üöÄ",
    "Don't give up. You are a warrior! ‚öîÔ∏è",
    "One bad day doesn't mean a bad life. üí™",
    "Rest if you must, but don't quit. üî•"
];

// Load Exam Guide on Start
document.getElementById('guide-content-area').innerHTML = GUIDE_HTML;

</script>
<script>
/* --- üß† PART 4: THE MASTER LOGIC (V7.0) --- */

// --- 1. STATE MANAGEMENT ---
let profile = JSON.parse(localStorage.getItem('st_profile'));
let tasks = JSON.parse(localStorage.getItem('st_tasks') || '[]');
let streak = parseInt(localStorage.getItem('st_streak') || '0');
let xp = parseInt(localStorage.getItem('st_xp') || '0');
let level = parseInt(localStorage.getItem('st_level') || '1');
let freezeCount = parseInt(localStorage.getItem('st_freeze') || '0');
let activeSyllabus = JSON.parse(localStorage.getItem('st_active_syllabus') || 'null'); // {class, exam, chapters: []}
let challenge = JSON.parse(localStorage.getItem('st_challenge') || '{"active":false}');
let history = JSON.parse(localStorage.getItem('st_history') || '{}');
let lastStudyDate = localStorage.getItem('st_last_date');

// Timer Globals
let timerInterval, endTime, currentSubject, wakeLock;
let isPaused = false, timeRemaining = 0, sessionDuration = 0;
let soundAudio = null;

// --- üöÄ INITIALIZATION ---
function init() {
    if(!profile) {
        document.getElementById('onboardingModal').classList.remove('hidden');
    } else {
        updateUI();
        checkStreak();
    }
    
    // Set Daily Quote
    if(document.getElementById('dailyQuote')) {
        document.getElementById('dailyQuote').innerText = `"${DAILY_QUOTES[Math.floor(Math.random() * DAILY_QUOTES.length)]}"`;
    }
    
    // Apply Theme
    let savedTheme = localStorage.getItem('st_theme') || 'sunset';
    document.body.className = `theme-${savedTheme}`;
    document.getElementById('themeSelect').value = savedTheme;

    // Load Data
    renderTasks();
    checkChallenge();
    initSyllabusUI();
    
    // Initialize Mistakes
    renderMistakes();
}

// --- üì± UI NAVIGATION ---
function showSection(id, element) {
    if(window.innerWidth <= 768) toggleSidebar();
    document.querySelectorAll('[id^="section-"]').forEach(d => d.classList.add('hidden'));
    document.getElementById(`section-${id}`).classList.remove('hidden');
    
    // Sidebar Highlight Logic
    if(element) {
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
    }
}

function toggleSidebar() {
    document.getElementById('sidebarMenu').classList.toggle('active');
    document.getElementById('mobileOverlay').classList.toggle('active');
}

// --- ‚öôÔ∏è DASHBOARD UPDATES (Exam Name & Quotes) ---
const DAILY_QUOTES = [
    "Your competition is not others. Your competition is your procrastination.",
    "Study like there's no tomorrow because if you keep putting it off, there won't be.",
    "The pain you feel today is the strength you feel tomorrow.",
    "Don't stop when you're tired. Stop when you're done.",
    "Dream big. Work hard. Stay humble."
];

function completeOnboarding() {
    const name = document.getElementById('obName').value;
    const exam = document.getElementById('obExamName').value;
    const date = document.getElementById('obTarget').value;
    
    if(!name) return alert("Name required!");
    
    profile = { name, examName: exam, examDate: date };
    localStorage.setItem('st_profile', JSON.stringify(profile));
    document.getElementById('onboardingModal').classList.add('hidden');


    init();}

function updateUI() {
    if(!profile) return;
    
    // Header Info
    document.getElementById('userGreet').innerText = `Hello, ${profile.name}`;
    if(profile.examName) document.getElementById('userExamDisplay').innerText = profile.examName;
    document.getElementById('streakDisplay').innerText = streak;
    
    // XP & Level
    let reqXP = level * 1000;
    document.getElementById('userLevel').innerText = level;
    document.getElementById('currentXP').innerText = `${xp} / ${reqXP}`;
    document.getElementById('xpBar').style.width = `${(xp/reqXP)*100}%`;
    document.getElementById('shopBalance').innerText = xp;

    // Exam Countdown
    if(profile.examDate) {
        const diff = new Date(profile.examDate) - new Date();
        const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
        document.getElementById('daysLeftDisplay').innerText = days > 0 ? `${days} Days` : "TODAY!";
        document.getElementById('targetDateDisplay').innerText = new Date(profile.examDate).toDateString().slice(4, 10);
    }
}

// --- üìö SYLLABUS WIZARD (V7.1 Updated) ---
let wizClass = null, wizExam = null;

function initSyllabusUI() {
    if(activeSyllabus) {
        document.querySelectorAll('.wizard-step').forEach(el => el.classList.remove('active'));
        document.getElementById('wiz-active-dashboard').classList.add('active');
        renderActiveSyllabus();
    } else {
        resetSyllabusWizardUI();
    }
}

function wizSelectClass(c) {
    wizClass = c;
    document.getElementById('wiz-step-1').classList.remove('active');
    document.getElementById('wiz-step-2').classList.add('active');
}

function wizSelectExam(e) {
    wizExam = e;
    document.getElementById('wiz-step-2').classList.remove('active');
    document.getElementById('wiz-step-3').classList.add('active');
    renderChapterSelection();
}

function renderChapterSelection() {
    const container = document.getElementById('wiz-chapter-container');
    container.innerHTML = '';
    const subjects = SYLLABUS_DB[wizClass]; 
    
    let keys = Object.keys(subjects);
    if(wizExam === 'NEET') keys = keys.filter(k => k !== 'Maths');
    if(wizExam === 'JEE') keys = keys.filter(k => k !== 'Biology');

    keys.forEach(sub => {
        let html = `<h4 style="color:var(--accent); margin:15px 0 5px 0;">${sub}</h4>`;
        subjects[sub].forEach(chap => {
            // New Green Selection HTML
            html += `
            <div class="chapter-select-row" onclick="this.classList.toggle('selected')">
                <div class="chapter-circle"></div>
                <span>${chap}</span>
            </div>`;
        });
        container.innerHTML += html;
    });
}

function wizGenerateGoal() {
    const selected = [];
    document.querySelectorAll('.chapter-select-row.selected span').forEach(el => selected.push({name: el.innerText, done: false}));
    
    if(selected.length === 0) return alert("Select at least 1 chapter!");
    
    // XP Claimed flag added
    activeSyllabus = { class: wizClass, exam: wizExam, chapters: selected, startDate: Date.now(), xpClaimed: false };
    localStorage.setItem('st_active_syllabus', JSON.stringify(activeSyllabus));
    
    initSyllabusUI(); 
    confetti();
}

function renderActiveSyllabus() {
    const list = document.getElementById('active-goal-list');
    list.innerHTML = '';
    let done = 0;
    
    activeSyllabus.chapters.forEach((ch, idx) => {
        if(ch.done) done++;
        list.innerHTML += `
        <div class="task-row" style="${ch.done ? 'opacity:0.6; border-color:var(--success);' : ''}">
            <span style="${ch.done ? 'text-decoration:line-through' : ''}">${ch.name}</span>
            <button class="btn-icon" style="background:${ch.done ? 'var(--success)' : 'rgba(255,255,255,0.1)'}" onclick="toggleChapter(${idx})">
                ${ch.done ? '‚úî' : ''}
            </button>
        </div>`;
    });
    
    // Update V5 Stats
    document.getElementById('weekTotalCount').innerText = activeSyllabus.chapters.length;
    document.getElementById('weekDoneCount').innerText = done;
    document.getElementById('weekPendingCount').innerText = activeSyllabus.chapters.length - done;

    // Show Reward Button if 5+ chapters done
    const btn = document.getElementById('claimSyllabusXPBtn');
    if(done >= 5 && !activeSyllabus.xpClaimed) {
        btn.style.display = 'block';
    } else {
        btn.style.display = 'none';
    }
}

function toggleChapter(idx) {
    const isComplete = !activeSyllabus.chapters[idx].done;
    
    if(isComplete) {
        if(!confirm("Did you really complete this chapter? üèÜ")) return;
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
    }
    
    activeSyllabus.chapters[idx].done = isComplete;
    localStorage.setItem('st_active_syllabus', JSON.stringify(activeSyllabus));
    renderActiveSyllabus();
}

function claimSyllabusXP() {
    addXP(100);
    activeSyllabus.xpClaimed = true;
    localStorage.setItem('st_active_syllabus', JSON.stringify(activeSyllabus));
    renderActiveSyllabus();
    alert("üéâ 100 XP Claimed!");
    confetti();
}

function resetSyllabusWizard() {
    if(confirm("Reset Syllabus Goal?")) {
        activeSyllabus = null;
        localStorage.removeItem('st_active_syllabus');
        resetSyllabusWizardUI();
    }
}

function resetSyllabusWizardUI() {
    document.querySelectorAll('.wizard-step').forEach(el => el.classList.remove('active'));
    document.getElementById('wiz-step-1').classList.add('active');
}
// --- üßò FOCUS TIMER (Fixed & Safe) ---
function startQuickFocus() {
    // 1. Negative Value Fix
    const hInput = document.getElementById('quickHrs');
    const mInput = document.getElementById('quickMins');
    if(hInput.value < 0) hInput.value = 0;
    if(mInput.value < 0) mInput.value = 0;

    const h = parseInt(hInput.value)||0;
    const m = parseInt(mInput.value)||0;
    
    let subj = document.getElementById('quickSubject').value;
    if(subj === "Other") subj = document.getElementById('customSubjectInput').value;
    
    if(!subj || (h===0 && m===0)) return alert("Please set time & subject!");
    
    currentSubject = subj;
    sessionDuration = (h*3600) + (m*60);
    timeRemaining = sessionDuration;
    isPaused = false;
    
    // 2. Show Screen FIRST (Important)
    document.getElementById('focusOverlay').style.display = 'flex';
    document.getElementById('focusSubjectDisplay').innerText = subj;
    
    // 3. Safe Wake Lock (Crash Proof)
    try { 
        if('wakeLock' in navigator) {
            navigator.wakeLock.request('screen')
            .then(w => { wakeLock = w; })
            .catch(err => console.log("Wake Lock Error:", err));
        }
    } catch(e) { console.log("Wake Lock not supported"); }
    
    runTimer();
}

function runTimer() {
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        if(!isPaused) {
            timeRemaining--;
            updateTimerDisplay();
            if(timeRemaining <= 0) finishFocus();
        }
    }, 1000);
    updateTimerDisplay();
}

function updateTimerDisplay() {
    const h = Math.floor(timeRemaining/3600).toString().padStart(2,'0');
    const m = Math.floor((timeRemaining%3600)/60).toString().padStart(2,'0');
    const s = (timeRemaining%60).toString().padStart(2,'0');
    document.getElementById('focusTimerDisplay').innerText = `${h}:${m}:${s}`;
}

function toggleTimer() {
    isPaused = !isPaused;
    document.getElementById('btnPause').innerText = isPaused ? "‚ñ∂ Resume" : "‚è∏ Pause";
}

function giveUpFocus() {
    if(confirm("‚ö†Ô∏è Give up? Progress won't be saved.")) {
        closeFocus();
    }
}

function finishFocus() {
    let studied = sessionDuration - timeRemaining;
    if(studied > 60) {
        let today = new Date().toDateString();
        history[today] = (history[today] || 0) + studied;
        localStorage.setItem('st_history', JSON.stringify(history));
        addXP(Math.floor(studied/60)); 
        alert(`üî• Session Saved! You earned ${Math.floor(studied/60)} XP`);
        confetti();
    }
    closeFocus();
}

function closeFocus() {
    // üî¥ Hide Screen FIRST (Critical Fix)
    document.getElementById('focusOverlay').style.display = 'none';
    
    clearInterval(timerInterval);
    stopSounds();
    // Safe Release Logic
    try { if(wakeLock) wakeLock.release(); } catch(e){}
    updateUI();
}
// üéµ Sounds
function toggleSound(type) {
    if(soundAudio) soundAudio.pause();
    // In a real app, use local files. Here using placeholders or muted logic for demo.
    // Assuming simple loop if files existed.
    // For this version:
    alert(`üéµ Playing ${type} sound... (Imagine relaxing noise)`); 
}
function stopSounds() { if(soundAudio) soundAudio.pause(); }

// --- ‚úÖ TASK MANAGER (V5 Style & Bug Fixes) ---
function addTask() {
    const name = document.getElementById('newTaskName').value;
    if(!name) return;
    
    // Create new task
    tasks.unshift({id: Date.now(), name, status: 'pending'});
    saveTasks();
    document.getElementById('newTaskName').value = '';
}

function renderTasks() {
    const list = document.getElementById('taskListContainer');
    list.innerHTML = '';
    
    // Reset Counters
    let total = 0, done = 0, pending = 0;
    
    tasks.forEach(task => {
        total++;
        if(task.status === 'done') done++; else pending++;
        
        let isDone = task.status === 'done';
        
        // V5 Style Row (Buttons on Right)
        list.innerHTML += `
        <div class="task-row" style="${isDone ? 'opacity:0.6' : ''}">
            <div style="text-align:left;">
                <div style="font-weight:bold; ${isDone ? 'text-decoration:line-through' : ''}">${task.name}</div>
            </div>
            <div class="task-actions">
                ${!isDone ? `<button class="btn-icon" style="background:var(--success); color:black;" onclick="completeTask(${task.id})">‚úî</button>` : ''}
                <button class="btn-icon" style="background:var(--danger); color:white;" onclick="deleteTask(${task.id})">‚úñ</button>
            </div>
        </div>`;
    });
    
    // Update Stats (Bug Fixed: Directly updating IDs)
    if(document.getElementById('tTotal')) {
        document.getElementById('tTotal').innerText = total;
        document.getElementById('tDone').innerText = done;
        document.getElementById('tPending').innerText = pending;
    }
}

function completeTask(id) {
    const task = tasks.find(t => t.id === id);
    if(task) {
        task.status = 'done';
        saveTasks();
        addXP(50);
        confetti({particleCount: 50, origin: {y: 0.8}});
    }
}

function deleteTask(id) {
    const task = tasks.find(t => t.id === id);
    if(task && task.status === 'pending') {
        // Motivation Popup before giving up
        const quote = FAIL_MOTIVATION[Math.floor(Math.random() * FAIL_MOTIVATION.length)];
        if(!confirm(`Wait! ${quote}\nStill want to delete?`)) return;
    }
    tasks = tasks.filter(t => t.id !== id);
    saveTasks();
}

function saveTasks() { 
    localStorage.setItem('st_tasks', JSON.stringify(tasks)); 
    renderTasks(); 
}

function clearDoneTasks() { 
    if(confirm("Remove all completed tasks?")) {
        tasks = tasks.filter(t => t.status === 'pending'); 
        saveTasks(); 
    }
}

// --- üèÜ CHALLENGES ---
function startChallenge() {
    if(challenge.active && !confirm("Start new? Old progress will be deleted.")) return;
    
    const name = document.getElementById('challengeNameInput').value;
    const days = document.getElementById('challengeDaysInput').value;
    
    challenge = { active:true, name, target: parseInt(days), day: 1, lastClaim: 0 };
    localStorage.setItem('st_challenge', JSON.stringify(challenge));
    checkChallenge();
}

function checkChallenge() {
    const setup = document.getElementById('challengeSetupBox');
    const view = document.getElementById('challengeActiveView');
    const widget = document.getElementById('challengeWidget');
    
    if(!challenge.active) {
        setup.style.display = 'block'; view.style.display = 'none'; widget.style.display = 'none';
        return;
    }
    
    // Show View
    setup.style.display = 'none'; view.style.display = 'block'; widget.style.display = 'block';
    
    // Update UI Texts
    [document.getElementById('challengeText'), document.getElementById('activeChallengeTitle')].forEach(e => e.innerText = challenge.name);
    [document.getElementById('challengeDay'), document.getElementById('activeChallengeDay')].forEach(e => e.innerText = challenge.day);
    [document.getElementById('challengeTarget'), document.getElementById('activeChallengeTarget')].forEach(e => e.innerText = challenge.target);
    
    // Sidebar Progress
    let pct = (challenge.day / challenge.target) * 100;
    document.getElementById('challengeBarSidebar').style.width = `${pct}%`;
}

function confirmClaim() {
    if(new Date(challenge.lastClaim).toDateString() === new Date().toDateString()) return alert("Already claimed today!");
    
    challenge.day++;
    challenge.lastClaim = Date.now();
    addXP(100);
    
    if(challenge.day > challenge.target) {
        alert("üèÜ CHALLENGE COMPLETED! You are a LEGEND!");
        document.getElementById('challengeMedal').style.display = 'block';
        addXP(1000);
    }
    
    localStorage.setItem('st_challenge', JSON.stringify(challenge));
    streak++;
    localStorage.setItem('st_streak', streak);
    checkChallenge();
    updateUI();
    confetti();
}

function deleteChallenge() {
    if(confirm("Delete Challenge?")) {
        challenge = {active:false};
        localStorage.setItem('st_challenge', JSON.stringify(challenge));
        checkChallenge();
    }
}

// --- ‚öôÔ∏è SETTINGS & HELPERS ---

// --- üìì MISTAKE NOTEBOOK LOGIC ---
let mistakes = JSON.parse(localStorage.getItem('st_mistakes') || '[]');

function addMistake() {
    const txt = document.getElementById('newMistakeInput').value;
    if(!txt) return;
    mistakes.unshift({id: Date.now(), text: txt});
    saveMistakes();
    document.getElementById('newMistakeInput').value = '';
}

function renderMistakes() {
    const list = document.getElementById('mistakeListContainer');
    if(!list) return;
    list.innerHTML = '';
    
    if(mistakes.length === 0) {
        list.innerHTML = '<div style="text-align:center; opacity:0.5; font-size:12px;">No mistakes recorded yet. Good job!</div>';
        return;
    }

    mistakes.forEach(m => {
        list.innerHTML += `
        <div class="task-row" style="border-left: 3px solid var(--danger);">
            <div style="font-size:13px;">${m.text}</div>
            <button class="btn-icon" style="background:rgba(255,255,255,0.1); color:var(--danger); width:25px; height:25px;" onclick="deleteMistake(${m.id})">‚úñ</button>
        </div>`;
    });
}

function deleteMistake(id) {
    mistakes = mistakes.filter(m => m.id !== id);
    saveMistakes();
}

function saveMistakes() {
    localStorage.setItem('st_mistakes', JSON.stringify(mistakes));
    renderMistakes();
}

// --- ‚öôÔ∏è SETTINGS & XP FIX ---
function changeTheme(t) {
    localStorage.setItem('st_theme', t);
    document.body.className = `theme-${t}`;
}

function checkStreak() {
   // Placeholder for streak logic
}

// XP Bug Fix: Ensures XP rolls over correctly
function addXP(n) {
    xp = parseInt(xp) + parseInt(n); // Ensure numbers
    let req = level * 1000;
    
    // Level Up Loop (in case multiple levels gained)
    while(xp >= req) { 
        xp -= req; 
        level++; 
        alert("üéâ LEVEL UP! You are now Level " + level);
        req = level * 1000; // Next level requirement increases
    }
    
    localStorage.setItem('st_xp', xp);
    localStorage.setItem('st_level', level);
    updateUI();
}

function hardReset() {
    if(confirm("Factory Reset App? All data will be lost.")) {
        localStorage.clear();
        location.reload();
    }
}

// Global Note Save
// ‚úÖ Correct Place for Modal Close
function closeModal(id) {
    document.getElementById(id).classList.add('hidden');
}

// Init
init();
</script>
</body>
</html>